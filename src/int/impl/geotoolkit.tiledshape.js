/* eslint-disable */
import {__decorate as t} from 'tslib';import {Zi,_s,lA,fr,ki,ff,df,$n,Lp,CB,Mi,Gs,rh,qi,Ss,mA,NA,bn,Is,eE,oh,Pi,Es,wr,Gn,Ic,Ci} from '@int/impl/geotoolkit.base.js';import {FB,DB} from '@int/impl/geotoolkit.http.js';var Dp=Ci(function(){let i=class t{};i.prototype.B7_=Zi;i=t([_s("geotoolkit.scene.shapes.tiledshape.AbstractCancellationStrategy")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJpc1JlcXVlc3RWYWxpZCI6IkI3XyJ9fSwiZ2V0Q2xhc3NOYW1lIjoiRF8ifSAg");var Mp=Ci({Image:"Image",w7_:"Base64",Q7_:"Canvas"},2,"eyJCYXNlNjQiOiJ3N18iLCJDYW52YXMiOiJRN18ifSAg");const vp=[Mp.Image,Mp.w7_,Mp.Q7_];let bp=new lA;const Np=function(t){return Math.floor(t+.5)},Sp=function(t){return Np(t*100)/100};var Gp=Ci(function(){var t=class{constructor(t){this.rect=t;this.hK_=null;this.time=Date.now();this.valid=!0}uK_(){return this.hK_}lK_(t){this.hK_=t;return this}B1_(){return this.rect}ce_(t){this.rect=t;return this}LR_(){return this.xJ_}E7_(t){this.xJ_=t;return this}render(t,i,s){const e=t.zR_();t.WR_(!0);bp.vs_(s.getX(),s.getY());bp=i.transformPoint(bp);const A=bp.getX(),n=bp.getY(),h=t.VR_(),r=this.rect.getX(),o=this.rect.getY(),l=this.rect.Qe_(),u=this.rect.pe_(),a=Np(Sp(r+A)*h),g=Np(Sp(o+n)*h),c=Np(Sp(l+A)*h),I=Np(Sp(u+n)*h),f=this.hK_.Ie_(),C=this.hK_.Ts_();t.aS_({RK_:!0});t.drawImage(this.hK_,0,0,f,C,a,g,c-a,I-g);t.cS_();t.WR_(e)}getTime(){return this.time}p7_(){this.time=Date.now();return this}td_(){this.valid=!1}uM_(){return this.valid}};return t}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJpbnZhbGlkYXRlIjoidGRfIiwiaXNWYWxpZCI6InVNXyJ9fX0g");var Rp=function(){let i=class t{constructor(t){this._cache={};this.m7_=0;this.y7_=0;this.D7_=!1;this.setOptions(t)}setOptions(t){t["capacity"]!==void 0&&(this.y7_=t["capacity"]);if(t["loadertype"]!==void 0){if(typeof t["loadertype"]=="number"){ki("loadertype as number is deprecated since 4.0, use LoaderType type instead");t["loadertype"]=vp[t["loadertype"]]}this.D7_=t["loadertype"]===Mp.Q7_}return this}JV_(){return{capacity:this.y7_}}clear(){if(this.m7_===0)return{};const t=this._cache;this._cache={};this.m7_=0;return t}td_(){if(this.m7_===0)return this;for(const t in this._cache)this._cache.hasOwnProperty(t)&&this._cache[t].td_();return this}M7_(t){if(this.m7_===0)return this;const i=[];for(const s in this._cache)if(this._cache.hasOwnProperty(s)){const e=this._cache[s];e.td_();const A=e.LR_();A!=null&&A.$s_(t)!==!0&&i.push(s)}for(let t=0;t<i.length;t++){this.m7_--;delete this._cache[i[t]]}return this}v7_(){return this.y7_>0?this.y7_:Number.POSITIVE_INFINITY}b7_(t){return this._cache[t]}CM_(t){if(!t.hasOwnProperty("id"))return;const i=t["id"],s=t["tilerect"];let e;if(this.N7_()){let A=null,n=Date.now();for(const t in this._cache)if(this._cache.hasOwnProperty(t)){const i=this._cache[t].getTime();if(i<n){A=t;n=i}}e=this.S7_(t["image"],s,i,A);delete this._cache[A];this.m7_--}else e=this.G7_(t["image"],s,t["modelarea"]);this._cache.hasOwnProperty(i)||this.m7_++;this._cache[i]=e}S7_(t,i,s,e){const A=typeof e=="string"?this._cache[e]:e;A.p7_();A.ce_(i);t=this.D7_?t:t.fM_();const n=A.uK_();n.setSize(t.width,t.height);n.clear();n.drawImage(t,0,0);return A}G7_(t,i,s){const e=new Gp(i);t=this.D7_?t:t.fM_();const A=fr.zw_(t.width,t.height,!0,!0,1);A.drawImage(t,0,0);e.E7_(s);e.lK_(A);return e}N7_(){return this.y7_>0&&this.m7_>=this.y7_}R7_(){return this.m7_===0}};i=t([_s("geotoolkit.scene.shapes.tiledshape.TileCache")],i);return i}();var Up=Ci(function(){let i=class t extends Dp{B7_(t,i){return i["visiblemodelarea"].$s_(t["tilerect"])}};i=t([_s("geotoolkit.scene.shapes.tiledshape.VisibleAreaCancellationStrategy")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJpc1JlcXVlc3RWYWxpZCI6IkI3XyJ9fX0g");var Yp=Ci({itt_:"TileAddedToQueue",stt_:"TileRemovedFromQueue",ett_:"AllTilesRendered",Att_:"TileLoading",ntt_:"TileLoaded",htt_:"TileCancelled",rtt_:"TileRendering",ott_:"TileRendered",ltt_:"FirstTileLoading",utt_:"LastTileRendered"},2,"eyJUaWxlTG9hZGluZyI6IkF0dF8iLCJUaWxlTG9hZGVkIjoibnR0XyIsIlRpbGVDYW5jZWxsZWQiOiJodHRfIiwiVGlsZVJlbmRlcmluZyI6InJ0dF8iLCJUaWxlUmVuZGVyZWQiOiJvdHRfIiwiRmlyc3RUaWxlTG9hZGluZyI6Imx0dF8iLCJMYXN0VGlsZVJlbmRlcmVkIjoidXR0XyJ9");const Tp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAAAXNSR0IArs4c6QAAAARnQU"+"1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKXSURBVHhe7dMBAQAACMMgm7+6QQYduEGYAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAm"+"gCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJ"+"QJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgC"+"kCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJ"+"oApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkC"+"UCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoA"+"pAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUC"+"aAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoApA"+"lAmgCkCUCaAKQJQJoApAlAmgCkCUCaAKQJQJoAhG0PobQWVJKLEbMAAAAASUVORK5CYII=",Kp=6e4,Hp=1,qp=6,Jp=Mi.setTimeout,Pp=[];var Vp=function(){var t;return class{constructor(){this.att_=null;this.oJ_=null;this.H7_=null;this.Us_=null;this.gtt_=null}dispose(){this.gtt_!=null&&clearTimeout(this.gtt_);this.att_&&this.att_.cancel(null);if(this.oJ_){this.oJ_.off(ff.PV_);this.oJ_.dt_({url:null});Pp.length<256?Pp.push(this.oJ_):this.oJ_.dispose()}this.Us_=null}set ctt_(t){this.gtt_=t}get ctt_(){return this.gtt_}set data(t){this.Us_=t}get data(){return this.Us_}set Itt_(t){this.H7_=t}get Itt_(){return this.H7_}set request(t){this.att_=t}get request(){return this.att_}set image(t){this.oJ_=t}get image(){return this.oJ_}}}(),Op=function(){let i=class t extends $n{constructor(t){super();this.ftt_=new Lp({numberofparalleltasks:qp});this.Ctt_=Hp;this.VM_=Kp;this.dtt_=null;this.Btt_=Tp;this.wtt_={};this.Qtt_=null;this.Ett_=this.ptt_.bind(this);this.mtt_=this.Ett_;this.ytt_=FB.Ai_().u1_();this.Dtt_=Mp.Image;this.Mtt_=null;this.vtt_=null;this.setOptions(t)}setOptions(t){if(!t)return this;t["maxnumreq"]!==void 0&&this.ftt_.j7_(t["maxnumreq"]);t["tries"]!==void 0&&(this.Ctt_=t["tries"]);t["timeout"]!==void 0&&(this.VM_=t["timeout"]);t["formatter"]!==void 0&&this.btt_(t["formatter"]);t["imageloader"]!==void 0&&(this.mtt_=t["imageloader"]!=null?t["imageloader"]:this.Ett_);if(t["errimgsrc"]!==void 0){this.Btt_=t["errimgsrc"];this.Qtt_&&(this.Qtt_.src=this.Btt_)}t["httpservice"]!==void 0&&(this.ytt_=t["httpservice"]?t["httpservice"]:FB.Ai_().u1_());t["loadertype"]!==void 0&&(this.Dtt_=t["loadertype"]);t["cancellationstrategy"]!==void 0&&(this.Mtt_=t["cancellationstrategy"]);t["delaycallback"]!==void 0&&(this.vtt_=t["delaycallback"]);return this}JV_(){return{maxnumreq:this.ftt_.Z7_(),tries:this.Ctt_,timeout:this.VM_,formatter:this.dtt_,imageloader:this.mtt_,errimgsrc:this.Btt_,httpservice:this.ytt_,loadertype:this.Dtt_,cancellationstrategy:this.Mtt_,delaycallback:this.vtt_}}btt_(t){this.clear();this.dtt_=t;return this}Ntt_(t){if(this.Mtt_ instanceof Up)for(const i in this.wtt_)this.Mtt_.B7_(this.wtt_[i].data,t)||this.Stt_(i)}Gtt_(t){if(!this.dtt_)return;const i=t["id"];if(this.wtt_.hasOwnProperty(i)){if(this.wtt_[i].ctt_==null)return;clearTimeout(this.wtt_[i].ctt_);this.notify(Yp.stt_,this);this.wtt_[i].ctt_=null}else this.wtt_[i]=new Vp;this.wtt_[i].data=t;const s=this.vtt_(t);s>0?this.wtt_[i].ctt_=Jp(this.Rtt_.bind(this,i,t),s):this.Rtt_(i,t);this.notify(Yp.itt_,this)}Rtt_(t,i){if(this.Df_()||this.wtt_[t]==null||this.wtt_[t].data!==i){this.Df_()||this.notify(Yp.stt_,this);return}this.wtt_[t].ctt_=null;const s=this.ftt_._7_(((s,e,A)=>{if(!A.qE_()&&this.dtt_){this.notify(Yp.Att_,this,{id:t,modelarea:i["tilerect"]});this.load(i,(n=>{if(A.qE_())e();else{this.notify(Yp.ntt_,this,{id:t,image:n,modelarea:i["tilerect"],tilerect:i["devicetilerect"]});this.ktt_(t);s()}}))}else e()}),{cancel:()=>{this.notify(Yp.htt_,this,{id:t,modelarea:i["tilerect"]});this.ktt_(t)}});this.wtt_[t].Itt_=s.XC_()}load(t,i){const s=t["id"];t["devicetilerect"]=t["devicearea"].clone().translate(-t["transformedmodelrect"].getX(),-t["transformedmodelrect"].getY());Gs(t,"deviceTileRect","devicetilerect","TiledShape");t["devicearea"].round();t["transformedmodelrect"].round();let e=null;if(this.Dtt_!==Mp.Q7_){e=Pp.length>0?Pp.pop():new df({crossorigin:"Anonymous"});this.wtt_[s].image=e;e.on(ff.PV_,(()=>{this.Df_()||i(e)}))}this.Ftt_(this.dtt_(t),e,s,i,this.Ctt_)}Ftt_(t,i,s,e,A){this.wtt_[s].request=new CB;let n;n=typeof t=="string"?{url:t}:t;n["cancel"]=this.wtt_[s].request;const h=this.wtt_[s],r=this.mtt_(n,((t,r)=>{if(h===this.wtt_[s])if(r)if(i==null)e(r);else{const t=this.Dtt_!==Mp.w7_&&typeof r=="object"||typeof r!="string"?Mi.URL.createObjectURL(r):r;i.dt_({url:t||this.Btt_})}else{typeof t=="object"&&t["code"]!=null&&(t=t["code"]);if(t&&t===DB.n1_){e();return}const r=undefined;if(--A>0)Jp((()=>{this.wtt_[s]===h?this.Ftt_(n,i,s,e,A):e()}),this.VM_);else if(i==null){this.Stt_(s);e()}else i.dt_({url:this.Btt_})}else e()}));if(r instanceof CB&&this.wtt_[s].request!==r){this.wtt_[s].request=r;n["cancel"]=this.wtt_[s].request}}ptt_(t,i){return this.query(t,this.Dtt_===Mp.w7_?null:"blob",i)}query(t,i,s){return this.ytt_.get(t["url"],{cancel:t["cancel"],responsetype:i}).then((function(t){s(null,t["data"])}),s)}clear(){this.ftt_.abort();for(const t in this.wtt_)this.Stt_(t);return this}Stt_(t){if(this.wtt_[t]!=null)if(this.wtt_[t].Itt_!=null)this.ftt_.ttt_(this.wtt_[t].Itt_);else{let i=Yp.htt_;if(this.wtt_[t].ctt_!=null){clearTimeout(this.wtt_[t].ctt_);this.wtt_[t].ctt_=null;i=Yp.stt_}this.notify(i,this,{id:t,modelarea:this.wtt_[t].data["tilerect"]});this.ktt_(t)}}ktt_(t){if(this.wtt_[t]!=null){this.wtt_[t].dispose();delete this.wtt_[t]}}dispose(){if(!this.Df_()){super.dispose();this.clear()}}};i=t([_s("geotoolkit.scene.shapes.tiledshape.TileReceiver")],i);return i}();const Wp=12e4,zp=Mi.setTimeout;var Xp=function(){let i=class t extends $n{constructor(t){super();this.WK_=t["asynctimeout"]||Wp;this.VM_=null;this.xtt_=0;this.x0_=null;this.Ltt_=null;this._cache=new Rp(t);this.Utt_=new Op(t);this.Utt_.on(Yp.itt_,(()=>{this.xtt_++;this.notify(Yp.itt_,this)}));this.Utt_.on(Yp.stt_,(()=>{this.xtt_--;this.notify(Yp.stt_,this)}));this.Utt_.on(Yp.Att_,((t,i,s)=>{this.notify(Yp.Att_,this,s)}));this.Utt_.on(Yp.ntt_,((t,i,s)=>{if(s["image"]!=null){this._cache.CM_(s);this.xtt_--;if(this.x0_){this.x0_(this._cache.b7_(s["id"]));this.Ytt_()&&this.Ttt_()}this.notify(Yp.ntt_,this,s);this.notify(rh.sC_,this,s["modelarea"])}}));this.Utt_.on(Yp.htt_,((t,i,s)=>{this.xtt_--;this.notify(Yp.htt_,this,s)}))}setOptions(t){this.WK_=t["asynctimeout"]||this.WK_;this._cache.setOptions(t);this.Utt_.setOptions(t);return this}JV_(){return qi(qi(this._cache.JV_(),this.Utt_.JV_()),{asynctimeout:this.WK_})}btt_(t){this.Utt_.btt_(t);return this}R7_(){return this._cache.R7_()}clear(){this.Utt_.clear();return this._cache.clear()}b7_(t){return this._cache.b7_(t)}Gtt_(t){this.Utt_.Gtt_(t)}Stt_(t){this.Utt_.Stt_(t)}Ktt_(t,i,s,e,A,n){if(this.x0_){this.Utt_.clear();this.Ttt_()}this.clear();this.query(t,i,s,e,A);if(this.Ytt_())n();else{this.x0_=A;this.Ltt_=n;this.VM_=zp(this.Ttt_.bind(this),this.WK_)}}Ttt_(){this.x0_=null;if(this.VM_){clearTimeout(this.VM_);this.VM_=null}this.Ltt_()}td_(t){this.Utt_.clear();this._cache.td_()}M7_(t){this.Utt_.clear();this._cache.M7_(t)}Ntt_(t){this.Utt_.Ntt_(t)}dispose(){this.clear();this.Utt_.dispose();super.dispose()}Ytt_(){return this.xtt_===0}};i=t([_s("geotoolkit.scene.shapes.tiledshape.AbstractTileManager")],i);return i}();var jp=function(){let i=class t extends Xp{constructor(t){super(t);this.Htt_=null;this.fO_=[];this.setOptions(t)}setOptions(t){if(t==null)return this;super.setOptions(t);t["modelarea"]!==void 0&&(this.Htt_=t["modelarea"]);t["images"]!==void 0&&(this.fO_=t["images"].sort(((t,i)=>t["width"]<i["width"]?-1:1)));return this}JV_(){return qi(super.JV_(),{modelarea:this.Htt_,images:this.fO_})}query(t,i,s,e,A){this.HM_=this.HM_||t.BI_();this.qM_=this.qM_||t.sI_();let n=t.rn_(e);n=n.translate(-n.getX(),-n.getY());const h=this.fM_(Math.round(n.Ie_())),r=this.b7_(h["id"]);if(r==null){this.Ntt_(Ss({visiblemodelarea:e},["visibleModelArea"],"AbstractCancellationStrategy.isRequestValid"));this.Gtt_(Ss({id:h["id"],tilerect:this.Htt_,devicearea:n,transformedmodelrect:n},["tileRect","deviceArea","transformedModelRect"],"TiledShape"))}else this.qtt_=r;if(this.qtt_){this.notify(Yp.rtt_,this,{id:h["id"],modelarea:this.qtt_.B1_()});this.qtt_.ce_(n);A(this.qtt_);this.notify(Yp.ott_,this,{id:h["id"],modelarea:this.qtt_.B1_()})}this.notify(Yp.ett_,this)}fM_(t){for(let i=0;i<this.fO_.length-1;i++)if(t<=this.fO_[i].width)return this.fO_[i];return this.fO_[this.fO_.length-1]}};i=t([_s("geotoolkit.scene.shapes.tiledshape.ImageManager")],i);return i}();const Zp=new mA,_p=function(t,i){return(t<<16)+i};var $p=function(){let i=class t extends Xp{constructor(t){super(t);this.Jtt_=256;this.Ptt_=256;this.Vtt_=1;this.Ott_=0;this.Wtt_=15;this.ztt_=null;this.Xtt_=[];this.setOptions(t);this._w=1;this._h=1;this.jtt_=new mA}setOptions(t){if(t==null)return this;super.setOptions(t);t["tilew"]!==void 0&&(this.Jtt_=t["tilew"]);t["tileh"]!==void 0&&(this.Ptt_=t["tileh"]);t["extendedrenderingborders"]!==void 0&&(this.Vtt_=t["extendedrenderingborders"]);t["minlod"]!==void 0&&(this.Ott_=t["minlod"]);t["maxlod"]!==void 0&&(this.Wtt_=t["maxlod"]);return this}JV_(){const t=super.JV_();return qi(t,{tilew:this.Jtt_,tileh:this.Ptt_,extendedrenderingborders:this.Vtt_,minlod:this.Ott_,maxlod:this.Wtt_})}query(t,i,s,e,A){Zp.ce_(i).Le_(this.Vtt_*this.Jtt_,this.Vtt_*this.Ptt_);this.ztt_=e;this.jtt_=t.rn_(this.ztt_,this.jtt_);const n=NA.clamp(Math.ceil(Math.log2(Math.min(t.Zc_(),t._c_()))),this.Ott_,this.Wtt_);if(this.z!==n||!NA.equals(this._w,this.jtt_.Ie_())||!NA.equals(this._h,this.jtt_.Ts_())){this.z=n;const t=this.clear();for(const i in t)this.Xtt_.push(t[i]);for(let t=0;t<this.Xtt_.length;t++){const i=this.Xtt_[t].B1_(),s=this.jtt_.Ie_()/this._w,e=this.jtt_.Ts_()/this._h;i.ce_(i.getX()*s,i.getY()*e,i.Qe_()*s,i.pe_()*e);this.Xtt_[t].ce_(i)}}this._w=this.jtt_.Ie_();this._h=this.jtt_.Ts_();const h=Math.pow(2,n),r=Zp.intersect(this.jtt_);if(r.isEmpty())return;const o=Math.abs(Math.sin(t.HI_()))+Math.abs(Math.cos(t.HI_()));r.Le_(r.width*(o-1),r.height*(o-1));const l=Math.ceil(this.Jtt_*t.Zc_()/h),u=Math.ceil(this.Ptt_*t._c_()/h);let a=Math.ceil((r.getX()+r.Ie_()-this.jtt_.getX())/l),g=Math.floor((r.getX()-this.jtt_.getX())/l),c=Math.floor((r.getY()-this.jtt_.getY())/u),I=Math.ceil((r.getY()+r.Ts_()-this.jtt_.getY())/u);g<0&&(g=0);c<0&&(c=0);a>h&&(a=h);I>h&&(I=h);this.Xtt_.forEach(A);const f=s.clone().intersect(this.jtt_);if(!f.isEmpty()){const i=t.gI_(f);i.Le_(Math.max(bn.$c_((this.Vtt_+1)*this.Jtt_,0,t),0),Math.max(bn.$c_(0,(this.Vtt_+1)*this.Ptt_,t),0));this.Ntt_(Ss({visiblemodelarea:i},["visibleModelArea"],"AbstractCancellationStrategy.isRequestValid"))}for(let i=g;i<a;i++)for(let s=c;s<I;s++){const e=_p(i,s),h=this.b7_(String(e));if(h!=null){this.notify(Yp.rtt_,this,{id:e,modelarea:h.B1_()});A(h);this.notify(Yp.ott_,this,{id:e,modelarea:h.B1_()})}else this.Ztt_(this.jtt_,t,i,s,n,String(e))}this.Ytt_()&&this.Xtt_.length>0&&(this.Xtt_.length=0);this.notify(Yp.ett_,this)}Ztt_(t,i,s,e,A,n){const h=Math.pow(2,A),r=this.Jtt_*i.Zc_()/h,o=this.Ptt_*i._c_()/h,l=s*r+t.getX(),u=e*o+t.getY(),a=new mA(l,u,r+l,o+u),g=i.gI_(a);g.$s_(this.ztt_)&&this.Gtt_(Ss({id:n,tilerect:g,i:s,j:e,z:A,devicearea:a,transformedmodelrect:t.clone()},["tileRect","deviceArea","transformedModelRect"],"TiledShape"))}};i=t([_s("geotoolkit.scene.shapes.tiledshape.OSMManager")],i);return i}();const tm=new mA,im=function(t,i){return String((t<<16)+i)};var sm=function(){let i=class t extends Xp{constructor(t){super(t);this.Jtt_=256;this.Ptt_=256;this.Vtt_=1;this._tt_=!1;this.ztt_=null;this.$tt_=1;this.Xtt_=[];this.jtt_=new mA;this.setOptions(t)}setOptions(t){if(t==null)return this;super.setOptions(t);t["tilew"]!==void 0&&(this.Jtt_=t["tilew"]);t["tileh"]!==void 0&&(this.Ptt_=t["tileh"]);t["extendedrenderingborders"]!==void 0&&(this.Vtt_=t["extendedrenderingborders"]);t["isconsttiles"]!==void 0&&(this._tt_=t["isconsttiles"]);return this}JV_(){return qi(super.JV_(),{tilew:this.Jtt_,tileh:this.Ptt_,extendedrenderingborders:this.Vtt_,isconsttiles:this._tt_})}query(t,i,s,e,A){if(e==null)return;const n=Is();tm.ce_(i).Le_(this.Vtt_*this.Jtt_,this.Vtt_*this.Ptt_);this.ztt_=e;this.jtt_=t.rn_(this.ztt_,this.jtt_);if(!(this._tt_||NA.equals(this.$tt_,n)&&NA.equals(this._w,this.jtt_.Ie_())&&NA.equals(this._h,this.jtt_.Ts_()))){const t=this.clear();for(const i in t)this.Xtt_.push(t[i]);for(let t=0;t<this.Xtt_.length;t++){const i=this.Xtt_[t].B1_(),s=this.jtt_.Ie_()/this._w,e=this.jtt_.Ts_()/this._h;i.ce_(i.getX()*s,i.getY()*e,i.Qe_()*s,i.pe_()*e);this.Xtt_[t].ce_(i)}}this.$tt_=n;this._w=this.jtt_.Ie_();this._h=this.jtt_.Ts_();const h=tm.intersect(this.jtt_);if(h.isEmpty())return;const r=this.Jtt_,o=this.Ptt_,l=Math.ceil((h.getX()+h.Ie_()-this.jtt_.getX())/r),u=Math.floor((h.getX()-this.jtt_.getX())/r),a=Math.floor((h.getY()-this.jtt_.getY())/o),g=Math.ceil((h.getY()+h.Ts_()-this.jtt_.getY())/o),c=s.clone().intersect(this.jtt_);if(!c.isEmpty()){const i=t.gI_(c);i.Le_(Math.max(bn.$c_((this.Vtt_+1)*this.Jtt_,0,t),0),Math.max(bn.$c_(0,(this.Vtt_+1)*this.Ptt_,t),0));this.Ntt_(Ss({visiblemodelarea:i},["visibleModelArea"],"AbstractCancellationStrategy.isRequestValid"))}for(let i=u;i<l;i++)for(let s=a;s<g;s++){const e=im(i,s),A=this.b7_(e);A!=null&&A.uM_()||this.Ztt_(this.jtt_,t,i,s,e)}!this._tt_&&this.Xtt_.length>0&&(this.Ytt_()?this.Xtt_.length=0:this.Xtt_.forEach(A));this.tit_(u,l,a,g,A);this.notify(Yp.ett_,this)}tit_(t,i,s,e,A){for(let n=t;n<i;n++)for(let t=s;t<e;t++){const i=im(n,t),s=this.b7_(i);if(s){this.notify(Yp.rtt_,this,{id:i,modelarea:s.B1_()});A(s);this.notify(Yp.ott_,this,{id:i,modelarea:s.B1_()})}}}Ztt_(t,i,s,e,A){const n=this.Jtt_,h=this.Ptt_,r=s*n+t.getX(),o=e*h+t.getY();let l=new mA(r,o,n+r,h+o),u=i.uI_(l);u=u.intersect(this.ztt_);if(!(u.Ie_()<NA.Je_||u.Ts_()<NA.Je_)){l=i.transform(u,l);this.Gtt_(Ss({id:A,tilerect:u,devicearea:l,transformedmodelrect:t.clone(),i:s,j:e},["tileRect","deviceArea","transformedModelRect"],"TiledShape"))}}td_(t){if(t==null){super.td_();return this}if(this._tt_)return this;tm.ce_(t);tm.intersect(this.jtt_);if(tm.isEmpty())return this;const i=this.Jtt_,s=this.Ptt_,e=Math.ceil((tm.getX()+tm.Ie_()-this.jtt_.getX())/i),A=Math.floor((tm.getX()-this.jtt_.getX())/i),n=Math.floor((tm.getY()-this.jtt_.getY())/s),h=Math.ceil((tm.getY()+tm.Ts_()-this.jtt_.getY())/s);for(let t=A;t<e;t++)for(let i=n;i<h;i++){const s=im(t,i);this.Stt_(s);const e=this.b7_(s);e!=null&&e.td_()}return this}};i=t([_s("geotoolkit.scene.shapes.tiledshape.TileManager")],i);return i}();let em,Am,nm,hm,rm;var om=Ci(function(){let i=class t extends eE{constructor(t){const i=new mA(0,0,1e3,1e3);super(i);this.ztt_=i;this.h6_=null;this.iit_=(t,i,s)=>{this.td_(s,!1)};this.sit_=!1;this.eit_=0;this.xtt_=0;this.Ait_={};this.nit_={};this.hit_={};this.rit_={};this.oit_={};this.lit_=!0;this.uit_=!1;this.ait_=null;this.UU_={freezeupdate:!1};this.git_=t=>{t.off(Yp.itt_,this.cit_);t.off(Yp.stt_,this.Iit_);t.off(Yp.ett_,this.fit_);t.off(rh.sC_,this.iit_);t.off(Yp.Att_,this.Cit_);t.off(Yp.ntt_,this.dit_);t.off(Yp.htt_,this.Bit_);t.off(Yp.rtt_,this.wit_);t.off(Yp.ott_,this.Qit_)};this.Eit_=t=>{t.on(Yp.itt_,this.cit_);t.on(Yp.stt_,this.Iit_);t.on(Yp.ett_,this.fit_);t.on(rh.sC_,this.iit_);t.on(Yp.Att_,this.Cit_);t.on(Yp.ntt_,this.dit_);t.on(Yp.htt_,this.Bit_);t.on(Yp.rtt_,this.wit_);t.on(Yp.ott_,this.Qit_)};this.cit_=()=>{if(this.xtt_===0){this.lit_=!0;this.uit_=!1}this.xtt_++};this.Iit_=()=>{this.xtt_--};this.Cit_=(t,i,s)=>{if(this.lit_){this.lit_=!1;this.pit_();if(!this.sit_)return;this.Ait_[s["id"]]=Mi.performance.now();this.eit_=this.Ait_[s["id"]]}else this.sit_&&(this.Ait_[s["id"]]=Mi.performance.now());this.sit_&&this.notify(Yp.Att_,this,Ss({modelarea:s["modelarea"]},["modelArea"],"geotoolkit/scene/shapes/tiledshape/Events.TileLoading"))};this.dit_=(t,i,s)=>{this.xtt_--;if(!this.sit_)return;const e=Mi.performance.now()-this.Ait_[s["id"]];this.notify(Yp.ntt_,this,Ss({modelarea:s["modelarea"],time:e},["modelArea"],"geotoolkit/scene/shapes/tiledshape/Events.TileLoaded"));delete this.Ait_[s["id"]];this.hit_[s["modelarea"].toString()]=e};this.Bit_=(t,i,s)=>{this.xtt_--;if(!this.sit_)return;if(!this.Ait_.hasOwnProperty(s["id"]))return;const e=Mi.performance.now()-this.Ait_[s["id"]];this.notify(Yp.htt_,this,Ss({modelarea:s["modelarea"],time:e},["modelArea"],"geotoolkit/scene/shapes/tiledshape/Events.TileCancelled"));delete this.Ait_[s["id"]];this.rit_[s["modelarea"].toString()]=e};this.wit_=(t,i,s)=>{if(this.sit_&&!this.uit_){this.nit_[s["id"]]=Mi.performance.now();this.notify(Yp.rtt_,this,Ss({modelarea:s["modelarea"]},["modelArea"],"geotoolkit/scene/shapes/tiledshape/Events.TileRendering"))}};this.Qit_=(t,i,s)=>{if(this.uit_)return;if(!this.sit_)return;const e=Mi.performance.now()-this.nit_[s["id"]];this.notify(Yp.ott_,this,Ss({modelarea:s["modelarea"],time:Mi.performance.now()-this.nit_[s["id"]]},["modelArea"],"geotoolkit/scene/shapes/tiledshape/Events.TileRendered"));delete this.nit_[s["id"]];this.oit_[s["modelarea"].toString()]=e};this.fit_=(t,i,s)=>{if(!(this.uit_||this.xtt_>0)){this.uit_=!0;this.mit_();this.hit_={};this.rit_={};this.nit_={}}};(t=t||{})["delaycallback"]=t["delaycallback"]||function(){return 500};this.setOptions(t)}pit_(){this.notify(Yp.ltt_,this)}mit_(){if(this.ait_){this.ait_.dispose();this.ait_=null;setTimeout(this.td_.bind(this))}this.notify(Yp.utt_,this,this.sit_?Ss({tilesloading:this.hit_,tilescancelling:this.rit_,tilesrendering:this.oit_,time:Mi.performance.now()-this.eit_},["tilesLoading","tilesCancelling","tilesRendering"],"geotoolkit/scene/shapes/tiledshape/Events.LastTileRendered"):{})}yit_(){this.eit_=0;this.xtt_=0;this.Ait_={};this.nit_={};this.hit_={};this.rit_={};this.oit_={};this.lit_=!0;this.uit_=!1}Dit_(t){if(!(t.hasOwnProperty("images")||t.hasOwnProperty("minlod")||t.hasOwnProperty("maxlod")||t.hasOwnProperty("isconsttiles")||this.h6_==null)){if(t.hasOwnProperty("freezeupdate")){this.ait_=this.ait_||this.h6_;this.git_(this.h6_);this.h6_=new sm(t);this.Eit_(this.h6_)}this.h6_.clear();this.yit_();this.h6_.setOptions(t);return this.h6_}if(this.h6_!=null)if((t=qi(t,this.h6_.JV_())).hasOwnProperty("freezeupdate")){this.ait_=this.h6_;this.git_(this.h6_)}else this.h6_.dispose();this.h6_=this.Mit_(t);this.yit_();this.Eit_(this.h6_);return this.h6_}Mit_(t){return t.hasOwnProperty("images")?new jp(t):t.hasOwnProperty("minlod")||t.hasOwnProperty("maxlod")?new $p(t):new sm(t)}setOptions(t){if(t==null)return this;t=Es(t);this.UU_=Pi(t,this.UU_);if(t.hasOwnProperty("modelarea")&&this.UU_["modelarea"]instanceof mA&&!this.UU_["modelarea"].isEmpty()){this.ztt_=this.UU_["modelarea"];this.ht_(this.ztt_)}this.h6_=this.Dit_(this.UU_);this.td_();return this}JV_(){const t=Pi(this.UU_,{});return Pi(this.h6_.JV_(),t)}ad_(t,i){const s=this.sd_()!=null?t.uS_(this.sd_()):t;if(s.tk_()){s.iQ_(wr.EQ_);s.pR_(this.LR_());i()}else this.h6_!=null?this.vit_(s,((t,s,e,A,n)=>{const h=function(){n();i()};this.ait_?this.ait_.Ktt_(t,s,e,this.LR_(),A,(()=>{this.h6_.Ktt_(t,s,e,this.LR_(),(()=>{}),h)})):this.h6_.Ktt_(t,s,e,this.LR_(),A,h)})):i()}render(t){const i=this.sd_()!=null?t.uS_(this.sd_()):t;if(i.tk_()){i.iQ_(wr.EQ_);i.pR_(this.LR_())}else this.h6_!=null&&this.vit_(i,((t,i,s,e,A)=>{if(this.ait_){this.ait_.query(t,i,s,this.LR_(),e);this.h6_.query(t,i,s,this.LR_(),(()=>{}))}else this.h6_.query(t,i,s,this.LR_(),e);A()}))}vit_(t,i){this.Xb_(t);let s,e,A,n=t.cR_(),h=t.FR_(),r=t.Ji_();if((r.MI_()||r.BI_()<0||r.sI_()<0)&&this.LR_()!=null){const i=t.Ji_(),o=this.LR_();em=em||new lA;Am=Am||new lA;nm=nm||new lA;hm=hm||new mA;rm=rm||new Gn;em.vs_(o.we_(),o.Ee_());Am.vs_(o.we_(),o.pe_());nm.vs_(o.Qe_(),o.Ee_());em=i.transform(em,em);Am=i.transform(Am,Am);nm=i.transform(nm,nm);const l=lA.Ss_(em,nm),u=lA.Ss_(em,Am);hm.ce_(0,0,l,u);r=Gn.xI_(o,hm);n=t.cR_().clone();h=t.FR_().clone();i.uI_(n,n);i.uI_(h,h);r.transform(n,n);r.transform(h,h);if(n.$s_(hm)){e=n.clone().intersect(hm);A=Gn.kI_(-e.getX()+hm.getX(),-e.getY()+hm.getY()).vI_(r);const i=e.Ie_(),h=e.Ts_();i>0&&h>0&&(s=t.ZR_(i,h,!1))}}s!=null&&s.tQ_();const o=this,l=undefined;i(r,n,h,(i=>{s!=null?i.render(s.mK_(),A,o.LR_()):i.render(t,t.Ji_(),o.LR_())}),(function(){if(s!=null){s.gM_();const i=undefined;t.uS_(A.rI_()).drawImage(s,0,0,s.Ie_()*t.VR_(),s.Ts_()*t.VR_(),0,0,e.Ie_(),e.Ts_())}o.iN_(t)}))}LR_(){return this.ztt_}sd_(){const t=this.bit_(),i=this.ut_();return i==null?t:t==null?i:Gn.multiply(i,t)}dispose(){if(!this.Df_()){if(this.h6_!=null){this.h6_.dispose();this.h6_=null}super.dispose()}}vn_(t,i){super.vn_(t,i);if(i===oh.dC_){this.h6_&&this.h6_.clear();this.td_()}return this}bit_(){const t=this.getBounds(),i=this.LR_();return Gn.LI_(i,t)?Gn.xI_(i,t,!1,!1,!1):null}Nit_(t){if((t=t||this.LR_())!=null&&this.if_()!=null){const i=this.if_().HI_(),s=Math.abs(Math.cos(i))+Math.abs(Math.sin(i))-1;if(s>0){const i=(t=t.clone()).Ie_()*s,e=t.Ie_()*s;t.Le_(i,e)}}return t}ot_(){const t=this.getParent();if(!(t instanceof Ic))return null;let i=t.ot_();const s=new mA(this.getBounds());this.ut_()!=null&&i!=null&&(i=this.ut_().gI_(i));i!=null&&s.intersect(i);const e=this.It_();e!=null&&e.gI_(s,s);return s}It_(){return Gn.JI_}td_(t,i){const s=i!==!1&&this.h6_!=null;if(t==null){if((t=this.LR_())==null)return this;s&&this.h6_.td_()}else if(s){const i=this.if_();let s=i!=null?i.rn_(t):t;s=this.Nit_(s);this.h6_.td_(s)}t=this.Nit_(t);return super.td_(t,i)}zf_(t,i){return super.zf_(this.Nit_(t),i)}M7_(t){if(this.h6_==null)return this;this.h6_.M7_(t);return this}Sit_(t){this.sit_=t;return this}Git_(){return this.sit_}};i=t([_s("geotoolkit.scene.shapes.TiledShape")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJvblN0YXJ0VGlsZXNMb2FkaW5nIjoicGl0XyIsIm9uQWxsVGlsZXNSZW5kZXJlZCI6Im1pdF8iLCJnZXRPcHRpb25zIjoiSlZfIiwicmVuZGVyQXN5bmMiOiJhZF8iLCJnZXRNb2RlbEFyZWEiOiJMUl8iLCJnZXRXb3JsZFRyYW5zZm9ybSI6InNkXyIsInVwZGF0ZVN0YXRlIjoidm5fIiwiZ2V0VmlzaWJsZU1vZGVsTGltaXRzIjoib3RfIiwiZ2V0Q29udGVudHNUcmFuc2Zvcm0iOiJJdF8iLCJpbnZhbGlkYXRlIjoidGRfIiwiaW52YWxpZGF0ZVBhcmVudCI6InpmXyIsInNldENvbGxlY3RQZXJmb3JtYW5jZUluZm9ybWF0aW9uIjoiU2l0XyIsImdldENvbGxlY3RQZXJmb3JtYW5jZUluZm9ybWF0aW9uIjoiR2l0XyJ9fX0g");export {Dp,Mp,vp,Gp,Rp,Up,Yp,Op,Xp,jp,$p,sm,om};