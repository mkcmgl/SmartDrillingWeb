/* eslint-disable */
import {__decorate as t} from 'tslib';import {Zi,_s,Ss,Gs,lA,qi,NA,In,mA,sa,Mn,ki,Gn,kI,fr,je,Ca,Pf,YC,yu,rP,bn,QA,TA,LA,mr,tn,Cg,fg,Ic,Es,ys,Vm,wh,rh,Ji,Pi,Gi,OA,nh,$n,th,hl,Au,fA,Zs,dA,ie,Ci} from '@int/impl/geotoolkit.base.js';import {SS,RS,WS} from '@int/impl/geotoolkit.controls.js';var Aat=Ci(function(){let i=class t{};i.prototype.create=Zi;i.prototype.setOptions=Zi;i=t([_s("geotoolkit.deviation.Transformer2d")],i);return i}(),2,"eyJnZXRDbGFzc05hbWUiOiJEXyJ9");var nat=function(){let i=class t{constructor(){this.rO_=[]}SFs_(){return this.rO_}clear(){this.rO_=[];return this}GFs_(t){for(let i=0;i<this.rO_.length;i++){const s=undefined;if(t<=this.rO_[i].RFs_)return i}return this.rO_.length}kFs_(t){for(let i=this.rO_.length-1;i>=0;i--)if(this.rO_[i].RFs_<=t)return i;return 0}g1_(t){const i=t.RFs_;if(this.rO_.length===0){this.rO_.push(t);return}let s;for(s=0;s<this.rO_.length;s++)if(this.rO_[s].RFs_>=i)break;this.rO_.splice(s,0,t)}};i=t([_s("geotoolkit.deviation.RectMap")],i);return i}();var hat=Ci(function(){let i=class t{FFs_(){return Ss({xmin:this.ZQ_(),ymin:this._Q_(),xmean:this.$Q_(),ymean:this.tE_(),xmax:this.iE_(),ymax:this.sE_()},["xMin","yMin","xMean","yMean","xMax","yMax"],"DeviatedTransformation.getScalesInfo")}$Q_(){const t=this.ZQ_(),i=this.iE_();return Math.sqrt((t*t+i*i)/2)}tE_(){const t=this._Q_(),i=this.sE_();return Math.sqrt((t*t+i*i)/2)}};i.prototype.update=Zi;i.prototype.transform=Zi;i.prototype.uI_=Zi;i.prototype.xFs_=Zi;i.prototype.LFs_=Zi;i.prototype.UFs_=Zi;i.prototype.YFs_=Zi;i.prototype.TFs_=Zi;i.prototype.contains=Zi;i.prototype.KFs_=Zi;i.prototype.HFs_=Zi;i.prototype.iE_=Zi;i.prototype.sE_=Zi;i.prototype.ZQ_=Zi;i.prototype._Q_=Zi;i.prototype.qFs_=Zi;i.prototype.JFs_=Zi;i=t([_s("geotoolkit.deviation.DeviatedTransformation")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJpbnZlcnNlVHJhbnNmb3JtIjoidUlfIiwidHJhbnNmb3JtTGluZSI6InhGc18iLCJ0cmFuc2Zvcm1MaW5lcyI6IkxGc18iLCJmaW5kQm91bmRzIjoiVUZzXyIsImdldFN0YXRpb25zQm91bmRzIjoiWUZzXyIsImdldEFmZmluZVRyYW5zZm9ybWF0aW9uIjoiVEZzXyIsInNjYWxlWEF0IjoiS0ZzXyIsInNjYWxlWUF0IjoiSEZzXyIsImdldFNjYWxlc0luZm8iOiJGRnNfIiwibWF4U2NhbGVYIjoiaUVfIiwibWF4U2NhbGVZIjoic0VfIiwibWluU2NhbGVYIjoiWlFfIiwibWluU2NhbGVZIjoiX1FfIiwiZGlnaXRpemUiOiJxRnNfIiwiZ2V0TG93ZXJJbmRleCI6IkpGc18ifX0sImdldENsYXNzTmFtZSI6IkRfIn0g");var rat=Ci(function(){let i=class t{PFs_(t,i){const s={devicelength:0,length:0};Gs(s,"deviceLength","devicelength","TrackWidthStrategy.getDeviceLength");if(t.count()<2)return s;let e=0,A=0;const n=new lA,h=new lA;i.transformPoint(n.vs_(t.getX(0),t.getY(0)),h);let r=h.x,o=h.y,l,u,a,g;for(let s=1;s<t.count();++s){i.transformPoint(n.vs_(t.getX(s),t.getY(s)),h);l=h.x;u=h.y;a=r-l;g=o-u;e+=Math.sqrt(a*a+g*g);o=u;r=l;const c=undefined;A+=Math.abs(t.G2_(s-1)-t.G2_(s))}s["devicelength"]=e;s["length"]=A;return s}};i.prototype.Ie_=Zi;i=t([_s("geotoolkit.deviation.TrackWidthStrategy")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJnZXRXaWR0aCI6IkllXyIsImdldERldmljZUxlbmd0aCI6IlBGc18ifX0sImdldENsYXNzTmFtZSI6IkRfIn0g");const oat=function(t,i){return Math.abs(i)>Math.abs(t)?i<0?-Math.atan(t/i):Math.PI-Math.atan(t/i):t<0?-Math.PI/2+Math.atan(i/t):Math.PI/2+Math.atan(i/t)};var lat=Ci(function(){let i=class t extends rat{constructor(t){super();const i=qi(t,{scalewidth:!1,minwidth:1,maxwidth:+1/0,widthscalex:1,widthscaley:1},!0);this.VFs_=i["scalewidth"];this.OFs_=i["minwidth"];this.WFs_=i["maxwidth"];this.zFs_=i["widthscalex"];this.XFs_=i["widthscaley"];this.jFs_=null;this.ZFs_=1}Ie_(t,i){let s=i["width"];if(!this.VFs_)return s;const e=i["trajectory"];if(e!==this.jFs_){this.update(e);this.jFs_=e}const A=undefined;s*=Math.sqrt(this.ZFs_*(t.BI_()/this.zFs_)*(t.BI_()/this.zFs_)+(1-this.ZFs_)*(t.sI_()/this.XFs_)*(t.sI_()/this.XFs_));s<this.OFs_&&(s=this.OFs_);s>this.WFs_&&(s=this.WFs_);return s}update(t){this.ZFs_=1;let i=0,s=0,e=0,A,n;for(let h=1;h<t.count();++h){A=this.zFs_*(t.getX(e)-t.getX(h));n=this.XFs_*(t.getY(e)-t.getY(h));if(h>1&&h<t.count()-1&&Math.abs(A)<.5&&Math.abs(n)<.5)h++;else{s+=Math.abs(oat(A,n));i++;e=h}}i>0&&(s/=i);this.ZFs_=Math.sin(s);this.ZFs_*=this.ZFs_}};i=t([_s("geotoolkit.deviation.TrackMinMaxWidthStrategy")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJnZXRXaWR0aCI6IkllXyJ9fX0g");const uat=function(t){return t>=0?Math.floor(t+.5):Math.ceil(t-.5)};var aat=function(){var i;let s=i=class t{static int(t){return t<0?Math.ceil(t):Math.floor(t)}static _Fs_(t,i){return t.getX()*i.getX()+t.getY()*i.getY()}static $Fs_(t,i){return t.getX()*i.getY()-t.getY()*i.getX()}static txs_(t,i,s){const e=(t.getX()-i.getX())*(s.getX()-i.getX())+(t.getY()-i.getY())*(s.getY()-i.getY()),A=(t.getX()-i.getX())*(s.getY()-i.getY())-(t.getY()-i.getY())*(s.getX()-i.getX());return e!==0||A!==0?Math.atan2(A,e):0}static ixs_(t,i,s,e){if(e){const e=uat(i.getX()),A=uat(i.getY());if(Math.abs(s.getX()-e)>0||Math.abs(s.getY()-A)>0){s.vs_(e,A);t.push(new lA(e,A))}}else t.push(i)}static sxs_(t,i,s,e,A){const n=(t.getY()-i.getY())*(s.getX()-i.getX())-(t.getX()-i.getX())*(s.getY()-i.getY())>=0;return n===(t.getY()-s.getY())*(e.getX()-s.getX())-(t.getX()-s.getX())*(e.getY()-s.getY())>=0&&(n===(t.getY()-e.getY())*(A.getX()-e.getX())-(t.getX()-e.getX())*(A.getY()-e.getY())>=0&&n===(t.getY()-A.getY())*(i.getX()-A.getX())-(t.getX()-A.getX())*(i.getY()-A.getY())>=0)}static exs_(t,i,s,e,A){const n=(e.getY()-s.getY())*(i.getX()-t.getX())-(e.getX()-s.getX())*(i.getY()-t.getY());if(n!==0){const h=((e.getX()-s.getX())*(t.getY()-s.getY())-(e.getY()-s.getY())*(t.getX()-s.getX()))/n,r=t.getY()+h*(i.getY()-t.getY()),o=t.getX()+h*(i.getX()-t.getX());A.vs_(o,r);return!0}return!1}static Axs_(t,i,s,e){const A=(t.getY()-i.getY())*(s.getX()-i.getX())-(t.getX()-i.getX())*(s.getY()-i.getY())>=0;return A===(t.getY()-s.getY())*(e.getX()-s.getX())-(t.getX()-s.getX())*(e.getY()-s.getY())>=0&&A===(t.getY()-e.getY())*(i.getX()-e.getX())-(t.getX()-e.getX())*(i.getY()-e.getY())>=0}static getLength(t){return Math.abs(t.getX())<=Number.MIN_VALUE?Math.abs(t.getY()):Math.abs(t.getY())<=Number.MIN_VALUE?Math.abs(t.getX()):Math.sqrt(t.getX()*t.getX()+t.getY()*t.getY())}static nxs_(t){const i=t?t.length:0;return i<2||lA.Ss_(t[0],t[i-1])<NA.Je_}static hxs_(t,i,s){let e;e=t.getY()===i.getY()?(t.getX()+i.getX())/2:t.getX()+(i.getX()-t.getX())*(s-t.getY())/(i.getY()-t.getY());return new lA(e,s)}static rxs_(t,i,s,e){e===void 0&&(e=NA.Je_);const A=i.getY()-t.getY();if(A===0)return Math.abs(t.getY()-s.getY())<=e;const n=i.getX()-t.getX();return n===0?Math.abs(t.getX()-s.getX())<=e:Math.abs(t.getX()+(i.getX()-t.getX())*(s.getY()-t.getY())/A-s.getX())<=e||Math.abs(t.getY()+(i.getY()-t.getY())*(s.getX()-t.getX())/n-s.getY())<=e}static oxs_(t,i,s,e,A,n,h){if(h<=0)throw new Error("Invalid radius");const r=t-s,o=i-e,l=Math.atan2(o,r),u=A-s,a=n-e,g=Math.atan2(a,u),c=g-l,I=-Math.sign(c);if(Math.abs(c)<=Number.MIN_VALUE)throw new Error("Invalid angles");const f=Math.abs(c/2),C=h/Math.sin(f),d=C*Math.cos((l+g)/2),B=C*Math.sin((l+g)/2),w=C*Math.cos(f),Q=w*Math.cos(l),E=w*Math.sin(l),p=w*Math.cos(g),m=w*Math.sin(g);return{line:{lxs_:t,uxs_:i,xTo:I*Q+s,yTo:I*E+e},arc:{left:I*d+s-h,top:I*B+e-h,eSt_:l+Math.PI/2,axs_:g-Math.PI/2},XPi_:{x:I*p+s,y:I*m+e}}}static gxs_(t,s,e,A){const n=A||i.cxs_(t,s);if(n.length===0)return[];if(n.length===1)return i.Ixs_(t,s,e);const h=[];let r,o;for(r=0;r<n.length;++r){const A=t.slice(n[r].from,n[r].to+1),l=s.slice(n[r].from,n[r].to+1),u=i.Ixs_(A,l,e);for(o=0;o<u.length;++o){h.push(u[o].from);h.push(u[o].to)}}h.sort((function(t,i){return t-i}));const l=[];for(r=0;r<h.length;r+=2)l.push({from:h[r],to:h[r+1]});return l}static cxs_(t,i){const s=Math.min(t.length,i.length),e=[];let A,n,h,r;for(let o=0;o<s;++o){A=t[o];n=i[o];for(let l=o+2;l<s;++l){h=t[l];r=i[l];if(A===h&&n===r){e.push({from:o,to:l});o=l;break}}}e.length===0&&e.push({from:0,to:e.length-1});return e}static Ixs_(t,i,s){const e=[],A=Math.min(t.length,i.length),n=[];let h,r,o,l,u;for(h=1;h<A;++h){if(i[h]===i[h-1]||i[h]<s&&i[h-1]<s||i[h]>s&&i[h-1]>s)continue;if(i[h-1]>i[h]){o=i[h];u=i[h-1];r=t[h];l=t[h-1]}else{o=i[h-1];u=i[h];r=t[h-1];l=t[h]}if(o===s)continue;const e=r===l?l:r+(s-o)*(l-r)/(u-o);n.push(e)}if(n.length<2)return e;n.sort((function(t,i){return t-i}));for(h=0;h<n.length;h+=2)e.push({from:n[h],to:n[h+1]});return e}static fxs_(t,i){return Math.abs(t-i)<=1e-12*Math.min(Math.abs(t),Math.abs(i))}};s=i=t([_s("geotoolkit.deviation.Util")],s);return s}();const gat=new lA;var cat=function(){var i;let s=i=class t{constructor(t,i){this.Cxs_=NaN;this.dxs_=new lA;this.zA_(t,i)}zA_(t,s){if(t instanceof i){this.Cxs_=t.Cxs_;this.dxs_.vs_(t.dxs_.getX(),t.dxs_.getY())}else if(typeof s=="number"){this.dxs_.vs_(t.getX(),t.getY());this.Cxs_=s}else if(s instanceof lA){gat.vs_(s.getY()-t.getY(),t.getX()-s.getX());const i=aat._Fs_(gat,gat);let e,A;if(i>NA.Je_){const t=Math.sqrt(i);e=gat.getX()/t;A=gat.getY()/t}else{e=1;A=0}this.dxs_.vs_(e,A);this.Cxs_=-aat._Fs_(this.dxs_,t)}}Bxs_(){return this.dxs_}wxs_(t){this.dxs_=t}Rvi_(){return this.Cxs_}Qxs_(t){this.Cxs_=t}distance(t){return aat._Fs_(this.dxs_,t)+this.Cxs_}project(t){const i=this.distance(t);return new lA(t.getX()-this.dxs_.getX()*i,t.getY()-this.dxs_.getY()*i)}Exs_(t){const i=2*this.distance(t);return new lA(t.getX()-this.dxs_.getX()*i,t.getY()-this.dxs_.getY()*i)}static pxs_(t,i){const s=t.Bxs_(),e=i.Bxs_();return Math.abs(s.getX()*e.getY()-e.getX()*s.getY())<NA.Je_}static gr_(t,i){const s=t.Bxs_(),e=i.Bxs_(),A=s.getX()*e.getY()-e.getX()*s.getY(),n=t.Rvi_(),h=i.Rvi_(),r=s.getY()*h-e.getY()*n,o=e.getX()*n-s.getX()*h;return new lA(r/A,o/A)}};s=i=t([_s("geotoolkit.deviation.Line")],s);return s}();var Iat=Ci(function(){let i=class t{constructor(){this.ves_=[]}clear(){this.ves_=[]}append(t){this.ves_.push(t)}get(t){return this.ves_[t]}getSize(){return this.ves_.length}};i=t([_s("geotoolkit.deviation.MappedPixel")],i);return i}(),2,"eyJnZXRDbGFzc05hbWUiOiJEXyJ9");const fat=8,Cat=function(t){const i=t.getSize(),s=t.Bt_(),e=t.wt_(),A=i===0||s[0]===s[i-1]&&e[0]===e[i-1];if(i<(A?4:3))return 0;let n=0;for(let t=1;t<i;++t)n+=s[t-1]*e[t]-e[t-1]*s[t];A||(n+=s[i-1]*e[0]-e[i-1]*s[0]);return Math.abs(n/2)},dat=new lA,Bat=new lA,wat=new lA,Qat=new lA,Eat=new In,pat=new In,mat=new mA;var yat=function(){var t=class{constructor(t,i,s){this.dx=t;this.dy=i;this.area=s}};return t}(),Dat=function(){let i=class t{constructor(){this.mxs_=[]}yxs_(t,i,s){const e=t.getX(),A=t.getY(),n=[this.uI_(dat.vs_(e,A)),this.uI_(Bat.vs_(e+1,A)),this.uI_(wat.vs_(e+1,A+1)),this.uI_(Qat.vs_(e,A+1))];n.forEach((function(t){t.y*=s}));const h=n[0].x<0?1-aat.int(n[0].x):-aat.int(n[0].x),r=n[0].y<0?1-aat.int(n[0].y):-aat.int(n[0].y);let o=+1/0,l=-1/0,u=+1/0,a=-1/0;for(let t=0;t<n.length;t++){n[t].x+=h;n[t].y+=r;o=Math.min(o,n[t].x);l=Math.max(l,n[t].x);u=Math.min(u,n[t].y);a=Math.max(a,n[t].y)}const g=new Iat;if(sa.RS_().Fe_(mat.ce_(o,u,l,a))){let t=0;const i=a-u,s=l-o;t+=i*o;t+=-s*a;t+=-i*l;t+=s*u;g.append(new yat(0,0,t))}else{const t=aat.int(n[0].x),i=aat.int(n[0].y),s=Math.floor(o),e=Math.ceil(l),A=Math.floor(u),h=Math.ceil(a);for(let r=s;r<e;++r)for(let s=A;s<h;++s){const e=new Mn;e.union(Eat.Qt_([n[0].x,n[1].x,n[2].x,n[3].x],[n[0].y,n[1].y,n[2].y,n[3].y]),e);const A=e.intersect(pat.Qt_([r,r+1,r+1,r],[s,s,s+1,s+1]));A.length>0&&g.append(new yat(r-t,s-i,Cat(A[0])))}}this.mxs_[i]=g}Dxs_(t,i){const s=this.uI_(t),e=s.getX()-(s.getX()<0?aat.int(s.getX())-1:aat.int(s.getX())),A=s.getY()-(s.getY()<0?aat.int(s.getY())-1:aat.int(s.getY())),n=aat.int(e*fat)+aat.int(A*fat)*fat;this.mxs_[n]&&this.mxs_[n].getSize()!==0||this.yxs_(t,n,i);return this.mxs_[n]}Mxs_(){for(let t=0;t<this.mxs_.length;++t)this.mxs_[t].clear()}};i=t([_s("geotoolkit.deviation.PixelMapper")],i);return i}();var Mat=function(){let i=class t extends Dat{constructor(t,i){super();this._r=t;this.vxs_=new lA;this.bxs_=new lA;this.Nxs_=new lA;this.Sxs_=new lA;this.Gxs_=1;this.Rxs_=1;this.kxs_=null;this.Fxs_=i}Me_(){return this.vxs_}xxs_(t){this.vxs_.vs_(t.getX(),t.getY())}Ne_(){return this.Sxs_}Lxs_(t){this.Sxs_.vs_(t.getX(),t.getY())}ve_(){return this.bxs_}Uxs_(t){this.bxs_.vs_(t.getX(),t.getY())}be_(){return this.Nxs_}Yxs_(t){this.Nxs_.vs_(t.getX(),t.getY())}Mcs_(){return this._r.Ee_()}Txs_(t){const i=Math.min(this._r.pe_(),t);this._r.ce_(this._r.we_(),i,this._r.Qe_(),this._r.pe_());this.update()}vcs_(){return this._r.pe_()}Kxs_(t){const i=Math.max(this._r.Ee_(),t);this._r.ce_(this._r.we_(),this._r.Ee_(),this._r.Qe_(),i);this.update()}Hxs_(){return this._r}qxs_(t){this._r=t}getBounds(){const t=undefined;return new mA(this.Me_().getX(),this.Me_().getY(),this.Ne_().getX(),this.Ne_().getY()).union(new mA(this.be_().getX(),this.be_().getY(),this.ve_().getX(),this.ve_().getY()))}iE_(){return this.Gxs_}Jxs_(t){this.Gxs_=t}sE_(){return this.Rxs_}Pxs_(t){this.Rxs_=t}Vxs_(){return this.Fxs_}Oxs_(t){this.kxs_=t}offset(t){const i=t.getX(),s=t.getY();this.vxs_.vs_(this.vxs_.getX()+i,this.vxs_.getY()+s);this.bxs_.vs_(this.bxs_.getX()+i,this.bxs_.getY()+s);this.Nxs_.vs_(this.Nxs_.getX()+i,this.Nxs_.getY()+s);this.Sxs_.vs_(this.Sxs_.getX()+i,this.Sxs_.getY()+s)}update(){this.Mxs_()}qFs_(t,i){let s=null;if(this.Fxs_&&this.kxs_!=null){const e=this.uI_(t),A=this._r.pe_(),n=this._r.Ee_(),h=A-n,r=undefined;s=(e.y-n)/h<0?this.kxs_.qFs_(t,i):this.Dxs_(t,i)}else s=this.Dxs_(t,i);return s}Wxs_(){const t=(this.vxs_.x+this.bxs_.x)/2,i=(this.vxs_.y+this.bxs_.y)/2,s=(this.Sxs_.x+this.Nxs_.x)/2,e=(this.Sxs_.y+this.Nxs_.y)/2;return Math.sqrt((t-s)*(t-s)+(i-e)*(i-e))}contains(t,i,s){if(t instanceof lA||typeof i!="number"||typeof i!="number"){ki("TrajectoryStation does not support these params");return!1}const e=new lA,A=this.Hxs_();if(t.xe_(this.Me_(),this.ve_(),e,e)>=0&&t.xe_(this.Ne_(),this.be_(),e,e)>=0){i>A.Ee_()&&(i=A.Ee_());s<A.pe_()&&(s=A.pe_());return{nIs_:i,hIs_:s,contain:!0}}const n=this.uI_(t.Me_()),h=this.uI_(t.ve_()),r=this.uI_(t.be_()),o=this.uI_(t.Ne_()),l=new mA(n.getX(),n.getY(),h.getX(),h.getY());l.union(new mA(r.getX(),r.getY(),o.getX(),o.getY()));l.intersect(A);if(!l.isEmpty()){i>l.Ee_()&&(i=l.Ee_());s<l.pe_()&&(s=l.pe_());return{nIs_:i,hIs_:s,contain:!0}}return{nIs_:i,hIs_:s,contain:!1}}};i=t([_s("geotoolkit.deviation.TrajectoryStation")],i);return i}();const vat=function(t,i,s){const e=(s-i)/100;if(i<=t&&t<=s)return t;if(t<i){if(i-t<e)return i}else if(t-s<e)return s;return NaN};var bat=function(){let i=class t extends Mat{constructor(t,i,s){super(i,s);this.oCi_=null;this.vQ_=new Gn;t!=null&&this.vQ_.dI_(t);this.zxs_=new Gn;this._p1=new lA;this._p2=new lA;this.Xxs_=2;this.jxs_=new lA}Zxs_(){return this.Xxs_}_xs_(){this.Xxs_--}$xs_(){this.Xxs_++}Wxs_(){return lA.Ss_(this._p1,this._p2)}tLs_(){return this._p1}iLs_(){return this._p2}DO_(){this.oCi_=this.oCi_||this.vQ_.rI_();return this.oCi_}Ji_(){return this.vQ_}dI_(t){this.vQ_.dI_(t);this.oCi_=null;this.Mxs_()}sLs_(t){this.zxs_.dI_(t)}offset(t){super.offset(t);const i=t.getX(),s=t.getY();this.vQ_.setTranslate(this.vQ_.EI_()+i,this.vQ_.pI_()+s);this.Vxs_()&&this.zxs_.setTranslate(this.zxs_.EI_()+i,this.zxs_.pI_()+s);this.oCi_=null;this._p1.vs_(this._p1.getX()+i,this._p1.getY()+s);this._p2.vs_(this._p2.getX()+i,this._p2.getY()+s)}contains(t,i,s){if(t instanceof mA&&typeof i=="number")return super.contains(t,i,s);if(!(t instanceof lA))return!1;if(!this.Vxs_()){const s=this.DO_().transformPoint(t),e=this.Hxs_();if(e.contains(s)){i instanceof lA&&i.vs_(s.getX(),s.getY());return!0}const A=vat(s.getX(),e.we_(),e.Qe_());if(!NA.Ve_(A))return!1;const n=vat(s.getY(),e.Ee_(),e.pe_());if(!NA.Ve_(n))return!1;i instanceof lA&&i.vs_(A,n);return!0}if(this.Me_().getY()<=this.Ne_().getY()==this.ve_().getY()<=this.be_().getY())return aat.sxs_(t,this.Ne_(),this.be_(),this.ve_(),this.Me_());const e=new lA;return!!aat.exs_(this.Me_(),this.ve_(),this.Ne_(),this.be_(),e)&&(aat.Axs_(t,this.Me_(),this.Ne_(),e)||aat.Axs_(t,this.ve_(),this.be_(),e))}uI_(t){if(!this.Vxs_())return this.DO_().transformPoint(t);const i=new lA,s=new lA;if(!aat.exs_(this.Me_(),this.ve_(),this.Ne_(),this.be_(),i))return t.clone();if(!aat.exs_(this._p1,this._p2,i,t,s))return t.clone();if(s.getY()<Math.min(this._p1.getY(),this._p2.getY()))return this.Hxs_().Me_();if(s.getY()>Math.max(this._p1.getY(),this._p2.getY()))return this.Hxs_().be_();const e=aat.getLength(this.jxs_.vs_(this._p2.getX()-this._p1.getX(),this._p2.getY()-this._p1.getY())),A=Math.abs(e)>NA.Je_?aat.getLength(this.jxs_.vs_(s.getX()-this._p1.getX(),s.getY()-this._p1.getY()))/e:Number.MAX_VALUE,n=A*this.vQ_.BI_()+(1-A)*this.zxs_.BI_(),h=Math.abs(n)<=NA.Je_?Number.MAX_VALUE:(t.getX()-A*(this.vQ_.wI_()*this.Hxs_().pe_()+this.vQ_.EI_())-(1-A)*(this.zxs_.wI_()*this.Hxs_().Ee_()+this.zxs_.EI_()))/n,r=A*this.Hxs_().pe_()+(1-A)*this.Hxs_().Ee_();return new lA(h,r)}transform(t,i){if(!this.Vxs_())return this.vQ_.transformPoint(t);const s=this.Hxs_().pe_(),e=this.Hxs_().Ee_(),A=s-e;if(Math.abs(A)<NA.Je_)return t.getY()<e?this.zxs_.transformPoint(t):this.vQ_.transformPoint(t);const n=(t.getY()-e)/A;if(n<=0)return this.zxs_.transformPoint(t);if(n>=1)return this.vQ_.transformPoint(t);const h=this.zxs_.BI_()*t.getX()+this.zxs_.wI_()*e+this.zxs_.EI_(),r=this.vQ_.BI_()*t.getX()+this.vQ_.wI_()*s+this.vQ_.EI_(),o=this.zxs_.QI_()*t.getX()+this.zxs_.sI_()*e+this.zxs_.pI_(),l=this.vQ_.QI_()*t.getX()+this.vQ_.sI_()*s+this.vQ_.pI_();return new lA((r-h)*n+h,(l-o)*n+o)}update(){super.update();this.oCi_=null;const t=this.Hxs_(),i=this.Vxs_()?this.zxs_:this.vQ_;this._p1=i.transformPoint(new lA(t.ye_(),t.Ee_()));this._p2=this.vQ_.transformPoint(new lA(t.ye_(),t.pe_()));this.xxs_(i.transformPoint(t.Me_()));this.Uxs_(i.transformPoint(t.ve_()));this.Yxs_(this.vQ_.transformPoint(t.be_()));this.Lxs_(this.vQ_.transformPoint(t.Ne_()));this.vQ_.BI_()===0?this.Jxs_(Math.abs(this.vQ_.QI_())):this.vQ_.QI_()===0?this.Jxs_(Math.abs(this.vQ_.BI_())):this.Jxs_(Math.sqrt(this.vQ_.BI_()*this.vQ_.BI_()+this.vQ_.QI_()*this.vQ_.QI_()));this.vQ_.sI_()===0?this.Pxs_(Math.abs(this.vQ_.wI_())):this.vQ_.wI_()===0?this.Pxs_(Math.abs(this.vQ_.sI_())):this.Pxs_(Math.sqrt(this.vQ_.sI_()*this.vQ_.sI_()+this.vQ_.wI_()*this.vQ_.wI_()));if(this.Vxs_()){this.zxs_.BI_()===0?this.Jxs_(Math.max(this.iE_(),Math.abs(this.zxs_.QI_()))):this.zxs_.QI_()===0?this.Jxs_(Math.max(this.iE_(),Math.abs(this.zxs_.BI_()))):this.Jxs_(Math.max(this.iE_(),Math.sqrt(this.zxs_.BI_()*this.zxs_.BI_()+this.zxs_.QI_()*this.zxs_.QI_())));this.zxs_.sI_()===0?this.Pxs_(Math.max(this.sE_(),Math.abs(this.zxs_.wI_()))):this.zxs_.wI_()===0?this.Pxs_(Math.max(this.sE_(),Math.abs(this.zxs_.sI_()))):this.Pxs_(Math.max(this.sE_(),Math.sqrt(this.zxs_.sI_()*this.zxs_.sI_()+this.zxs_.wI_()*this.zxs_.wI_())))}}KFs_(t){if(!this.Vxs_())return this.vQ_.BI_()===0?Math.abs(this.vQ_.QI_()):this.vQ_.QI_()===0?Math.abs(this.vQ_.BI_()):Math.sqrt(this.vQ_.BI_()*this.vQ_.BI_()+this.vQ_.QI_()*this.vQ_.QI_());const i=this.eLs_(t);return i.BI_()===0?Math.abs(i.QI_()):i.QI_()===0?Math.abs(i.BI_()):Math.sqrt(i.BI_()*i.BI_()+i.QI_()*i.QI_())}HFs_(t){if(!this.Vxs_())return this.vQ_.sI_()===0?Math.abs(this.vQ_.wI_()):this.vQ_.wI_()===0?Math.abs(this.vQ_.sI_()):Math.sqrt(this.vQ_.sI_()*this.vQ_.sI_()+this.vQ_.wI_()*this.vQ_.wI_());const i=this.eLs_(t);return i.sI_()===0?Math.abs(i.wI_()):i.wI_()===0?Math.abs(i.sI_()):Math.sqrt(i.sI_()*i.sI_()+i.wI_()*i.wI_())}eLs_(t){if(!this.Vxs_())return this.vQ_;const i=this.Hxs_().pe_(),s=this.Hxs_().Ee_(),e=i-s;if(Math.abs(e)<NA.Je_)return t.getY()<s?this.zxs_:this.vQ_;const A=(t.getY()-s)/e;if(A<=0)return this.zxs_;if(A>=1)return this.vQ_;if(Math.abs(t.getY())<=NA.Je_){const t=this.vQ_.wI_()*i+this.vQ_.EI_(),n=this.vQ_.sI_()*i+this.vQ_.pI_(),h=this.zxs_.wI_()*s+this.zxs_.EI_(),r=this.zxs_.sI_()*s+this.zxs_.pI_();return new Gn(this.vQ_.BI_()*A+this.zxs_.BI_()*(1-A),this.vQ_.QI_()*A+this.zxs_.QI_()*(1-A),(t-h)/e,(n-r)/e,(h*i-t*s)/e,(r*i-n*s)/e)}return new Gn(this.vQ_.BI_()*A+this.zxs_.BI_()*(1-A),this.vQ_.QI_()*A+this.zxs_.QI_()*(1-A),(this.vQ_.wI_()*A*i+this.zxs_.wI_()*(1-A)*s)/t.getY(),(this.vQ_.sI_()*A*i+this.zxs_.sI_()*(1-A)*s)/t.getY(),this.vQ_.EI_()*A+this.zxs_.EI_()*(1-A),this.vQ_.pI_()*A+this.zxs_.pI_()*(1-A))}xFs_(t,i,s,e,A){const n=this.Hxs_(),h=NA.Je_;n.Ee_()<=t.getY()+h&&n.pe_()>=t.getY()-h&&aat.ixs_(e,this.transform(t),s,A);n.Ee_()>t.getY()-h&&n.Ee_()<i.getY()+h&&aat.ixs_(e,this.transform(aat.hxs_(t,i,n.Ee_())),s,A);n.pe_()>t.getY()-h&&n.pe_()<i.getY()+h&&aat.ixs_(e,this.transform(aat.hxs_(t,i,n.pe_())),s,A);n.Ee_()<=i.getY()+h&&n.pe_()>=i.getY()-h&&aat.ixs_(e,this.transform(i),s,A)}ALs_(t,i,s,e,A){const n=this.Hxs_();n.Ee_()<=t.getY()&&n.pe_()>=t.getY()&&aat.ixs_(e,this.transform(t),s,A);n.pe_()>i.getY()&&n.pe_()<t.getY()&&aat.ixs_(e,this.transform(aat.hxs_(t,i,n.pe_())),s,A);n.Ee_()>i.getY()&&n.Ee_()<t.getY()&&aat.ixs_(e,this.transform(aat.hxs_(t,i,n.Ee_())),s,A);n.Ee_()<=i.getY()&&n.pe_()>=i.getY()&&aat.ixs_(e,this.transform(i),s,A)}static nLs_(t,i,s,e,A,n,h){h=0;if(t.Vxs_()||i.Vxs_())return{tooShort:h,hLs_:s,rLs_:!1};let r,o;const l=aat.$Fs_(new lA(i.Ne_().getX()-i.Me_().getX(),i.Ne_().getY()-i.Me_().getY()),new lA(t.Ne_().getX()-t.Me_().getX(),t.Ne_().getY()-t.Me_().getY()));if(Math.abs(l)<NA.Je_)return{tooShort:h,hLs_:s,rLs_:!1};if(s=l<0){r=new cat(t.Me_(),t.Ne_());o=new cat(i.Me_(),i.Ne_())}else{r=new cat(t.ve_(),t.be_());o=new cat(i.ve_(),i.be_())}if(cat.pxs_(r,o))return{tooShort:h,hLs_:s,rLs_:!1};let u=cat.gr_(o,r);e.vs_(u.getX(),u.getY());u=t.uI_(e);A.vs_(u.getX(),u.getY());u=i.uI_(e);n.vs_(u.getX(),u.getY());if(t.Mcs_()>=A.getY()||i.vcs_()<=n.getY())return{tooShort:h=t.Mcs_()>=A.getY()?i.vcs_()<=n.getY()?-3:-2:-1,hLs_:s,rLs_:!1};t.vcs_()<A.getY()&&i.Mcs_()>n.getY()&&(h=1);return{tooShort:h,hLs_:s,rLs_:!0}}};i=t([_s("geotoolkit.deviation.LinearTrajectoryStation")],i);return i}();const Nat=function(t,i,s){return Math.abs(t.getY()-s)<=NA.Je_?t.getX():Math.abs(i.getY()-s)<=NA.Je_?i.getX():Math.abs(t.getY()-i.getY())<=NA.Je_?(t.getX()+i.getX())/2:t.getX()+(i.getX()-t.getX())*(s-t.getY())/(i.getY()-t.getY())},Sat=function(t,i,s){return new lA(Nat(t,i,s),s)},Gat=function(t,i,s,e,A){const n=aat.txs_(i,t,e);if(A<0){if(n<0&&n>A)return-n}else if(n>0&&n<A)return n;return 0},Rat=function(t,i,s,e,A,n,h,r){if(lA.Ss_(h,i)<lA.Ss_(e,i)||lA.Ss_(h,i)<lA.Ss_(A,i))return;const o=Gat(i,e,A,h,r);o>0&&t.push({key:o,Tgt_:h})},kat=function(t,i){return t.key>=i.key?1:-1},Fat=function(t,i,s){if(t.getY()<i.getY()){if(s.getY()<t.getY()||s.getY()>i.getY())return!1}else if(s.getY()>t.getY()||s.getY()<i.getY())return!1;if(t.getX()<i.getX()){if(s.getX()<t.getX()||s.getX()>i.getX())return!1}else if(s.getX()>t.getX()||s.getX()<i.getX())return!1;return!0},xat=function(t,i,s,e,A){return aat.exs_(t,i,s,e,A)?Fat(t,i,A)?Fat(s,e,A)?3:1:Fat(s,e,A)?2:0:-1};var Lat=function(){var i;let s=i=class t extends Mat{constructor(){super(new mA,!0);this.oLs_=[];this._a=null;this._b=null;this.lLs_=0;this.uLs_=[];this.aLs_=[];this.gLs_=[];this.cLs_=[];this.ILs_=0;this.fLs_=0;this.Jxs_(1);this.Pxs_(1);this.CLs_=[];this.T2_=new lA;this.dLs_=!1;this._o=new lA;this.BLs_=new lA;this.wLs_=new lA;this.QLs_=0;this.ELs_=0;this.bf_=new mA}static pLs_(t,s,e,A,n){const h=new i;h._b=t;h._a=s;if(!h.mLs_())return{yLs_:null,tooShort:e=h.DLs_()};e=h.DLs_();h.oLs_=h.oLs_.concat(A);h.update();return{yLs_:h,tooShort:e}}DLs_(){return this.lLs_}getBounds(){return this.bf_}append(t,i,s,e){t=t.clone();i=i.clone();let A,n;if(s){if(this.uLs_.length>0&&this.aLs_.length>0){A=lA.Ss_(t,this.uLs_[this.uLs_.length-1]);n=lA.Ss_(i,this.aLs_[this.aLs_.length-1]);if(A<1&&n<1)return;const h=new lA;if(this.uLs_.length>1&&this.aLs_.length>1){if(A>1&&xat(t,this.uLs_[this.uLs_.length-1],this.uLs_[0],s,h)>0)return;if(n>1&&xat(i,this.aLs_[this.aLs_.length-1],this.aLs_[0],e,h)>0)return}if(Math.abs(A-n)>1&&(A>2||n>2)){const s=A>n,e=s?aat.int(A):aat.int(n),h=this.uLs_[this.uLs_.length-1],r=this.aLs_[this.aLs_.length-1];let o=lA.Ss_(this.uLs_[this.uLs_.length-1],this.aLs_[this.aLs_.length-1]);const l=(lA.Ss_(t,i)-o)/(s?A:n);let u=h.clone(),a=r.clone();for(let A=1;A<e;++A){o+=l;s?u=new lA(h.getX()+(t.getX()-h.getX())*A/e,h.getY()+(t.getY()-h.getY())*A/e):a=new lA((i.getX()*A+r.getX()*(e-A))/e,(i.getY()*A+r.getY()*(e-A))/e);const n=lA.Ss_(u,a);n<o+1&&(s?u=new lA((a.getX()*(n-o)+u.getX()*o)/n,(a.getY()*(n-o)+u.getY()*o)/n):a=new lA((u.getX()*(n-o)+a.getX()*o)/n,(u.getY()*(n-o)+a.getY()*o)/n));this.gLs_.push(lA.Ss_(u,this.uLs_[this.uLs_.length-1]));this.ILs_+=this.gLs_[this.gLs_.length-1];this.cLs_.push(lA.Ss_(a,this.aLs_[this.aLs_.length-1]));this.fLs_+=this.cLs_[this.cLs_.length-1];this.uLs_.push(u);this.aLs_.push(a);this.bf_.union(new mA(u.getX(),u.getY(),a.getX(),a.getY()))}A=lA.Ss_(t,this.uLs_[this.uLs_.length-1]);n=lA.Ss_(i,this.aLs_[this.aLs_.length-1])}this.gLs_.push(A);this.ILs_+=this.gLs_[this.gLs_.length-1];this.cLs_.push(n);this.fLs_+=this.cLs_[this.cLs_.length-1];this.bf_.union(new mA(t.getX(),t.getY(),i.getX(),i.getY()))}else this.bf_=new mA(t.getX(),t.getY(),i.getX(),i.getY());this.uLs_.push(t);this.aLs_.push(i)}else{if(this.uLs_.length>0&&this.aLs_.length>0){A=lA.Ss_(t,this.uLs_[this.uLs_.length-1]);n=lA.Ss_(i,this.aLs_[this.aLs_.length-1]);if(A<1&&n<1)return;this.gLs_.push(A);this.ILs_+=this.gLs_[this.gLs_.length-1];this.cLs_.push(n);this.fLs_+=this.cLs_[this.cLs_.length-1];this.uLs_.length>0&&this.aLs_.length>0?this.bf_.union(new mA(t.getX(),t.getY(),i.getX(),i.getY())):this.bf_=new mA(t.getX(),t.getY(),i.getX(),i.getY())}this.uLs_.push(t);this.aLs_.push(i)}}prepend(t,i){if(this.uLs_.length>0&&this.aLs_.length>0){const s=lA.Ss_(t,this.uLs_[0]),e=lA.Ss_(i,this.aLs_[0]);if(s<1&&e<1)return;this.gLs_.unshift(s);this.ILs_+=this.gLs_[0];this.cLs_.unshift(e);this.fLs_+=this.cLs_[0];this.uLs_.length>0&&this.aLs_.length>0?this.bf_.union(new mA(t.getX(),t.getY(),i.getX(),i.getY())):this.bf_=new mA(t.getX(),t.getY(),i.getX(),i.getY())}this.uLs_.unshift(t);this.aLs_.unshift(i)}mLs_(){const t=bat.nLs_(this._b,this._a,this.dLs_,this._o,this.wLs_,this.BLs_,this.lLs_);this.lLs_=t.tooShort;this.dLs_=t.hLs_;if(!t.rLs_)return!1;this.ELs_=this._b.vcs_();this.QLs_=this._a.Mcs_();this._b.Kxs_(this.wLs_.getY());this._a.Txs_(this.BLs_.getY());this.lLs_=0;this.qxs_(new mA(this._b.Hxs_().we_(),this._b.Hxs_().pe_(),this._a.Hxs_().Qe_(),this._a.Hxs_().Ee_()));return!0}reset(){this._b.Kxs_(this.ELs_);this._a.Txs_(this.QLs_)}Wxs_(){return(this.ILs_+this.fLs_)/2}MLs_(t){if(this.uLs_.length===0||this.Hxs_().Ts_()<=0||this.Hxs_().Ie_()<=0)return-1;const i=new lA(t.getX()-this.T2_.getX(),t.getY()-this.T2_.getY());if(Math.abs(i.getX()-Nat(this.uLs_[0],this.aLs_[0],i.getY()))<=NA.Je_)return 0;for(let t=1;t<this.uLs_.length;++t)if(this.uLs_[t-1].getX()===this.uLs_[t].getX()&&this.uLs_[t-1].getY()===this.uLs_[t].getY()){if(aat.Axs_(i,this.uLs_[t],this.aLs_[t],this.aLs_[t-1]))return t}else if(this.aLs_[t-1].getX()===this.aLs_[t].getX()&&this.aLs_[t-1].getY()===this.aLs_[t].getY()){if(aat.Axs_(i,this.aLs_[t],this.uLs_[t],this.uLs_[t-1]))return t}else if(aat.sxs_(i,this.aLs_[t-1],this.aLs_[t],this.uLs_[t],this.uLs_[t-1]))return t;return-1}contains(t,i,s){if(t instanceof lA)return this.MLs_(t)>=0;if(typeof i!="number"||typeof i!="number"){ki("TrajectoryStation does not support these params");return!1}const e=new lA,A=new lA,n=new mA(t.Me_().getX()-this.T2_.getX(),t.Me_().getY()-this.T2_.getY(),t.be_().getX()-this.T2_.getX(),t.be_().getY()-this.T2_.getY());let h=!1,r=!1,o=0,l=this.uLs_.length-1,u=o,a=l;while((h===!1||r===!1)&&o<l){if(!h){if(r){a>l&&(a=l);if(o>=a){o>a&&(o=a);h=!0;break}}if(n.xe_(this.uLs_[o],this.aLs_[o],e,A)>=0)if(o-1<=u)h=!0;else{a=o;o=aat.int((o+u)/2)}else if(r){if(o+1>=a){o=a;h=!0;break}u=o;o=aat.int((o+a)/2)}else o++}if(!r){if(h){u<o&&(u=o);if(l<=u){l<u&&(l=u);r=!0;break}}if(n.xe_(this.uLs_[l],this.aLs_[l],e,A)>=0)if(l+1>=a)r=!0;else{u=l;l=aat.int((l+a)/2)}else if(h){if(l-1<=u){l=u;r=!0;break}a=l;l=aat.int((l+u)/2)}else l--}}if(!h&&!r)return{nIs_:i,hIs_:s,contain:!1};if(h){o>0&&o--;i>this.CLs_[o]&&(i=this.CLs_[o])}if(r){l<this.CLs_.length-1&&l++;s<this.CLs_[l]&&(s=this.CLs_[l])}return{nIs_:i,hIs_:s,contain:!0}}update(){super.update();this.gLs_=[];this.cLs_=[];this.ILs_=0;this.fLs_=0;if(this.lLs_<0)return;const t=[];let i,s;if(this.dLs_){i=aat.txs_(this._b.be_(),this._o,this._a.ve_());this.lLs_===0&&Rat(t,this._o,this._b.ve_(),this._b.be_(),this._a.ve_(),this._a.be_(),this._b.transform(new lA(this.Hxs_().Qe_(),this.ELs_)),i);for(s=0;s<this.oLs_.length;++s){Rat(t,this._o,this._b.ve_(),this._b.be_(),this._a.ve_(),this._a.be_(),this.oLs_[s].ve_(),i);Rat(t,this._o,this._b.ve_(),this._b.be_(),this._a.ve_(),this._a.be_(),this.oLs_[s].be_(),i)}this.lLs_===0&&Rat(t,this._o,this._b.ve_(),this._b.be_(),this._a.ve_(),this._a.be_(),this._a.transform(new lA(this.Hxs_().Qe_(),this.QLs_)),i);t.sort(kat);this.append(this._o,this._b.be_());if(t.length===0)this.append(this._o,this._a.ve_(),this._o,this._a.ve_());else{this.append(this._o,t[0].Tgt_);for(let i=1;i<t.length;i++)this.append(this._o,t[i].Tgt_,this._o,this._a.ve_());this.append(this._o,this._a.ve_())}}else{i=aat.txs_(this._b.Ne_(),this._o,this._a.Me_());this.lLs_===0&&Rat(t,this._o,this._b.Me_(),this._b.Ne_(),this._a.Me_(),this._a.Ne_(),this._b.transform(new lA(this.Hxs_().we_(),this.ELs_)),i);for(s=0;s<this.oLs_.length;++s){Rat(t,this._o,this._b.Me_(),this._b.Ne_(),this._a.Me_(),this._a.Ne_(),this.oLs_[s].Me_(),i);Rat(t,this._o,this._b.Me_(),this._b.Ne_(),this._a.Me_(),this._a.Ne_(),this.oLs_[s].Ne_(),i)}this.lLs_===0&&Rat(t,this._o,this._b.Me_(),this._b.Ne_(),this._a.Me_(),this._a.Ne_(),this._a.transform(new lA(this.Hxs_().we_(),this.QLs_)),i);t.sort(kat);this.append(this._b.Ne_(),this._o);if(t.length===0)this.append(this._a.Me_(),this._o,this._a.Me_(),this._o);else{this.append(t[0].Tgt_,this._o);for(let i=1;i<t.length;i++)this.append(t[i].Tgt_,this._o,this._a.Me_(),this._o);this.append(this._a.Me_(),this._o)}}}vLs_(){if(this.lLs_<0)return;this.qxs_(new mA(this._b.Hxs_().we_(),this._b.Hxs_().pe_(),this._a.Hxs_().Qe_(),this._a.Hxs_().Ee_()));this.CLs_=[];if(this.uLs_.length<=1)return;this.xxs_(new lA(this.uLs_[0].getX()+this.T2_.getX(),this.uLs_[0].getY()+this.T2_.getY()));this.Uxs_(new lA(this.aLs_[0].getX()+this.T2_.getX(),this.aLs_[0].getY()+this.T2_.getY()));this.Yxs_(new lA(this.aLs_[this.aLs_.length-1].getX()+this.T2_.getX(),this.aLs_[this.aLs_.length-1].getY()+this.T2_.getY()));this.Lxs_(new lA(this.uLs_[this.uLs_.length-1].getX()+this.T2_.getX(),this.uLs_[this.uLs_.length-1].getY()+this.T2_.getY()));if(this.Hxs_().Ts_()<=0||this.Hxs_().Ie_()<=0)return;let t=this.Hxs_().Ee_();this.CLs_.push(t);for(let i=0;i<this.gLs_.length-1;++i){const s=undefined;t+=(this.gLs_[i]+this.cLs_[i])/(this.ILs_+this.fLs_)*this.Hxs_().Ts_();if(t>this.Hxs_().pe_())break;this.CLs_.push(t)}this.CLs_.push(this.Hxs_().pe_())}bLs_(t){if(this.Hxs_().Ts_()<=0||this.CLs_.length<=1)return-1;let i=0,s=this.CLs_.length-1,e,A;if(t.getY()<=this.CLs_[0])return 0;if(t.getY()>=this.CLs_[s])return s;while(s-i>1){e=i+s>>1;A=this.CLs_[e]-t.getY();if(Math.abs(A)<=NA.Je_)return e;A<0?i=e:s=e}return s}transform(t,i){let s,e,A,n,h;if(i==null){if(t.getY()>=this.Hxs_().Ee_()&&t.getY()<=this.Hxs_().pe_()){s=new lA;const i=this.Hxs_();e=(t.getX()-i.we_())/i.Ie_();if(Math.abs(t.getY()-i.Ee_())<=NA.Je_){s.setX(this.uLs_[0].getX()+(this.aLs_[0].getX()-this.uLs_[0].getX())*e);s.setY(this.uLs_[0].getY()+(this.aLs_[0].getY()-this.uLs_[0].getY())*e)}else if(Math.abs(t.getY()-i.pe_())<=NA.Je_){s.setX(this.uLs_[this.uLs_.length-1].getX()+(this.aLs_[this.aLs_.length-1].getX()-this.uLs_[this.uLs_.length-1].getX())*e);s.setY(this.uLs_[this.uLs_.length-1].getY()+(this.aLs_[this.aLs_.length-1].getY()-this.uLs_[this.uLs_.length-1].getY())*e)}else{const i=this.bLs_(t);if(i>0&&i<this.uLs_.length){A=(t.getY()-this.CLs_[i-1])/(this.CLs_[i]-this.CLs_[i-1]);n=new lA(this.uLs_[i-1].getX()+(this.uLs_[i].getX()-this.uLs_[i-1].getX())*A,this.uLs_[i-1].getY()+(this.uLs_[i].getY()-this.uLs_[i-1].getY())*A);h=new lA(this.aLs_[i-1].getX()+(this.aLs_[i].getX()-this.aLs_[i-1].getX())*A,this.aLs_[i-1].getY()+(this.aLs_[i].getY()-this.aLs_[i-1].getY())*A);s.setX(n.getX()+(h.getX()-n.getX())*e);s.setY(n.getY()+(h.getY()-n.getY())*e)}else{s.setX(this.uLs_[0].getX()+(this.aLs_[0].getX()-this.uLs_[0].getX())*e);s.setY(this.uLs_[0].getY()+(this.aLs_[0].getY()-this.uLs_[0].getY())*e)}}return new lA(s.getX()+this.T2_.getX(),s.getY()+this.T2_.getY())}return t}if(this.Hxs_().Ts_()<=0||this.CLs_.length<=1)return t;e=(t.getX()-this.Hxs_().we_())/this.Hxs_().Ie_();s=new lA;if(Math.abs(this.CLs_[i]-t.getY())<=NA.Je_||i<=0){s.setX(this.uLs_[i].getX()+(this.aLs_[i].getX()-this.uLs_[i].getX())*e);s.setY(this.uLs_[i].getY()+(this.aLs_[i].getY()-this.uLs_[i].getY())*e)}else{A=(t.getY()-this.CLs_[i-1])/(this.CLs_[i]-this.CLs_[i-1]);n=new lA(this.uLs_[i-1].getX()+(this.uLs_[i].getX()-this.uLs_[i-1].getX())*A,this.uLs_[i-1].getY()+(this.uLs_[i].getY()-this.uLs_[i-1].getY())*A);h=new lA(this.aLs_[i-1].getX()+(this.aLs_[i].getX()-this.aLs_[i-1].getX())*A,this.aLs_[i-1].getY()+(this.aLs_[i].getY()-this.aLs_[i-1].getY())*A);s.setX(n.getX()+(h.getX()-n.getX())*e);s.setY(n.getY()+(h.getY()-n.getY())*e)}return new lA(s.getX()+this.T2_.getX(),s.getY()+this.T2_.getY())}xFs_(t,i,s,e,A){if(this.Hxs_().Ts_()<=0||this.Hxs_().Ee_()>=i.getY()||this.Hxs_().pe_()<=t.getY()||this.CLs_.length<=1)return;let n=this.bLs_(t);const h=this.bLs_(i);if(n===0){aat.ixs_(e,this.transform(Sat(t,i,this.CLs_[0]),0),s,A);++n}else aat.ixs_(e,this.transform(t,n),s,A);for(let r=n;r<h;++r){const n=Sat(t,i,this.CLs_[r]);aat.ixs_(e,this.transform(n,r),s,A)}this.CLs_[h]<i.getY()?aat.ixs_(e,this.transform(Sat(t,i,this.CLs_[h]),h),s,A):aat.ixs_(e,this.transform(i,h),s,A)}ALs_(t,i,s,e,A){if(this.Hxs_().Ts_()<=0||this.Hxs_().Ee_()>=t.getY()||this.Hxs_().pe_()<=i.getY()||this.CLs_.length<=1)return;const n=this.bLs_(t),h=this.bLs_(i);this.CLs_[n]<t.getY()?aat.ixs_(e,this.transform(Sat(t,i,this.CLs_[n]),n),s,A):aat.ixs_(e,this.transform(t,n),s,A);for(let r=n;r>h;--r){const n=Sat(t,i,this.CLs_[r-1]);aat.ixs_(e,this.transform(n,r-1),s,A)}h>0&&aat.ixs_(e,this.transform(i,h),s,A)}uI_(t){if(this.Hxs_().Ts_()<=0||this.CLs_.length<=1)return new lA(t.getX()-this.T2_.getX(),t.getY()-this.T2_.getY());const i=this.MLs_(t);if(i<0)return new lA(t.getX()-this.T2_.getX(),t.getY()-this.T2_.getY());const s=this.Hxs_(),e=s.Me_(),A=new lA(t.getX()-this.T2_.getX(),t.getY()-this.T2_.getY());if(i===0)e.setX(e.getX()+s.Ie_()*lA.Ss_(this.uLs_[0],A)/lA.Ss_(this.uLs_[0],this.aLs_[0]));else{e.setY(this.CLs_[i-1]);const t=this.CLs_[i]-this.CLs_[i-1],n=new lA;if(this.uLs_[i-1].getX()===this.uLs_[i].getX()&&this.uLs_[i-1].getY()===this.uLs_[i].getY()){if(aat.exs_(this.uLs_[i],A,this.aLs_[i-1],this.aLs_[i],n)){e.setY(e.getY()+t*lA.Ss_(n,this.aLs_[i-1])/this.cLs_[i-1]);e.setX(e.getX()+s.Ie_()*lA.Ss_(A,this.uLs_[i])/lA.Ss_(n,this.uLs_[i]))}}else if(this.aLs_[i-1].getX()===this.aLs_[i].getX()&&this.aLs_[i-1].getY()===this.aLs_[i].getY()){if(aat.exs_(this.aLs_[i],A,this.uLs_[i-1],this.uLs_[i],n)){e.setY(e.getY()+t*lA.Ss_(n,this.uLs_[i-1])/this.gLs_[i-1]);e.setX(e.getX()+s.Ie_()*lA.Ss_(A,n)/lA.Ss_(n,this.aLs_[i]))}}else{const h=new lA,r=new lA;aat.exs_(this.uLs_[i-1],this.aLs_[i-1],this.uLs_[i],this.aLs_[i],n)||n.vs_(A.getX()-this.aLs_[i-1].getX()+this.uLs_[i-1].getX(),A.getY()-this.aLs_[i-1].getY()+this.uLs_[i-1].getY());if(aat.exs_(n,A,this.uLs_[i-1],this.uLs_[i],h)&&aat.exs_(n,A,this.aLs_[i-1],this.aLs_[i],r)){e.setY(e.getY()+t*(lA.Ss_(h,this.uLs_[i-1])/this.gLs_[i-1]+lA.Ss_(r,this.aLs_[i-1])/this.cLs_[i-1])/2);e.setX(e.getX()+s.Ie_()*lA.Ss_(A,h)/lA.Ss_(r,h))}}}return e}KFs_(t){const i=t.clone();i.setX(i.getX()+1);return Math.abs(this.uI_(i).getX()-this.uI_(t).getX())}HFs_(t){const i=t.clone();i.setY(i.getY()+1);return Math.abs(this.uI_(i).getY()-this.uI_(t).getY())}offset(t){this.T2_.vs_(this.T2_.getX()+t.getX(),this.T2_.getY()+t.getY());super.offset(t)}};s=i=t([_s("geotoolkit.deviation.OutlineTrajectoryStation")],s);return s}();var Uat=function(){var t=class{constructor(t,i,s){this.pt=t;this.NLs_=i;this.SLs_=s!==void 0?s:-1}};return t}(),Yat=function(){let i=class t{constructor(t){this.GLs_=t}RLs_(t,i){const s=[];s.push(new Uat(t,this.GLs_.transform(t),1));s.push(new Uat(i,this.GLs_.transform(i),-1));let e=0;while(s[e].SLs_!==-1){const t=s[e],i=s[t.SLs_];let A=lA.Ss_(t.NLs_,i.NLs_);if(A<1){e=t.SLs_;continue}const n=new lA((t.pt.getX()+i.pt.getX())/2,(t.pt.getY()+i.pt.getY())/2),h=this.GLs_.transform(n),r=t.SLs_,o=undefined;A=new cat(t.NLs_,i.NLs_).distance(h);if(Math.abs(A)<.5)e=t.SLs_;else{t.SLs_=s.length;s.push(new Uat(n,h,r))}}return s}};i=t([_s("geotoolkit.deviation.PiecewiseApproximator")],i);return i}();var Tat=function(){var i;let s=i=class t extends Mat{constructor(){super(new mA,!0);this.kLs_=null;this.FLs_=null;this._o=null;this._pl=null;this._nl=null;this._w0=null;this._w1=null;this.Xz_=null;this.xLs_=null;this.LLs_=null;this.ULs_=null;this.i9i_=null;this.YLs_=new Yat(this);this.TLs_=null;this.dVt_=null;this.yBt_=NaN;this.bf_=null}Wxs_(){return this.yBt_}getBounds(){return this.bf_}static KLs_(t,s,e){let A=null;const n=new lA,h=new lA,r=new lA,o=bat.nLs_(t,s,A,n,h,r,e);A=o.hLs_;e=o.tooShort;if(!o.rLs_)return{yLs_:null,tooShort:e};t.Kxs_(h.getY());s.Txs_(r.getY());let l=A?t.be_():t.Ne_();const u=new lA(l.getX()-n.getX(),l.getY()-n.getY());l=A?s.ve_():s.Me_();const a=new lA(l.getX()-n.getX(),l.getY()-n.getY()),g=Math.atan2(u.getY(),u.getX()),c=Gn.FI_(-g,0,0),I=Gn.kI_(-n.getX(),-n.getY()),f=Gn.multiply(c,I),C=c.transformPoint(a),d=new i;d.ULs_=Math.atan2(C.getY(),C.getX());d.xLs_=f;d.LLs_=f.rI_();if(A){d._w0=t.Hxs_().we_();d._w1=t.Hxs_().Qe_()-d._w0}else{d._w0=t.Hxs_().Qe_();d._w1=t.Hxs_().we_()-d._w0}d._o=n;d.Xz_=lA.Ss_(u,new lA(0,0));d.i9i_=g;d.xxs_(t.Ne_());d.Uxs_(t.be_());d.Lxs_(s.Me_());d.Yxs_(s.ve_());d.yBt_=Math.abs(d.Xz_*d.ULs_/2);d.qxs_(new mA(t.Hxs_().Ne_().getX(),t.Hxs_().Ne_().getY(),s.Hxs_().ve_().getX(),s.Hxs_().ve_().getY()));const B=new cat(n,A?t.be_():t.Ne_()),w=new cat(n,A?s.ve_():s.Me_());let Q,E;if(B.distance(A?s.ve_():s.Me_())>0){d.kLs_=B;d.FLs_=w;if(A){Q=t.be_();E=s.ve_()}else{Q=t.Ne_();E=s.Me_()}}else{d.kLs_=w;d.FLs_=B;if(A){E=t.be_();Q=s.ve_()}else{E=t.Ne_();Q=s.Me_()}}d._pl=new lA(Q.getX(),Q.getY());d._nl=new lA(E.getX(),E.getY());d.bf_=new mA(t.Ne_().getX(),t.Ne_().getY(),t.be_().getX(),t.be_().getY());d.bf_.union(new mA(s.Me_().getX(),s.Me_().getY(),s.ve_().getX(),s.ve_().getY()));const p=new lA(n.getX()-d.Xz_,n.getY());d.contains(p)&&d.bf_.we_()>p.getX()&&d.bf_.setX(p.getX());const m=new lA(n.getX()+d.Xz_,n.getY());d.contains(m)&&d.bf_.Qe_()<m.getX()&&d.bf_.de_(m.getX()-d.bf_.we_());const y=new lA(n.getX(),n.getY()-d.Xz_);d.contains(y)&&d.bf_.Ee_()>y.getY()&&d.bf_.setY(y.getY());const D=new lA(n.getX(),n.getY()+d.Xz_);d.contains(D)&&d.bf_.pe_()<D.getY()&&d.bf_.Be_(D.getY()-d.bf_.Ee_());return{yLs_:d,tooShort:e}}update(t,i){if(!i||!t)throw new Error("PieSliceTrajectoryStation#update requires two Station");this.qxs_(new mA(t.Hxs_().we_(),t.vcs_(),t.Hxs_().Qe_(),i.Mcs_()))}offset(t){super.offset(t);const i=t.getX(),s=t.getY();this._o.vs_(this._o.getX()+i,this._o.getY()+s);this._pl.vs_(this._pl.getX()+i,this._pl.getY()+s);this._nl.vs_(this._nl.getX()+i,this._nl.getY()+s);const e=Gn.FI_(-this.i9i_,0,0),A=Gn.kI_(-this._o.getX(),-this._o.getY());this.xLs_=Gn.multiply(e,A);this.LLs_=this.xLs_.rI_();this.kLs_.zA_(this._o,this._pl);this.FLs_.zA_(this._o,this._nl)}contains(t,i,s){if(t instanceof lA)return lA.Ss_(this._o,t)-this.Xz_<NA.Je_&&this.kLs_.distance(t)>0&&this.FLs_.distance(t)<0;if(typeof i!="number"||typeof i!="number"){ki("TrajectoryStation does not support these params");return!1}const e=this.Hxs_();if(t.contains(this._o)||t.contains(this._pl)&&t.contains(this._nl)){i>e.Ee_()&&(i=e.Ee_());s<e.pe_()&&(s=e.pe_());return{nIs_:i,hIs_:s,contain:!0}}const A=this._o.clone();this._o.getY()<t.Ee_()?A.setY(t.Ee_()):this._o.getY()>t.pe_()&&A.setY(t.pe_());this._o.getX()<t.we_()?A.setX(t.we_()):this._o.getX()>t.Qe_()&&A.setX(t.Qe_());if(lA.Ss_(this._o,A)>this.Xz_)return{nIs_:i,hIs_:s,contain:!1};const n=super.contains(t,i,s);i=n.nIs_;s=n.hIs_;if(n.contain)return{nIs_:i,hIs_:s,contain:!0};if(!this.contains(A))return{nIs_:i,hIs_:s,contain:!1};let h=this.HLs_(t.we_(),t,i,s);h=this.HLs_(t.Qe_(),t,h.nIs_,h.hIs_);h=this.qLs_(t.Ee_(),t,h.nIs_,h.hIs_);h=this.qLs_(t.pe_(),t,h.nIs_,h.hIs_);return{nIs_:i=h.nIs_,hIs_:s=h.hIs_,contain:!0}}uI_(t){let i=t.getX(),s=t.getY();Math.abs(this.Xz_)>NA.Je_&&(i=this._w0+this._w1*(lA.Ss_(t,this._o)/this.Xz_));const e=this.xLs_.transformPoint(t);Math.abs(this.ULs_)>NA.Je_&&(s=this.Hxs_().Ee_()+Math.atan2(e.getY(),e.getX())/this.ULs_*this.Hxs_().Ts_());return new lA(i,s)}transform(t,i){const s=Math.abs(this._w1)>NA.Je_?(t.getX()-this._w0)/this._w1:t.getX()-this._w0,e=this.Hxs_().Ts_()>NA.Je_?(t.getY()-this.Hxs_().Ee_())/this.Hxs_().Ts_():t.getY()-this.Hxs_().Ee_(),A=Gn.FI_(this.ULs_*e,0,0),n=new lA(this.Xz_*s,0);return this.LLs_.transformPoint(A.transformPoint(n))}KFs_(t){return Math.abs(this._w1)>NA.Je_?Math.abs(this.Xz_/this._w1):Math.abs(this.Xz_)}HFs_(t){const i=Math.abs(this._w1)>NA.Je_?(t.getX()-this._w0)/this._w1:t.getX()-this._w0;return this.Hxs_().Ts_()>NA.Je_?Math.abs(this.ULs_*this.Xz_*i/this.Hxs_().Ts_()):Math.abs(this.ULs_*this.Xz_*i)}xFs_(t,i,s,e,A){if(aat.fxs_(t.getY(),i.getY())){this.JLs_(t,i,s,e,A);return}this.TLs_=!0;const n=this.Hxs_();n.Ee_()<=t.getY()&&n.pe_()>=t.getY()&&this.process(e,t,s,A);n.Ee_()>t.getY()&&n.Ee_()<i.getY()&&this.process(e,aat.hxs_(t,i,n.Ee_()),s,A);n.pe_()>t.getY()&&n.pe_()<i.getY()&&this.process(e,aat.hxs_(t,i,n.pe_()),s,A);n.Ee_()<=i.getY()&&n.pe_()>=i.getY()&&this.process(e,i,s,A)}ALs_(t,i,s,e,A){if(aat.fxs_(t.getY(),i.getY())){this.JLs_(t,i,s,e,A);return}this.TLs_=!0;const n=this.Hxs_();n.Ee_()<=t.getY()&&n.pe_()>=t.getY()&&this.process(e,t,s,A);n.pe_()>i.getY()&&n.pe_()<t.getY()&&this.process(e,aat.hxs_(t,i,n.pe_()),s,A);n.Ee_()>i.getY()&&n.Ee_()<t.getY()&&this.process(e,aat.hxs_(t,i,n.Ee_()),s,A);n.Ee_()<=i.getY()&&n.pe_()>=i.getY()&&this.process(e,i,s,A)}process(t,i,s,e){if(this.TLs_){aat.ixs_(t,this.transform(i),s,e);this.dVt_=i&&i.clone();this.TLs_=!1;return}const A=this.YLs_.RLs_(this.dVt_,i);let n=0;do{n=A[n].SLs_;aat.ixs_(t,A[n].NLs_,s,e)}while(A[n].SLs_!==-1)}JLs_(t,i,s,e,A){aat.ixs_(e,this.transform(t),s,A);aat.ixs_(e,this.transform(i),s,A)}HLs_(t,i,s,e){let A=new lA;const n=Math.abs(t-this._o.getX());if(n<=this.Xz_){A.setX(t);const h=Math.sqrt(this.Xz_*this.Xz_-n*n);this._o.getY()-h<i.Ee_()?A.setY(i.Ee_()):A.setY(this._o.getY()-h);if(this.contains(A)){A=this.uI_(A);s>A.getY()&&(s=A.getY());e<A.getY()&&(e=A.getY())}A.setX(t);this._o.getY()+h>i.pe_()?A.setY(i.pe_()):A.setY(this._o.getY()+h);if(this.contains(A)){A=this.uI_(A);s>A.getY()&&(s=A.getY());e<A.getY()&&(e=A.getY())}}return{nIs_:s,hIs_:e}}qLs_(t,i,s,e){let A=new lA;const n=Math.abs(t-this._o.getY());if(n<=this.Xz_){A.setY(t);const h=Math.sqrt(this.Xz_*this.Xz_-n*n);this._o.getX()-h<i.we_()?A.setX(i.we_()):A.setX(this._o.getX()-h);if(this.contains(A)){A=this.uI_(A);s>A.getY()&&(s=A.getY());e<A.getY()&&(e=A.getY())}A.setY(t);this._o.getX()+h>i.Qe_()?A.setX(i.Qe_()):A.setX(this._o.getX()+h);if(this.contains(A)){A=this.uI_(A);s>A.getY()&&(s=A.getY());e<A.getY()&&(e=A.getY())}}return{nIs_:s,hIs_:e}}};s=i=t([_s("geotoolkit.deviation.PieSliceTrajectoryStation")],s);return s}();var Kat=function(){let i=class t{constructor(t,i){this.PLs_=t!==void 0?t:-1;this.VLs_=i||new mA;this.OLs_=Number.MAX_VALUE}};i=t([_s("geotoolkit.deviation.StationBounds")],i);return i}();var Hat=function(){let i=class t{constructor(t,i){this.RFs_=t;this.WLs_=i}};i=t([_s("geotoolkit.deviation.StationPair")],i);return i}();const qat=16,Jat=function(t){const i=undefined,s=undefined;return{xx:NA.AA_(t.BI_(),5),yy:NA.AA_(t.sI_(),5)}},Pat=function(t,i){return t["xx"]===i["xx"]&&t["yy"]===i["yy"]},Vat=function(t,i){return Math.abs(i)>Math.abs(t)?i<0?-Math.atan(t/i):Math.PI-Math.atan(t/i):t<0?-Math.PI/2+Math.atan(i/t):Math.PI/2+Math.atan(i/t)};var Oat=function(){var t;return class{constructor(t){this._tr=t;this.oLs_=[];this.zLs_=new nat;this.Gxs_=1;this.Rxs_=1;this.XLs_=1;this.jLs_=1;this.ZLs_=1;this._Ls_=1;this.$Ls_=1;this.qGt_=1}}}(),Wat=Ci(function(){let i=class t extends hat{constructor(t,i,s){super();t=qi(t,{filter:!0,trackwidth:0,offset:0},!0);this.jFs_=t["trajectory"];this.gp_=t["filter"];this.tUs_=t["trackwidth"];this.T2_=t["offset"];s=s?s.clone():new Gn;this.Us_=new Oat(s);this._tr=s;this.iUs_=i["joinsegments"];this.sUs_=i["approxthreshold"];this.eUs_=i["approxthresholdmd"]!==void 0?i["approxthresholdmd"]:this.sUs_;this.AUs_=i["trackwidthstrategy"];this.AUs_==null&&(this.AUs_=new lat({scalewidth:i["scalewidth"],minwidth:i["minwidth"],maxwidth:i["maxwidth"],widthscalex:i["widthscalex"],widthscaley:i["widthscaley"]}));this.nUs_=i["outlinesegments"];this.hUs_=i["outlinemodelbboxadjust"];this.rUs_=-1;this.oUs_=[];this.lUs_=new Gn;this.uUs_=new Gn;this.aUs_=new lA;this.bf_=null;this.Iw_();this.gUs_()}cUs_(){this.Us_.$Ls_=1;const t=this.Us_.oLs_.length;if(!t)return;const i=this.Us_.oLs_[0],s=this.Us_.oLs_[t-1],e=i.Mcs_(),A=s.vcs_(),n=[new lA(0,e),new lA(0,A)],h=[];this.LFs_(n,h,this._tr);let r=0;for(let t=0;t<h.length-1;++t)r+=lA.Ss_(h[t],h[t+1]);r&&(this.Us_.$Ls_=Math.max(1,2*aat.int(.5+r/Math.abs(A-e))))}JFs_(t){const i=this.Us_.oLs_.length;let s=NA.findIndex(null,this.Us_.oLs_,null,null,(function(i){const s=i.Hxs_().pe_()-t;return Math.abs(s)>NA.Je_?s:0}));s<0?s=~s:++s;s>=i&&(s=i-1);return s}transform(t,i){i&&(t=i.transformPoint(t));let s=this.JFs_(t.getY());s<0&&(s=0);for(let i=s;i<this.Us_.oLs_.length;++i){const s=this.Us_.oLs_[i].Hxs_();if(t.getY()<=s.pe_()&&t.getY()>=s.Ee_())return this.Us_.oLs_[i].transform(t);if(s.pe_()>t.getY())return this.Us_.oLs_[i].transform(t)}return this.Us_.oLs_.length>0?this.Us_.oLs_[this.Us_.oLs_.length-1].transform(t):new lA}uI_(t){if(this.rUs_>=0&&this.rUs_<this.Us_.oLs_.length){let i=0;while(this.rUs_+i<this.Us_.oLs_.length||this.rUs_-i>=0){if(this.rUs_+i<this.Us_.oLs_.length&&this.Us_.oLs_[this.rUs_+i].contains(t)){this.rUs_=this.rUs_+i;return this.Us_.oLs_[this.rUs_].uI_(t)}if(this.rUs_-i>=0&&this.Us_.oLs_[this.rUs_-i].contains(t)){this.rUs_=this.rUs_-i;return this.Us_.oLs_[this.rUs_].uI_(t)}i++}return new lA(Number.NaN,Number.NaN)}const i=this.Us_.zLs_.SFs_();for(let s=this.Us_.zLs_.GFs_(t.getY()-this._tr.pI_());s<i.length;++s){const e=i[s];this.aUs_.vs_(NaN,NaN);if(this.Us_.oLs_[e.WLs_.PLs_].contains(t,this.aUs_)){this.rUs_=e.WLs_.PLs_;return NA.Ve_(this.aUs_.getX())&&NA.Ve_(this.aUs_.getY())?this.aUs_:this.Us_.oLs_[this.rUs_].uI_(t)}if(t.getY()<e.WLs_.OLs_)break}return new lA(Number.NaN,Number.NaN)}xFs_(t,i,s,e){this.Us_.oLs_.length!==0&&this.LFs_([t,i],s,e)}LFs_(t,i,s,e){let A=t.length,n,h,r,o;if(!(A>1&&this.Us_.oLs_.length>0))return;(e=e&&!aat.nxs_(t))&&++A;if(s){n=s.BI_();h=s.sI_();r=s.EI_();o=s.pI_()}else{n=1;h=1;r=0;o=0}const l=new lA(Number.MAX_VALUE,Number.MAX_VALUE),u=new lA(t[0].getX()*n+r,t[0].getY()*h+o),a=new lA;let g=0,c=1;for(let s=0;s<A-1;++s,++c){e&&s===A-2&&(c=0);a.vs_(t[c].getX()*n+r,t[c].getY()*h+o);(g<0||g>=this.Us_.oLs_.length||!(this.Us_.oLs_[g].Hxs_().Ee_()<=u.getY()&&this.Us_.oLs_[g].Hxs_().pe_()>=u.getY()))&&(g=this.JFs_(u.getY()));if(u.getY()<=a.getY())for(let t=g;t<this.Us_.oLs_.length;++t){const s=this.Us_.oLs_[t],e=s.Hxs_();s.xFs_(u,a,l,i,this.gp_);if(e.pe_()>=a.getY()){g=t;break}}else{g>=this.Us_.oLs_.length&&(g=this.Us_.oLs_.length-1);for(let t=g;t>=0;--t){const s=this.Us_.oLs_[t],e=s.Hxs_();s.ALs_(u,a,l,i,!1);if(e.Ee_()<=a.getY()){g=t;break}}}u.vs_(a.getX(),a.getY())}}contains(t){const i=this.Us_.zLs_.SFs_();for(let s=this.Us_.zLs_.GFs_(t.getY()-this._tr.pI_());s<i.length;++s){const e=i[s];if(e.WLs_.VLs_.contains(t)&&this.Us_.oLs_[e.WLs_.PLs_].contains(t))return!0;if(t.getY()<e.WLs_.OLs_)break}return!1}UFs_(t){if(this.Us_.oLs_.length<1)return sa.SS_();const i=this._tr.rn_(t);let s=+1/0,e=-1/0;const A=this.Us_.zLs_.SFs_();let n,h,r,o;n=this.Us_.zLs_.kFs_(i.pe_()-this._tr.pI_());n>0&&n--;if(n!==A.length-1&&i.$s_(A[n].WLs_.VLs_)){r=this.Us_.oLs_[A[n].WLs_.PLs_];o=r.Hxs_();i.xe_(r.Me_(),r.ve_(),this.aUs_,this.aUs_)>=0&&(s=o.Ee_());i.xe_(r.Ne_(),r.be_(),this.aUs_,this.aUs_)>=0&&(e=o.pe_())}for(n=this.Us_.zLs_.GFs_(i.Ee_()-this._tr.pI_());n<A.length;++n){h=A[n];r=this.Us_.oLs_[h.WLs_.PLs_];o=r.Hxs_();if(s>o.Ee_()||e<o.pe_()){const t=new mA(i);t.intersect(h.WLs_.VLs_);if(!t.isEmpty()){const i=r.contains(t,s,e);s=i.nIs_;e=i.hIs_}}if(h.WLs_.OLs_>i.pe_())break}return s>e?sa.SS_():new mA(0,s,this.tUs_,e)}update(t){this.bf_=null;const i=Jat(t),s=Jat(this._tr);if(Pat(i,s)){this.shift(t);return!0}let e=null;this.oUs_.some((t=>{if(Pat(t.key,i)){e=t.value;return!0}return!1}));if(e){this.Us_=e;this._tr=this.Us_._tr;this.Us_.qGt_<Number.MAX_VALUE-1&&this.Us_.qGt_++;this.shift(t)}else{this.Us_=new Oat(t);this._tr=t;this.gUs_();this.Iw_()}return!0}KFs_(t){let i=this.JFs_(t.getY());i<0&&(i=0);for(let s=i;s<this.Us_.oLs_.length;++s){const i=this.Us_.oLs_[s].Hxs_();if(t.getY()<=i.pe_()&&t.getY()>=i.Ee_())return this.Us_.oLs_[s].KFs_(t);if(i.pe_()>t.getY())break}return this.Us_.Gxs_}HFs_(t){let i=this.JFs_(t.getY());i<0&&(i=0);for(let s=i;s<this.Us_.oLs_.length;++s){const i=this.Us_.oLs_[s].Hxs_();if(t.getY()<=i.pe_()&&t.getY()>=i.Ee_())return this.Us_.oLs_[s].HFs_(t);if(i.pe_()>t.getY())break}return this.Us_.Rxs_}iE_(){return this.Us_.Gxs_}sE_(){return this.Us_.Rxs_}ZQ_(){return this.Us_.XLs_}_Q_(){return this.Us_.jLs_}$Q_(){return this.Us_.ZLs_}tE_(){return this.Us_._Ls_}qFs_(t,i){if(this.Us_.oLs_[this.rUs_]&&this.Us_.oLs_[this.rUs_].contains(t))return this.Us_.oLs_[this.rUs_].qFs_(t,i);const s=this.Us_.zLs_.SFs_();for(let e=this.Us_.zLs_.GFs_(t.getY()-this._tr.pI_());e<s.length;++e){const A=s[e];if(A.WLs_.VLs_.contains(t)){this.rUs_=A.WLs_.PLs_;return this.Us_.oLs_[this.rUs_].qFs_(t,i)}if(t.getY()<A.WLs_.OLs_)return null}return null}IUs_(){this.oUs_.forEach((t=>{delete t.value}))}Iw_(){let t=!1;this.Us_.Gxs_=0;this.Us_.Rxs_=0;this.Us_.XLs_=0;this.Us_.jLs_=0;this.Us_.ZLs_=1;this.Us_._Ls_=1;const i=[],s=[],e=[],A=this.AUs_.Ie_(this._tr,{width:this.tUs_,trajectory:this.jFs_})/this.tUs_,n=this.jFs_.fUs_(this._tr,this.sUs_,this.eUs_),h=this._tr.rI_();let r,o,l,u;const a=[];let g=[],c,I,f,C,d,B,w,Q;const E=new Gn;let p,m;while(!n.end()){if(c==null){const t=n.object();r=i.length===0?t.CUs_():o;const s=i.length===0?t.line().project(this._tr.nI_(this.jFs_.getX(r),this.jFs_.getY(r))):l;o=t.dUs_();l=t.line().project(this._tr.nI_(this.jFs_.getX(o),this.jFs_.getY(o)));u=h.transformPoint(s);f=s.getY()-l.getY();I=s.getX()-l.getX();Q=Vat(I,f);Gn.kI_(u.getX(),u.getY(),this.lUs_);Gn.multiply(this._tr,this.lUs_,E);this._tr.transformPoint(u,this.aUs_);Gn.FI_(Q,this.aUs_.getX(),this.aUs_.getY(),this.lUs_);Gn.multiply(this.lUs_,E,E);C=E.wI_()===0?Math.abs(E.BI_()):Math.sqrt(E.BI_()*E.BI_()+E.QI_()*E.QI_());d=E.QI_()===0?Math.abs(E.sI_()):Math.sqrt(E.sI_()*E.sI_()+E.wI_()*E.wI_());this._tr.sI_()<0&&(d=-d);this._tr.BI_()<0&&(C=-C);B=lA.Ss_(s,l);w=this.jFs_.G2_(o)-this.jFs_.G2_(r);p=Math.abs(w)>NA.Je_?1/d*(B/w):1;this.lUs_.dI_(A/C,0,0,p,0,0);Gn.multiply(E,this.lUs_,E);this.lUs_.dI_(1,0,0,1,-this.tUs_/2+this.T2_,-this.jFs_.G2_(r));Gn.multiply(E,this.lUs_,E);m=new mA(0,this.jFs_.G2_(r),this.tUs_,this.jFs_.G2_(o));c=new bat(E,m,!1);c.update()}if(this.iUs_){let t=0;if(a.length===0){i.push(B);s.push(this.jFs_.G2_(0)+w);e.push(c.Wxs_());c._xs_();a.push(c);c=null;n.next()}else{const A=a[a.length-1];e[e.length-1]-=A.Wxs_();const h=this.nUs_?Lat.pLs_(A,c,t,g,this.hUs_):Tat.KLs_(A,c,t),r=h.yLs_;t=h.tooShort;e[e.length-1]+=A.Wxs_();if(t>=0){i.push(i[i.length-1]+B);s.push(s[s.length-1]+w)}if(r){g=[];a.push(r);e.push(r.Wxs_()+e[e.length-1])}else if(t===-2)if(i.length>1){i[i.length-2]=i[i.length-1];s[s.length-2]=s[s.length-1];i.pop();s.pop();e.pop();a.pop();if(this.nUs_){g.unshift(A);const t=a[a.length-1];if(t instanceof Lat){e.pop();a.pop();e[e.length-1]-=a[a.length-1].Wxs_();t.reset();e[e.length-1]+=a[a.length-1].Wxs_();t.oLs_=t.oLs_.concat(g);g=t.oLs_.slice()}}else if(a[a.length-1]instanceof Tat){e.pop();a.pop()}}else{i[i.length-1]+=B;s[s.length-1]+=w;e[e.length-1]-=A.Wxs_();A.dI_(c.Ji_());const h=A.Hxs_().clone().union(c.Hxs_());A.qxs_(h);A.update();e[e.length-1]+=A.Wxs_();c=null;t=0;n.next();this.nUs_&&(g=[])}else if(t===0){A._xs_();c._xs_()}else{i[i.length-1]+=B;s[s.length-1]+=w;n.next();if(n.end()){e[e.length-1]-=A.Wxs_();A.qxs_(A.Hxs_().clone().union(c.Hxs_()));A.update();e[e.length-1]+=A.Wxs_()}this.nUs_&&g.push(c);c=null}}if(c&&t>=0){a.push(c);e.push(c.Wxs_()+e[e.length-1]);c=null;n.next()}}else{this.BUs_(c);t=this.setScale(c,t);n.next();c=null}}if(this.iUs_&&a.length>0){const n=a[a.length-1];n instanceof bat&&n._xs_();const r=i[i.length-1]/e[e.length-1]||1;let o=0,g,c,m=null,y=null,D=null;for(let n=0;n<a.length;++n){const M=a[n];if(!this.nUs_||this.hUs_)if(M instanceof bat){if(M.Zxs_()>0){const t=n===0?0:e[n-1]*r;while(i[o]<t&&o<i.length-1)o++;let a=o===0?0:i[o-1],v=(t-a)/(i[o]-a),b=o===0?this.jFs_.G2_(0):s[o-1];g=b*(1-v)+s[o]*v;const N=e[n]*r;while(i[o]<N&&o<i.length-1)o++;a=o===0?0:i[o-1];v=(N-a)/(i[o]-a);b=o===0?this.jFs_.G2_(0):s[o-1];c=b*(1-v)+s[o]*v;const S=M.tLs_();l=M.iLs_();u=h.transformPoint(S);I=S.getX()-l.getX();f=S.getY()-l.getY();Q=Vat(I,f);Gn.kI_(u.getX(),u.getY(),this.lUs_);Gn.multiply(this._tr,this.lUs_,E);this._tr.transformPoint(u,this.aUs_);Gn.FI_(Q,this.aUs_.getX(),this.aUs_.getY(),this.lUs_);Gn.multiply(this.lUs_,E,E);C=E.xy===0?Math.abs(E.xx):Math.sqrt(E.xx*E.xx+E.yx*E.yx);d=E.yx===0?Math.abs(E.yy):Math.sqrt(E.yy*E.yy+E.xy*E.xy);this._tr.yy<0&&(d=-d);this._tr.xx<0&&(C=-C);B=lA.Ss_(S,l);w=c-g;p=Math.abs(w)>NA.Je_?1/d*(B/w):1;Gn.TI_(A/C,p,this.lUs_);Gn.multiply(E,this.lUs_,E);Gn.kI_(-this.tUs_/2,-g,this.lUs_);Gn.multiply(E,this.lUs_,E);M.dI_(E);M.qxs_(new mA(0,g,this.tUs_,c));M.update();if(y&&D){y.vLs_();this.BUs_(y)}else if(m&&D){m.qxs_(new mA(D.Hxs_().we_(),D.vcs_(),D.Hxs_().Qe_(),M.Mcs_()));this.BUs_(m)}m=null;y=null;D=M}this.BUs_(M);t=this.setScale(M,t)}else this.nUs_?y=M instanceof Lat?M:null:m=M instanceof Tat?M:null;else{M instanceof bat?t=this.setScale(M,t):M instanceof Lat&&M.vLs_();this.BUs_(M)}}}if(this.Us_.oLs_.length>1){this.Us_.ZLs_=Math.pow(this.Us_.ZLs_,1/this.Us_.oLs_.length);this.Us_._Ls_=Math.pow(this.Us_._Ls_,1/this.Us_.oLs_.length)}this.Us_.Gxs_===0&&(this.Us_.Gxs_=1);this.Us_.Rxs_===0&&(this.Us_.Rxs_=1);this.Us_.XLs_===0&&(this.Us_.XLs_=1);this.Us_.jLs_===0&&(this.Us_.jLs_=1);let y=+1/0;const D=this.Us_.zLs_.SFs_();for(let t=D.length-1;t>=0;--t){const i=D[t];i.WLs_.OLs_=y;y=Math.min(y,i.WLs_.VLs_.Ee_())}this.cUs_()}setScale(t,i){const s=t.iE_(),e=t.sE_();this.Us_.ZLs_*=s;this.Us_._Ls_*=e;if(i){this.Us_.Gxs_=Math.max(s,this.Us_.Gxs_);this.Us_.Rxs_=Math.max(e,this.Us_.Rxs_);this.Us_.XLs_=Math.min(s,this.Us_.XLs_);this.Us_.jLs_=Math.min(e,this.Us_.jLs_)}else{this.Us_.Gxs_=s;this.Us_.Rxs_=e;this.Us_.XLs_=s;this.Us_.jLs_=e;i=!0}return i}BUs_(t){const i=t.getBounds(),s=new Kat(this.Us_.oLs_.length,i),e=i.pe_()-this._tr.pI_();this.Us_.zLs_.g1_(new Hat(e,s));this.Us_.oLs_.push(t)}gUs_(){if(this.oUs_.length>=qat){let t=+1/0,i=0;for(let s=0;s<this.oUs_.length;++s){const e=this.oUs_[s];if(t>e.value.qGt_){i=s;t=e.value.qGt_;if(t===1)break}}this.oUs_.splice(i,1)}this.oUs_.push({key:Jat(this._tr),value:this.Us_})}shift(t){const i=t.EI_()-this._tr.EI_(),s=t.pI_()-this._tr.pI_();if(Math.abs(i)>NA.Je_||Math.abs(s)>NA.Je_){this.aUs_.vs_(i,s);Gn.kI_(i,s,this.lUs_);let t=null;for(let i=0;i<this.Us_.oLs_.length;++i){this.Us_.oLs_[i].offset(this.aUs_);this.Us_.oLs_[i].Oxs_(t);t=this.Us_.oLs_[i]}const e=this.Us_.zLs_.SFs_();for(let t=0;t<e.length;++t){const i=e[t];i.WLs_.OLs_+=s;this.lUs_.rn_(i.WLs_.VLs_,i.WLs_.VLs_)}}this._tr=this.Us_._tr=t}TFs_(){return this._tr}YFs_(){if(!this.bf_){let t=null;this.Us_.oLs_.forEach((i=>{t?t.union(i.getBounds()):t=i.getBounds()}));this.bf_=t}return this.bf_}};i=t([_s("geotoolkit.deviation.PiecewiseTransformation")],i);return i}(),1,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJpbnZlcnNlVHJhbnNmb3JtIjoidUlfIiwidHJhbnNmb3JtTGluZSI6InhGc18iLCJ0cmFuc2Zvcm1MaW5lcyI6IkxGc18iLCJmaW5kQm91bmRzIjoiVUZzXyIsImdldFN0YXRpb25zQm91bmRzIjoiWUZzXyIsImdldEFmZmluZVRyYW5zZm9ybWF0aW9uIjoiVEZzXyIsInNjYWxlWEF0IjoiS0ZzXyIsInNjYWxlWUF0IjoiSEZzXyIsImRpZ2l0aXplIjoicUZzXyJ9fX0g");var zat=Ci(function(){let i=class t extends Aat{constructor(t){super();this.UU_=qi(t,{joinsegments:!0,approxthreshold:.5,outlinesegments:!1,outlinemodelbboxadjust:!1,trackwidthstrategy:null},!0);this.UU_["approxthresholdmd"]=this.UU_["approxthresholdmd"]!=null?this.UU_["approxthresholdmd"]:this.UU_["approxthreshold"]}JV_(){return qi(this.UU_,{})}setOptions(t){qi(t,this.UU_);return this}N_(){return this.JV_()}dt_(t){return this.setOptions(t)}create(t,i){return new Wat(t,this.UU_,i)}};i=t([_s("geotoolkit.deviation.PiecewiseTransformer")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJnZXRPcHRpb25zIjoiSlZfIiwiZ2V0UHJvcGVydGllcyI6Ik5fIiwic2V0UHJvcGVydGllcyI6ImR0XyJ9fX0g");const Xat=new Gn,jat=new lA;var Zat=function(){let i=class t extends kI{render(t,i,s,e,A,n,h,r,o){if(!t.wUs_){ki("context must be instanceof geotoolkit.renderer.DeviatedRenderingContext");return}const l=t.wUs_.transform(jat.vs_(i+this.Ie_()/2,s+this.Ts_()/2),Xat);i=l.getX()-this.Ie_()/2;s=l.getY()-this.Ts_()/2;e||A?super.render(t.QUs_(),i,s,e,A,n,h,r,o):super.render(t.QUs_(),i,s)}};i=t([_s(null)],i);return i}();var _at=function(){var t;return class{constructor(t,i){this.Jp_=t;this.Pp_=i;this.bf_=new mA(0,0,this.Jp_,this.Pp_);this.EUs_=fr.zw_(this.Jp_,this.Pp_,!0);this.TDt_=this.EUs_.gJ_(this.Jp_,this.Pp_);this.pUs_=!0;this.sK_=je.is_()||je.ts_();this.mUs_=Number.POSITIVE_INFINITY;this.yUs_=Number.NEGATIVE_INFINITY;this.DUs_=Number.POSITIVE_INFINITY;this.MUs_=Number.NEGATIVE_INFINITY}Ie_(){return this.Jp_}Ts_(){return this.Pp_}clear(){if(this.TDt_==null)return this;const t=this.TDt_.getData(),i=4*this.TDt_.Ie_()*this.TDt_.Ts_();for(let s=0;s<i;s++)t[s]=0;this.sK_&&this.EUs_.clear();return this}tQ_(){if(this.pUs_===!1){this.clear();this.mUs_=Number.POSITIVE_INFINITY;this.yUs_=Number.NEGATIVE_INFINITY;this.DUs_=Number.POSITIVE_INFINITY;this.MUs_=Number.NEGATIVE_INFINITY}this.vUs_=this.TDt_.getData();this.pUs_=!0;return this}gM_(){this.EUs_.km_(this.TDt_,0,0)}lai_(t,i,s){this.pUs_=!1;this.mUs_=Math.min(t,this.mUs_);this.yUs_=Math.max(t,this.yUs_);this.DUs_=Math.min(i,this.DUs_);this.MUs_=Math.max(i,this.MUs_);const e=this.vUs_,A=(i*this.Jp_+t)*4;e[A+0]=s[0];e[A+1]=s[1];e[A+2]=s[2];e[A+3]=s[3]}d$_(t,i){this.bf_.setX(t).setY(i);return this}getBounds(){return this.bf_}render(t,i,s){if(this.pUs_===!0)return this;const e=this.yUs_-this.mUs_,A=this.MUs_-this.DUs_;s.drawImage(this.EUs_,this.mUs_,this.DUs_,e+1/s.VR_(),A+1/s.VR_(),t+this.mUs_,i+this.DUs_,e+1,A+1);return this}}}(),$at=function(){var t;return class{constructor(t,i){this.cK_=t;this.bf_=i;this.Qyt_=Math.ceil(i.Ie_()/t.Ie_());this.LUt_=Math.ceil(i.Ts_()/t.Ts_())}WFi_(){return this.LUt_}zFi_(){return this.Qyt_}bUs_(t,i){const s=this.bf_.we_()+t*this.cK_.Ie_(),e=this.bf_.Ee_()+i*this.cK_.Ts_();return this.cK_.d$_(s,e)}}}();let tgt=new lA(0,0);const igt=new lA(0,0),sgt=new lA(0,0),egt=new lA(0,0),Agt=function(t){return t instanceof Ca&&t.WG_()},ngt=new In([],[]),hgt=new In([],[]);let rgt;var ogt=Ci(function(){var i;let s=i=class t extends Pf{constructor(t){super();this._tr=t!=null?t:new Gn;this.NUs_=null;this.UU_={trajectory:null,transformer:new zat,trackwidth:100,offset:0,clip:!0,webglrendering:!1};this.SUs_=null;this.wUs_=null;this.Us_=[];this.GUs_=new Gn;this.jxs_=new lA;this.RUs_=NaN;this.kUs_=NaN;this.Eii_=null;this.FUs_=null;this.xUs_=[0,0,0,0];this.BCi_=[];this.aCi_=null;this.rCi_=null;this.LUs_=null;this.UUs_=!1;this.YUs_=!1}TUs_(){if(!this.SUs_)throw new Error("Parent rendering context is not defined")}KUs_(){return{trajectory:this.UU_["trajectory"],trackwidth:this.UU_["trackwidth"],offset:this.UU_["offset"]}}HUs_(t){qi(t,this.UU_,!0);if(this.wUs_&&this.UU_["transformer"]){let t=this.GUs_;typeof this.wUs_.TFs_=="function"&&(t=this.wUs_.TFs_());this.UU_["transformer"].setOptions(this.UU_);this.wUs_=this.UU_["transformer"].create(this.KUs_(),t)}}qUs_(){return this.UU_}PR_(){return this.wUs_?{r__:this.wUs_.FFs_()}:{}}QUs_(){return this.SUs_}update(t){this.JUs_(t.Ji_());this.SUs_=t;this.setFilters(this.SUs_?this.SUs_.getFilters():null)}JUs_(t){if(t){this.UU_["transformer"].setOptions(this.UU_);this.wUs_?this.wUs_.update(t):this.wUs_=this.UU_["transformer"].create(this.KUs_(),t)}this._tr.fI_()}uS_(t){const s=Gn.multiply(this._tr,t),e=new i(s);e.HUs_(this.qUs_());e.setFilters(this.getFilters());e.PUs_(this.aCi_);this.SUs_.YR_(this.LUs_);e.wUs_=this.wUs_;e.SUs_=this.SUs_;return e}Ji_(){return this._tr}dI_(t){this._tr=t;this.NUs_=null;this.rCi_=null;return this}XR_(){this.NUs_==null&&(this.NUs_=this._tr.rI_());return this.NUs_}transformPoint(t){return this.wUs_.transform(t,this._tr)}rn_(t){const i=this.SUs_.Ji_();let s=[];this.wUs_.LFs_([t.Me_(),t.ve_(),t.be_(),t.Ne_(),t.Me_()],s,this.Ji_(),!0);s=s.map((t=>i.transform(t)));const e=undefined;return new In(s.map((t=>t.getX())),s.map((t=>t.getY()))).getBounds()}xFs_(t,i,s){s||(s=[]);this.wUs_.LFs_([t,i],s,this._tr);return s}pR_(t,i,s,e){if(t instanceof mA){tgt.vs_(t.we_(),t.Ee_());igt.vs_(t.we_()+t.Ie_(),t.Ee_()+t.Ts_())}else{tgt.vs_(t,i);igt.vs_(t+s,i+e)}const A=[tgt.getX(),igt.getX(),igt.getX(),tgt.getX(),tgt.getX()],n=[tgt.getY(),tgt.getY(),igt.getY(),igt.getY(),tgt.getY()];this.ER_(A,n);return this}VUs_(t,s,e,A,n,h,r,o,l,u){if(r===l||o===u)return this;let a=null;if(typeof this.Eii_.Ow_=="function"){if(this.FUs_!=null){e=this.FUs_.we_();A=this.FUs_.Ee_();n=this.FUs_.Qe_();h=this.FUs_.pe_()}a=this.Eii_.Ow_(e,A,n,h)}if(!a)return this;const g=1;let c=[],I=[];if(g!==1){r*=g;o*=g;l*=g;u*=g;for(let i=0;i<t.length;++i){c.push(t[i]*g);I.push(s[i]*g)}}else{c=t;I=s}r=Math.floor(r);o=Math.floor(o);l=Math.ceil(l);const f=undefined;let C=(u=Math.ceil(u))-o+1;if(r+(l-r+1)<0||o+C<0)return this;const d=new mA(r,o,l,u),B=this.SUs_.cR_().clone();B&&g!==1&&B.ce_(B.we_()*g,B.Ee_()*g,B.Qe_()*g,B.pe_()*g);if(d.$s_(B)===!1)return this;d.intersect(B);if(d.isEmpty())return this;d.ce_(Math.floor(d.we_()),Math.floor(d.Ee_()),Math.ceil(d.Qe_()),Math.ceil(d.pe_()));C=d.Ts_();const w=this._tr.rI_();if(c[0]!==c[c.length-1]||I[0]!==I[I.length-1]){c.push(c[0]);I.push(I[0])}const Q=[{}],E=new $at(i.OUs_,d),p=i.OUs_.Ie_(),m=this.SUs_.Ji_();this.SUs_.dI_(Gn.JI_);for(let t=0;t<E.WFi_();t++)for(let i=0;i<E.zFi_();i++){const s=E.bUs_(i,t),e=s.getBounds();if(B==null||B.$s_(s.getBounds())!==!1){s.tQ_();r=s.getBounds().we_();o=s.getBounds().Ee_();l=s.getBounds().Qe_();u=s.getBounds().pe_();for(let t=0;t<C;++t){const i=o+t;if(B&&(i<B.Ee_()||i>B.pe_()))continue;const A=aat.gxs_(c,I,i,Q);for(let n=0;n<A.length;++n){const h=A[n];if(h.to-h.from<1)continue;let o=Math.floor(h.from);o<r&&(o=r);let u=Math.ceil(h.to);u>l&&(u=l);const c=Math.ceil(h.from)-h.from,I=h.to-Math.floor(h.to);for(let A=o;A<=u;++A){const n=A-r;if(n<0||n>=e.Ie_()||t<0||t>=e.Ts_())continue;if(B&&!B.contains(A,i))continue;tgt.vs_(A/g,i/g);const h=this.wUs_.uI_(tgt);if(isNaN(h.getX())||isNaN(h.getY()))continue;w.transformPoint(h,h);a.Ww_(h.getX(),h.getY(),this.xUs_);const l=undefined,f=I!==0;c!==0&&A===o&&n!==0?this.xUs_[3]=Math.round(c*this.xUs_[3]):f&&A===u&&n!==p&&(this.xUs_[3]=Math.round(I*this.xUs_[3]));s.lai_(n,t,this.xUs_)}}}s.gM_();s.render(r/g,o/g,this.SUs_)}}this.SUs_.dI_(m);return this}WUs_(){this.UUs_=!1;if(!(this.LUs_ instanceof Ca))return;const t=Ca.VG_(sa.RS_(),this.LUs_.GE_());let i=this._tr;this.LUs_ instanceof YC&&(i=i.clone().scale(this.LUs_.Ie_(),this.LUs_.Ts_()).translate(0,-1));const s=this.wUs_.transform(t,i),e=s.getX(),A=s.getY(),n=this.wUs_.uI_(s);if(!NA.Ve_(n.getX())||!NA.Ve_(n.getY()))return;this.jxs_.vs_(0,n.getY());const h=this.wUs_.transform(this.jxs_,this.GUs_);this.jxs_.vs_(this.UU_["trackwidth"],n.getY());const r=this.wUs_.transform(this.jxs_,this.GUs_),o=Math.atan2(r.getY()-h.getY(),r.getX()-h.getX()),l=i.BI_()<0?-1:1,u=i.sI_()<0?-1:1,a=Gn.FI_(o,0,0),g=Gn.kI_(e,A),c=(new Gn).scale(l,u);Gn.multiply(a,c,c);Gn.multiply(g,c,c);const I=this.SUs_.Ji_();this.SUs_.dI_(c);const f=this.LUs_.lR_();this.LUs_.rd_(!1);this.LUs_.gR_(0,0);this.LUs_.render(this.SUs_);this.LUs_.gR_(f);this.LUs_.rd_(!0);this.SUs_.dI_(I)}ER_(t,i,s,e){this.TUs_();if(!this.UU_["trajectory"])return this;if(Agt(this.LUs_)){this.WUs_();return this}if(this.UUs_)return this;let A,n;const h=Math.min(t.length,i.length),r=[];let o=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,g;for(g=0;g<h;++g){A=t[g];n=i[g];A<o&&(o=A);n<l&&(l=n);A>u&&(u=A);n>a&&(a=n);r.push(new lA(t[g],i[g]))}o=Math.floor(o);l=Math.floor(l);u=Math.ceil(u);a=Math.ceil(a);this.Us_=[];this.wUs_.LFs_(r,this.Us_,this._tr,!0);const c=[],I=[];let f=Number.POSITIVE_INFINITY,C=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,B=Number.NEGATIVE_INFINITY;for(g=0;g<this.Us_.length;++g){A=this.Us_[g].getX();n=this.Us_[g].getY();A<f&&(f=A);n<C&&(C=n);A>d&&(d=A);n>B&&(B=n);c.push(A);I.push(n)}if(c[c.length-1]!==c[0]||I[I.length-1]!==I[0]){c.push(c[0]);I.push(I[0])}const w=0,Q=c.length-1;this.Us_=[];const E=this.SUs_.Ji_();this.SUs_.dI_(this.GUs_);this.Eii_&&this.VUs_(c,I,o,l,u,a,f,C,d,B);this.SUs_.ER_(c,I,w,Q);this.SUs_.dI_(E);return this}mR_(t,i,s,e,A){this.TUs_();if(!this.UU_["trajectory"])return this;if(s===void 0){s=0;e=Math.min(t.length,i.length)-1}if(e<=s)return this;const n=[];let h;for(h=s;h<=e;++h)n.push(new lA(t[h],i[h]));this.Us_=[];this.wUs_.LFs_(n,this.Us_,this._tr,!1);const r=[],o=[];for(h=0;h<this.Us_.length;++h){r.push(this.Us_[h].getX());o.push(this.Us_[h].getY())}const l=0,u=r.length-1;this.Us_=[];const a=this.SUs_.Ji_();this.SUs_.dI_(this.GUs_);this.SUs_.mR_(r,o,l,u);this.SUs_.dI_(a);return this}zUs_(t){const i=this.UU_["trajectory"];this.SUs_.rB_(t);this.SUs_.mR_(i.XUs_(),i.jUs_(),0,i.count()-1)}oB_(t,i,s,e){this.TUs_();if(!this.UU_["trajectory"])return this;tgt.vs_(t,i);igt.vs_(s,e);this.Us_=[];this.wUs_.LFs_([tgt,igt],this.Us_,this._tr);const A=[],n=[];for(let t=0;t<this.Us_.length;++t){A.push(this.Us_[t].getX());n.push(this.Us_[t].getY())}const h=0,r=A.length-1;this.ZUs_([tgt,igt],this.Us_);this.Us_=[];const o=this.SUs_.Ji_();this.SUs_.dI_(this.GUs_);this.SUs_.mR_(A,n,h,r);this.SUs_.dI_(o);return this}_Us_(t,i,s,e){tgt.vs_(t.xN_(),t.LN_());igt.vs_(t.UN_(),t.YN_());sgt.vs_(t.TN_(),t.KN_());egt.vs_(t.HN_(),t.qN_());const A=NA.We_(tgt,igt,sgt,egt);this.Us_=[];this.wUs_.LFs_(A,this.Us_,this._tr,!1);for(let t=0;t<this.Us_.length;++t){const A=this.Us_[t].getX(),n=this.Us_[t].getY();A<e.r9t_&&(e.r9t_=A);n<e.o9t_&&(e.o9t_=n);A>e.l9t_&&(e.l9t_=A);n>e.u9t_&&(e.u9t_=n);i.push(A);s.push(n)}}yR_(t,i,s,e){this.TUs_();if(!this.UU_["trajectory"])return this;if(Agt(this.LUs_)){this.WUs_();return this}const A=t,n=i,h=t+s,r=i+e;t+=s/2;i+=e/2;const o=yu.sS_(t,i,s,e),l=[],u=[],a={r9t_:Number.POSITIVE_INFINITY,o9t_:Number.POSITIVE_INFINITY,l9t_:Number.NEGATIVE_INFINITY,u9t_:Number.NEGATIVE_INFINITY};for(let t=0;t<o.length;++t)this._Us_(o[t],l,u,a);const g=this.SUs_.Ji_();this.SUs_.dI_(this.GUs_);this.Eii_&&this.VUs_(l,u,A,n,h,r,a.r9t_,a.o9t_,a.l9t_,a.u9t_);this.SUs_.ER_(l,u);this.SUs_.dI_(g);return this}DR_(t,i,s,e,A,n,h,r){this.TUs_();if(!this.UU_["trajectory"])return this;if(n-A>=Math.PI*2){this.yR_(t,i,s,e);return this}const o={r9t_:t,o9t_:i,l9t_:t+s,u9t_:i+e};t+=s/2;i+=e/2;const l=[],u=[];if(!r){const s=this.wUs_.transform(new lA(t,i),this._tr);l.push(s.getX());u.push(s.getY())}const a=yu.sS_(t,i,s,e,A,n);if(a.length<1)return this;const g={r9t_:Number.POSITIVE_INFINITY,o9t_:Number.POSITIVE_INFINITY,l9t_:Number.NEGATIVE_INFINITY,u9t_:Number.NEGATIVE_INFINITY};for(let t=0;t<a.length;++t)this._Us_(a[t],l,u,g);const c=this.SUs_.Ji_();this.SUs_.dI_(this.GUs_);if(r)if(this.YUs_)for(let t=0;t<l.length;++t){const i=sgt.vs_(l[t],u[t]);this.SUs_.lineTo(i.getX(),i.getY())}else this.SUs_.mR_(l,u);else this.SUs_.ER_(l,u);this.SUs_.dI_(c);if(this.Eii_){this.$Us_();this.tYs_={r9t_:o.r9t_,o9t_:o.o9t_,l9t_:o.l9t_,u9t_:o.u9t_};for(let t=0;t<l.length;++t){const i=Math.round(l[t]),s=Math.round(u[t]),e=this.iYs_.length;if(e===0||this.iYs_[e-1]!==i&&this.sYs_[e-1]!==s){this.iYs_.push(i);this.sYs_.push(s)}l[t]<this.eYs_.r9t_&&(this.eYs_.r9t_=l[t]);u[t]<this.eYs_.o9t_&&(this.eYs_.o9t_=u[t]);l[t]>this.eYs_.l9t_&&(this.eYs_.l9t_=l[t]);u[t]>this.eYs_.u9t_&&(this.eYs_.u9t_=u[t])}this.SUs_.dI_(this.GUs_);this.VUs_(this.iYs_,this.sYs_,this.tYs_.r9t_,this.tYs_.o9t_,this.tYs_.l9t_,this.tYs_.u9t_,this.eYs_.r9t_,this.eYs_.o9t_,this.eYs_.l9t_,this.eYs_.u9t_);this.$Us_();this.SUs_.dI_(c)}return this}MR_(t,i,s,e,A,n,h){this.TUs_();if(!this.UU_["trajectory"])return this;const r=n-A>=Math.PI*2;if(r){A=0;n=Math.PI*2}const o=yu.sS_(t,i,s*2,s*2,A,n),l=yu.sS_(t,i,e*2,e*2,A,n,!0);let u;if(r){this.beginPath();let t=o[0];this.moveTo(t.xN_(),t.LN_());for(u=0;u<o.length;++u){t=o[u];this.bezierCurveTo(t.UN_(),t.YN_(),t.TN_(),t.KN_(),t.HN_(),t.qN_())}t=l[l.length-1];this.moveTo(t.HN_(),t.qN_());for(u=l.length-1;u>=0;--u){t=l[u];this.bezierCurveTo(t.TN_(),t.KN_(),t.UN_(),t.YN_(),t.xN_(),t.LN_())}this.closePath();this.SUs_.sQ_();this.SUs_.stroke()}else{const t=[],i=[],s={r9t_:Number.POSITIVE_INFINITY,o9t_:Number.POSITIVE_INFINITY,l9t_:Number.NEGATIVE_INFINITY,u9t_:Number.NEGATIVE_INFINITY};for(u=0;u<o.length;++u)this._Us_(o[u],t,i,s);for(u=0;u<l.length;++u)this._Us_(l[u],t,i,s);const e=this.SUs_.Ji_();this.SUs_.dI_(this.GUs_);this.SUs_.ER_(t,i);this.SUs_.dI_(e)}return this}drawImage(t,i,s,e,A,n,h,r,o){typeof t.getCanvas=="function"&&(t=t.getCanvas());if(e===void 0){n=i;h=s;r=e=t.width;o=A=t.height;i=0;s=0}const l=this._tr.transform(new mA(n,h,n+r,h+o)),u=Math.ceil(l.Ie_()),a=Math.ceil(l.Ts_());if(u===0||a===0)return this;const g=Math.ceil(l.Qe_()),c=Math.ceil(l.pe_()),I=fr.zw_(g,c,!1,!1,1),f=undefined;I.tQ_(this._tr).drawImage(t,i,s,e,A,n,h,r,o);const C=I.eQ_(Math.floor(l.we_()),Math.floor(l.Ee_()),u,a).getData(),d=this._tr.transform(new lA(n,h),tgt),B=this._tr.transform(new lA(n+r,h),igt),w=this._tr.transform(new lA(n,h+o),sgt),Q=this._tr.transform(new lA(n+r,h+o),egt),E=new In([d.x,B.x,Q.x,w.x],[d.y,B.y,Q.y,w.y]);this.wUs_.LFs_([d,B,Q,w],this.Us_,this.GUs_,!0);if(this.Us_.length<3){this.Us_=[];return this}if(this.UU_["webglrendering"]){const n=[],h=[],r=[],o=[],l=[];let u=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,I=Number.POSITIVE_INFINITY,f=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY,d=Number.NEGATIVE_INFINITY,B;for(B=0;B<this.Us_.length;B++){const t=this.Us_[B],i=this._tr.uI_(this.wUs_.uI_(t)),s=i.getX(),e=i.getY();if(isNaN(s)||isNaN(e)){l.push(null);continue}l.push(i);u=Math.min(s,u);a=Math.min(e,a);g=Math.max(s,g);c=Math.max(e,c);const A=t.getX(),n=t.getY();I=Math.min(A,I);f=Math.min(n,f);C=Math.max(A,C);d=Math.max(n,d)}if(NA.equals(C,I,1)||NA.equals(d,f,1))return this;const w=(g-u)*t.width/e,Q=(c-a)*t.height/A,E=u+i/e*(g-u),p=a+s/A*(c-a);for(B=0;B<this.Us_.length;B++)if(l[B]!=null){n.push((l[B].getX()-E)/w);h.push((l[B].getY()-p)/Q);r.push(this.Us_[B].getX()-I);o.push(this.Us_[B].getY()-f)}const m=rP.lsi_(t,{width:C-I,height:d-f,source:{x:r,y:o},destination:{x:n,y:h}});rgt=rgt||fr.zw_(m.width,m.height);rgt.setSize(m.width,m.height);rgt.drawImage(m,0,0);const y=this.SUs_.Ji_();this.SUs_.dI_(this.GUs_);this.SUs_.drawImage(rgt,I,f);this.SUs_.dI_(y);return this}const p=[],m=[];let y=+1/0,D=+1/0,M=-1/0,v=-1/0;for(let t=0;t<this.Us_.length;++t){const i=this.Us_[t].getX(),s=this.Us_[t].getY();i<y&&(y=i);s<D&&(D=s);i>M&&(M=i);s>v&&(v=s);p.push(i);m.push(s)}this.Us_=[];const b=new Mn;b.union(ngt.Qt_(p,m),b);const N=Math.min(d.x,B.x,w.x,Q.x),S=Math.min(d.y,B.y,w.y,Q.y);y=Math.floor(y);D=Math.floor(D);M=Math.ceil(M);v=Math.ceil(v);const G=Math.min(100,Math.max(M-y,v-D));let R,k,F,x;I.setSize(G,G);const L=this.SUs_.Ji_();this.SUs_.dI_(this.GUs_);for(let t=y;t<M;t+=G)for(let i=D;i<v;i+=G){const s=I.gJ_(G,G),e=s.getData();R=Math.min(t+G,M);x=Math.min(i+G,v);hgt.Qt_([t,R,R,t],[i,i,x,x]);const A=b.intersect(hgt);if(!A.length)continue;k=+1/0;x=-1/0;R=-1/0;F=+1/0;for(let t=0;t<A.length;t++){k=Math.min(k,Math.min.apply(null,A[t].Bt_()));R=Math.max(R,Math.max.apply(null,A[t].Bt_()));x=Math.max(x,Math.max.apply(null,A[t].wt_()));F=Math.min(F,Math.min.apply(null,A[t].wt_()))}let n=!1;for(let s=Math.floor(k);s<Math.ceil(R);++s)for(let A=Math.floor(F);A<Math.ceil(x);++A){let h=0,r=0,o=0,l=0;const g=tgt.vs_(s,A),c=s-t,I=A-i,f=this.wUs_.uI_(g),d=sgt.vs_(aat.int(f.getX()-N),aat.int(f.getY()-S));if(!E.contains(f.getX(),f.getY()))continue;const B=this.wUs_.qFs_(g,1);if(!B)continue;let w=0;for(let t=0;t<B.getSize();++t){const i=B.get(t),s=d.x+i.dx,e=d.y+i.dy;if(s<0||e<0||s>=u||e>=a)continue;let A=(s+e*u)*4;h+=C[A++]*i.area;r+=C[A++]*i.area;o+=C[A++]*i.area;l+=C[A]*i.area;w+=i.area}if(l<NA.Je_||w===0)continue;let Q=(c+I*G)*4;e[Q++]=h/w;e[Q++]=r/w;e[Q++]=o/w;e[Q]=l/w;n=!0}if(n){I.clear();I.km_(s,0,0);this.SUs_.drawImage(I,t,i)}}this.SUs_.dI_(L);return this}drawText(t,i,s){this.TUs_();if(!this.UU_["trajectory"])return this;if(Agt(this.LUs_)){this.WUs_();return this}const e=this.wUs_.transform(new lA(t,i),this._tr),A=this.wUs_.transform(new lA(t+1,i),this._tr),n=this.SUs_.Ji_(),h=Math.atan2(A.getY()-e.getY(),A.getX()-e.getX()),r=Gn.FI_(h,e.getX(),e.getY());this.SUs_.dI_(r);this.SUs_.drawText(e.getX(),e.getY(),s);this.SUs_.dI_(n);return this}beginPath(){this.TUs_();if(!this.UU_["trajectory"])return this;this.$Us_();this.SUs_.beginPath();return this}moveTo(t,i){this.TUs_();if(!this.UU_["trajectory"]||this.UUs_)return this;this.AYs_=t;this.nYs_=i;this.RUs_=t;this.kUs_=i;tgt.vs_(t,i);tgt=this.wUs_.transform(tgt,this._tr);const s=undefined;this.SUs_.Ji_().aI_(tgt,tgt);this.SUs_.moveTo(tgt.getX(),tgt.getY());return this}$Us_(){this.tYs_={r9t_:Number.POSITIVE_INFINITY,o9t_:Number.POSITIVE_INFINITY,l9t_:Number.NEGATIVE_INFINITY,u9t_:Number.NEGATIVE_INFINITY};this.eYs_={r9t_:Number.POSITIVE_INFINITY,o9t_:Number.POSITIVE_INFINITY,l9t_:Number.NEGATIVE_INFINITY,u9t_:Number.NEGATIVE_INFINITY};this.iYs_=[];this.sYs_=[]}ZUs_(t,i){if(!this.Eii_||!this.tYs_)return;const s=bn.getBoundingBox(t);s.we_()<this.tYs_.r9t_&&(this.tYs_.r9t_=s.we_());s.Ee_()<this.tYs_.o9t_&&(this.tYs_.o9t_=s.Ee_());s.Qe_()>this.tYs_.l9t_&&(this.tYs_.l9t_=s.Qe_());s.pe_()>this.tYs_.u9t_&&(this.tYs_.u9t_=s.pe_());const e=bn.getBoundingBox(i);e.we_()<this.eYs_.r9t_&&(this.eYs_.r9t_=e.we_());e.Ee_()<this.eYs_.o9t_&&(this.eYs_.o9t_=e.Ee_());e.Qe_()>this.eYs_.l9t_&&(this.eYs_.l9t_=e.Qe_());e.pe_()>this.eYs_.u9t_&&(this.eYs_.u9t_=e.pe_());this.iYs_||(this.iYs_=[]);this.sYs_||(this.sYs_=[]);for(let t=0;t<i.length;++t){const s=i[t].getX(),e=i[t].getY(),A=this.iYs_.length;if(!(A>1&&this.iYs_[A-1]===s&&this.sYs_[A-1]===e)){this.iYs_.push(s);this.sYs_.push(e)}}}lineTo(t,i){this.TUs_();if(!this.UU_["trajectory"]||this.UUs_)return this;const s=tgt.vs_(this.RUs_,this.kUs_),e=igt.vs_(t,i);this.Us_=[];this.wUs_.LFs_([s,e],this.Us_,this._tr,!1);const A=this.SUs_.Ji_();for(let t=0;t<this.Us_.length;++t){const i=sgt.vs_(this.Us_[t].getX(),this.Us_[t].getY());A.aI_(i,i);this.SUs_.lineTo(i.getX(),i.getY())}this.ZUs_([s,e],this.Us_);this.Us_=[];this.RUs_=t;this.kUs_=i;return this}arcTo(t,i,s,e,A){this.TUs_();if(!this.UU_["trajectory"]||this.UUs_)return this;const n=aat.oxs_(this.RUs_,this.kUs_,t,i,s,e,A);this.lineTo(n.line.xTo,n.line.yTo);this.RUs_=n.XPi_.x;this.kUs_=n.XPi_.y;const h=n.arc;this.YUs_=!0;this.DR_(h.left,h.top,2*A,2*A,h.eSt_,h.axs_,void 0,!0);this.YUs_=!1;return this}bezierCurveTo(t,i,s,e,A,n){this.TUs_();if(!this.UU_["trajectory"]||this.UUs_)return this;this.Us_=[];tgt.vs_(this.RUs_,this.kUs_);igt.vs_(t,i);sgt.vs_(s,e);egt.vs_(A,n);const h=NA.We_(tgt,igt,sgt,egt);this.wUs_.LFs_(h,this.Us_,this._tr,!1);const r=this.SUs_.Ji_();this.SUs_.dI_(this.GUs_);for(let t=0;t<this.Us_.length;++t)this.SUs_.lineTo(this.Us_[t].getX(),this.Us_[t].getY());this.SUs_.dI_(r);this.ZUs_(h,this.Us_);this.Us_=[];this.RUs_=A;this.kUs_=n;return this}stroke(){this.TUs_();if(!this.UU_["trajectory"])return this;const t=this.SUs_.Ji_();this.SUs_.dI_(this.GUs_);this.SUs_.stroke();this.SUs_.dI_(t);return this}closePath(){this.TUs_();if(!this.UU_["trajectory"])return this;this.AYs_!==void 0&&this.nYs_!==void 0&&this.lineTo(this.AYs_,this.nYs_);this.SUs_.closePath();return this}sQ_(){this.TUs_();if(this.Eii_&&this.tk_()===!1){this.VUs_(this.iYs_,this.sYs_,this.tYs_.r9t_,this.tYs_.o9t_,this.tYs_.l9t_,this.tYs_.u9t_,this.eYs_.r9t_,this.eYs_.o9t_,this.eYs_.l9t_,this.eYs_.u9t_);this.$Us_()}else this.SUs_.sQ_();return this}g_(t){this.TUs_();if(!this.UU_["trajectory"])return this;this.SUs_.g_(t);return this}aM_(){this.TUs_();return this.SUs_.aM_()}jR_(){this.TUs_();return this.SUs_?this.SUs_.jR_():null}ZR_(t,i,s){this.TUs_();return new Zat(t,i,s)}PUs_(t){this._R_(t);return this}_R_(t){this.aCi_=t!=null?t.clone():null;this.rCi_=null;return this}$R_(t){if(t!=null){const i=this.Ji_();i!=null&&(t=i.rn_(t));this._R_(t)}return this}cR_(){return this.aCi_==null?new mA(0,this.UU_["trajectory"].nIs_(),this.UU_["trackwidth"],this.UU_["trajectory"].hIs_()):this.aCi_ instanceof mA?this.aCi_:this.aCi_.getBounds()}rS_(){this.rCi_==null&&(this.rCi_=this.XR_().rn_(this.cR_()));return this.rCi_}hYs_(t,i,s){this.Us_=[];this.wUs_.LFs_(t,this.Us_,this.GUs_,s);if(this.Us_.length<1)return;let e;if(s){e=this.Us_[0];i.moveTo(e.getX(),e.getY())}for(let t=1;t<this.Us_.length;++t){e=this.Us_[t];i.lineTo(e.getX(),e.getY())}s&&i.close();this.Us_=[]}_b_(t,i,s,e){t instanceof Mn&&(t=t.Kc_());if(!this.UU_["clip"])return this;this.TUs_();const A=i!==void 0?i:QA.Et_,n=undefined;t!=null&&(s!==void 0&&s)&&!this.Ji_().isIdentity()&&this.Ji_().transform(t,t);this.PUs_(bn.Xc_(this.aCi_,t,A));let h=null;if(this.aCi_==null){const t=this.UU_["trajectory"];h=new mA(0,t.nIs_(),this.UU_["trackwidth"],t.hIs_())}else h=this.aCi_;const r=new TA;if(h instanceof mA){h=h.clone().round();tgt.vs_(h.we_(),h.Ee_());igt.vs_(h.Qe_(),h.Ee_());sgt.vs_(h.Qe_(),h.pe_());egt.vs_(h.we_(),h.pe_());this.hYs_([tgt,igt,sgt,egt],r,!0)}else if(h instanceof TA){const t=h.getTags(),i=h.getX(),s=h.getY(),e=new lA,A=new lA;let n,o;for(let l=0;l<t.length;l++){const u=h.getIndex(l);if(t[l]===LA.ZA_){e.vs_(i[u],s[u]);A.vs_(i[u],s[u]);n=this.wUs_.transform(e,this.GUs_);r.moveTo(n.getX(),n.getY())}else if(t[l]===LA.jA_){tgt.vs_(i[u],s[u]);this.hYs_([A,tgt],r);A.vs_(i[u],s[u])}else if(t[l]===LA._A_){igt.vs_(i[u],s[u]);sgt.vs_(i[u+1],s[u+1]);egt.vs_(i[u+2],s[u+2]);o=NA.We_(A,igt,sgt,egt);this.hYs_(o,r);A.vs_(i[u+2],s[u+2])}else if(t[l]===LA.tn_){const t=aat.oxs_(A.getX(),A.getY(),i[u],s[u],i[u+1],s[u+1],i[u+2]),e=t.line;tgt.vs_(e.lxs_,e.uxs_);A.vs_(e.xTo,e.yTo);this.hYs_([tgt,A],r);const n=t.arc,h=i[u+2],l=yu.sS_(n.left+h,n.top+h,2*h,2*h,n.eSt_,n.axs_);let a;for(let t=0;t<l.length;++t){a=l[t];tgt.vs_(a.xN_(),a.LN_());igt.vs_(a.UN_(),a.YN_());sgt.vs_(a.TN_(),a.KN_());egt.vs_(a.HN_(),a.qN_());o=NA.We_(tgt,igt,sgt,egt);this.hYs_(o,r)}a&&A.vs_(a.HN_(),a.qN_());const g=t.XPi_;tgt.vs_(g.x,g.y);this.hYs_([A,tgt],r);A.vs_(g.x,g.y)}else if(t[l]===LA.$A_){this.hYs_([A,e],r);r.close()}}}const o=this.SUs_.Ji_();this.SUs_.dI_(this.GUs_);this.SUs_._b_(r,QA.Et_,!1);this.SUs_.dI_(o);return this}tk_(){return!!this.SUs_&&this.SUs_.tk_()}getSelection(){return this.SUs_&&this.SUs_.tk_()?this.SUs_.getSelection():[]}pO_(t,i){this.TUs_();if(this.tk_()){this.QO_(i);t.render(this);this.EO_()}}mO_(t){this.TUs_();this.SUs_.tk_()&&this.SUs_.mO_(t);return this}vO_(t){this.TUs_();this.SUs_.tk_()&&this.SUs_.vO_(t);return this}QO_(t){this.TUs_();this.SUs_.QO_(t)}EO_(){this.TUs_();this.SUs_.EO_()}selectNode(t){this.TUs_();this.SUs_.selectNode(t)}measureText(t,i){this.TUs_();return this.SUs_.measureText(t,i)}save(){this.TUs_();const t=this.aCi_!=null?this.aCi_.clone():null;this.BCi_.push(t);this.SUs_.save();return this}restore(){this.TUs_();this.BCi_.length>0&&this.PUs_(this.BCi_.pop());this.SUs_.restore();return this}rYs_(t){this.TUs_();return this.wUs_.UFs_(t)}YFs_(){this.TUs_();return this.wUs_.YFs_()}YR_(t){this.TUs_();this.SUs_.YR_(t);this.LUs_=t;Agt(t)&&(this.UUs_=!0);return this}KR_(){this.TUs_();this.SUs_.KR_();return this}HR_(){this.TUs_();this.SUs_.HR_();return this}vR_(t){this.TUs_();this.SUs_.vR_(t);return this}iQ_(t,i){this.TUs_();if(t)if(t instanceof mr&&this.tk_()===!1){this.FUs_=i;this.Eii_=t;this.SUs_.iQ_(null)}else{this.Eii_=null;this.SUs_.iQ_(t,i)}else{this.Eii_=null;this.SUs_.iQ_(t,i)}return this}rB_(t,i){this.TUs_();this.SUs_.rB_(t,i);return this}aS_(t){this.SUs_.aS_(t);return this}cS_(){this.SUs_.cS_();return this}JR_(t,i){let s=0;const e=this.xFs_(t,i);for(let t=0;t<e.length-1;++t)s+=lA.Ss_(e[t],e[t+1]);return s}cps_(t){this.UU_["webglrendering"]=t;return this}Lps_(){return this.UU_["webglrendering"]}};s.OUs_=new _at(256,256);s=i=t([_s(null)],s);return s}(),1,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJzZXRDbGlwIjoiX2JfIiwiZHJhd1JlY3RhbmdsZSI6InBSXyIsImRyYXdMaW5lIjoib0JfIiwiZHJhd1BvbHlsaW5lIjoibVJfIiwiZHJhd1BvbHlnb24iOiJFUl8iLCJkcmF3RWxsaXBzZSI6InlSXyIsImRyYXdBcmMiOiJEUl8iLCJkcmF3QW5udWx1c0FyYyI6Ik1SXyIsInNldEZpbGxTdHlsZSI6ImlRXyIsInNldEZpbGxQYXR0ZXJuIjoidlJfIiwic2V0TGluZVN0eWxlIjoickJfIiwic2V0VGV4dFN0eWxlIjoiZ18iLCJmaWxsUGF0aCI6InNRXyIsImdldFRyYW5zZm9ybWF0aW9uIjoiSmlfIiwic2V0VHJhbnNmb3JtYXRpb24iOiJkSV8iLCJnZXRJbnZlcnNlVHJhbnNmb3JtYXRpb24iOiJYUl8iLCJjcmVhdGVSZW5kZXJpbmdTdGF0ZSI6ImpSXyIsImNyZWF0ZVN1cmZhY2UiOiJaUl8iLCJwdXNoVHJhbnNmb3JtYXRpb24iOiJ1U18iLCJnZXREZXZpY2VSZWN0IjoiY1JfIiwiZ2V0TW9kZWxSZWN0IjoiclNfIiwic2V0RGV2aWNlUmVjdCI6Il9SXyIsInNldE1vZGVsUmVjdCI6IiRSXyIsImlzUGlja2luZyI6InRrXyIsInNldEN1cnJlbnROb2RlIjoiWVJfIiwiYmVnaW5SZW5kZXJpbmciOiJLUl8iLCJlbmRSZW5kZXJpbmciOiJIUl8iLCJnZXREZXZpY2VQYXRoTGVuZ3RoIjoiSlJfIiwicGljayI6InBPXyIsInB1c2hTZWxlY3Rpb24iOiJtT18ifX19");var kCt=Ci(function(){let i=class t extends rat{constructor(t){super();const i=qi(t,{minwidth:1,maxwidth:+1/0,aspectratio:10},!0);this.OFs_=i["minwidth"];this.WFs_=i["maxwidth"];this.xZs_=i["aspectratio"]}Ie_(t,i){const s=i["trajectory"];let e;if(s.count()<2)e=i["width"]*t.BI_();else{const i=undefined;e=this.PFs_(s,t)["devicelength"]/this.xZs_}e<this.OFs_&&(e=this.OFs_);e>this.WFs_&&(e=this.WFs_);return e}};i=t([_s("geotoolkit.deviation.AspectRatioTrackWidthStrategy")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJnZXRXaWR0aCI6IkllXyJ9fX0g");var FCt=Ci(function(){let i=class t{static LZs_(t,i){const s=new tn,e=new tn;for(let A=0;A<t.length-1;++A){s.setStart(t[A]);s.setEnd(t[A+1]);for(let t=0;t<i.length-1;++t){e.setStart(i[t]);e.setEnd(i[t+1]);const A=s.gc_(e);if(A)return A}}return null}};i=t([_s("geotoolkit.deviation.ClipHelper")],i);return i}(),2,"eyJpbnRlcnNlY3RMaW5lcyI6Ikxac18iLCJnZXRDbGFzc05hbWUiOiJEXyJ9");const xCt=function(t,i,s){const e=(i.getY()-t.getY())/(i.getX()-t.getX());if(!isFinite(e))return Number.NaN;const A=undefined,n=undefined;return s-(t.getY()-e*t.getX())/e},LCt=function(t,i,s){const e=(i.getY()-t.getY())/(i.getX()-t.getX());if(!isFinite(e))return Number.NaN;const A=undefined,n=undefined;return e*s+(t.getY()-e*t.getX())};var UCt=Ci(function(){var i;let s=i=class t extends Cg{constructor(t,i,s){super();this.UZs_=t;this.YZs_=i;this.Fwt_=s;this.TZs_=[new lA,new lA];this.jFs_=null;this.KZs_=null;this.HZs_=[]}qZs_(t,i){if(this.UZs_&&!t.equals(this.jFs_)||!i.TFs_().RI_(this.KZs_)){const s=new lA;this.HZs_=[];let e=0;const A=this.UZs_.qUs_();if(A!=null){const t=undefined,i=undefined;e=A["trackwidth"]/2-A["offset"]}else e=0;for(let A=0;A<t.count();++A){s.vs_(e,t.G2_(A));const n=i.transform(s);this.HZs_.push(n)}this.jFs_=t;this.KZs_=i.TFs_()}return this.HZs_}static JZs_(t){if(!t||t.length<1)return null;let i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,A=Number.NEGATIVE_INFINITY,n,h,r,o,l,u,a,g;for(let c=0;c<t.length;++c){const I=t[c],f=I.getX(),C=I.getY();if(f<i){i=f;n=I;l=c}if(f>e){e=f;r=I;a=c}if(C<s){s=C;h=I;u=c}if(C>A){A=C;o=I;g=c}}return{PZs_:l,VZs_:u,OZs_:a,WZs_:g,zZs_:n,XZs_:h,jZs_:r,ZZs_:o}}_1t_(){return this.Fwt_}transform(t){if(!this.UZs_||!this.UZs_.qUs_())return t;const s=this.UZs_.qUs_()["trajectory"];if(!s||s.count()<2)return t;const e=this.UZs_._Zs_();if(!e)return t;const A=this.Fwt_.KH_()===fg.ax_,n=this.Fwt_.b__().mE_(),h=this.UZs_.getRoot(),r=h instanceof Ic?h.$Y_():new mA;let o;if(A){o=t*n.sI_()+n.pI_();this.TZs_[0].vs_(r.we_(),o);this.TZs_[1].vs_(r.Qe_(),o)}else{o=t*n.BI_()+n.EI_();this.TZs_[0].vs_(o,r.Ee_());this.TZs_[1].vs_(o,r.pe_())}const l=this.qZs_(s,e);let u=FCt.LZs_(this.TZs_,l);if(u==null&&l&&l.length>0){const t=i.JZs_(l);if(t)if(A){let i;o<=t.XZs_.getY()?t.VZs_===0?i=xCt(l[0],l[1],o):t.VZs_===l.length-1&&(i=xCt(l[l.length-2],l[l.length-1],o)):o>=t.ZZs_.getY()&&(t.WZs_===0?i=xCt(l[0],l[1],o):t.WZs_===l.length-1&&(i=xCt(l[l.length-2],l[l.length-1],o)));isFinite(i)&&(u=new lA(i,o))}else{let i;o<=t.zZs_.getX()?t.PZs_===0?i=LCt(l[0],l[1],o):t.PZs_===l.length-1&&(i=LCt(l[l.length-2],l[l.length-1],o)):o>=t.jZs_.getX()&&(t.OZs_===0?i=LCt(l[0],l[1],o):t.OZs_===l.length-1&&(i=LCt(l[l.length-2],l[l.length-1],o)));isFinite(i)&&(u=new lA(o,i))}}if(u==null)return t;const a=e.uI_(u);if(a===null||!NA.Ve_(a.getX())||!NA.Ve_(a.getY()))return t;const g=a.getY(),c=this.YZs_.transform(g,!1),I=s.$Zs_(c);let f;f=I?A?I.getY():I.getX():t;return f}};s=i=t([_s("geotoolkit.deviation.axis.DeviatedValueTransformer")],s);return s}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJnZXRBeGlzIjoiXzF0XyJ9fX0g");var YCt=Ci({z_:"Left",ne_:"Center",X_:"Right"},2,"eyJMZWZ0Ijoiel8iLCJDZW50ZXIiOiJuZV8iLCJSaWdodCI6IlhfIn0g");var TCt=function(){let i=class t{constructor(t,i,s,e){this.Di_=t||0;this.sb_=i||0;this.K7_=s||0;this.Gqi_=e||null}line(){return this.Gqi_}error(){return this.K7_}CUs_(){return this.Di_}dUs_(){return this.sb_}count(){return this.sb_-this.Di_+1}copy(t){this.Di_=t.Di_;this.sb_=t.sb_;this.K7_=t.K7_;this.Gqi_=t.Gqi_;return this}};i=t([_s("geotoolkit.deviation.PiecewiseLinearApproximation")],i);return i}();var KCt=function(){var t;return class{constructor(){this.t_s_=new lA;this.i_s_=new lA;this.s_s_=0;this.e_s_=0;this.A_s_=new lA}}}(),HCt=function(){let i=class t{constructor(t,i,s){this.jFs_=t;this.n_s_=i;this.h_s_=s;this.r_s_=0;this.o_s_=t==null?0:t.count();this._o=new TCt;this.l_s_=[];for(let t=0;t<this.o_s_;++t)this.l_s_[t]=this.n_s_.transformPoint(this.u_s_(t));this.next()}a_s_(t){return t>=0&&t<this.o_s_?this.l_s_[t]:new lA}u_s_(t){return t>=0&&t<this.o_s_?new lA(this.jFs_.getX(t),this.jFs_.getY(t)):new lA}depth(t){return t>=0&&t<this.o_s_?this.jFs_.G2_(t):0}object(){return this._o}end(){return this.o_s_===0||this.r_s_===this.o_s_-1}next(){this._o.dUs_()&&(this.r_s_=this._o.dUs_());this.end()||(this._o=this.RLs_())}center(t,i){let s=0,e=0;const A=i-t+1;for(let A=t;A<=i;++A){const t=this.a_s_(A);s+=t.getX();e+=t.getY()}return new lA(s/A,e/A)}g_s_(t,i,s){const e=this.center(t,i);let A=0,n=0,h=0;for(let s=t;s<=i;++s){const t=this.a_s_(s),i=t.getX()-e.getX(),r=t.getY()-e.getY();A+=r*r;n-=i*r;h+=i*i}s.A_s_=e;const r=A+h,o=(A-h)*.5,l=Math.sqrt(n*n+o*o);s.e_s_=r*.5+l;s.i_s_.vs_(-n,o-l);const u=aat._Fs_(s.i_s_,s.i_s_);if(u===0)s.i_s_.vs_(1,0);else{const t=Math.sqrt(u);s.i_s_.vs_(s.i_s_.getX()/t,s.i_s_.getY()/t)}s.s_s_=r-s.e_s_;s.t_s_=new lA(-s.i_s_.getY(),s.i_s_.getX())}c_s_(t,i,s,e,A){const n=i*(this.depth(s)-t),h=lA.Ss_(A,e);return Math.abs(n-h)}I_s_(t,i,s){if(i-t<2)return 0;const e=new cat(s.i_s_,-aat._Fs_(s.i_s_,s.A_s_));let A=0;for(let s=t;s<=i;++s){const t=Math.abs(e.distance(this.a_s_(s)));A<t&&(A=t)}return A}f_s_(t,i,s){if(i-t<2)return!0;const e=new cat(s.i_s_,-aat._Fs_(s.i_s_,s.A_s_)),A=e.project(this.a_s_(t)),n=e.project(this.a_s_(i)),h=this.depth(t),r=this.depth(i);if(Math.abs(r-h)<NA.Je_)return!1;const o=lA.Ss_(A,n)/(r-h);let l,u=t+1;while(u<=i&&(l=e.project(this.a_s_(u)))===A){if(this.c_s_(h,o,u,A,l)>this.h_s_.getX())return!1;++u}if(u>i)return!0;l=e.project(this.a_s_(u));if(this.c_s_(h,o,u,A,l)>this.h_s_.getX())return!1;const a=NA.sign(l.getX()-A.getX()),g=NA.sign(l.getY()-A.getY());for(let t=u+1;t<=i;++t){const i=e.project(this.a_s_(t));if(this.c_s_(h,o,t,A,i)>this.h_s_.getX())return!1;if(i!==l){if(NA.sign(i.getX()-l.getX())!==a||NA.sign(i.getY()-l.getY())!==g)return!1;l=i}}return!0}RLs_(){let t=this.o_s_-this.r_s_-1,i,s,e=this.r_s_+1,A=new KCt;const n=new KCt;let h,r;if(t>1)while(t>0){i=Math.floor(t/2);s=e+i;this.g_s_(this.r_s_,s,n);r=Math.abs(n.s_s_)>NA.Je_?Math.sqrt(Math.abs(n.s_s_)):0;if(r<=this.h_s_.getY()&&this.f_s_(this.r_s_,s,n)){A=n;h=r;e=s;t-=i+1}else t=i}else{this.g_s_(this.r_s_,this.o_s_-1,A);h=0;e=this.o_s_-1}return new TCt(this.r_s_,e,h,new cat(A.i_s_,-aat._Fs_(A.i_s_,A.A_s_)))}};i=t([_s("geotoolkit.deviation.PiecewiseLinearIteratorImpl")],i);return i}();var qCt=Ci(function(){let i=class t extends rat{constructor(t){super();const i=qi(t,{minwidth:1,maxwidth:+1/0,widthscale:25},!0);this.OFs_=i["minwidth"];this.WFs_=i["maxwidth"];this.C_s_=i["widthscale"]}Ie_(t,i){let s=i["width"];const e=i["trajectory"];let A;if(e.count()<2)A=1;else{const i=this.PFs_(e,t);A=i["devicelength"]/i["length"]}s*=this.C_s_*A;s<this.OFs_&&(s=this.OFs_);s>this.WFs_&&(s=this.WFs_);return s}N_(){return{maxwidth:this.WFs_,minwidth:this.OFs_,widthscale:this.C_s_}}dt_(t){if((t=Es(t))==null)return this;t["minwidth"]&&(this.OFs_=t["minwidth"]);t["maxwidth"]&&(this.WFs_=t["maxwidth"]);t["widthscale"]&&(this.C_s_=t["widthscale"]);return this}};i=t([_s("geotoolkit.deviation.ProportionalWidthStrategy")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJnZXRXaWR0aCI6IkllXyIsImdldFByb3BlcnRpZXMiOiJOXyIsInNldFByb3BlcnRpZXMiOiJkdF8ifX19");const JCt=function(t){if(t==null)return null;const i=t.getParent();return i==null?null:ys(i,Vm)?i:JCt(i)};var PCt=function(){let i=class t extends SS{constructor(t,i,s){super(t,null,s);this.d_s_=null;this.B_s_=null;this.lkt_=()=>{const t=this.d_s_.if_().transform(this.d_s_.w_s_());this.B_s_.ht_(this.Jgt_.if_().uI_(t));this.NY_&&this.B_s_.xb_(new wh(TA.fromRect(this.d_s_.getParent().ot_())))};this.ukt_(i,JCt(i))}gkt_(){return this.d_s_}ukt_(t,i){this.JP_=t;this.d_s_=i;this.B_s_=this.d_s_.m5i_?this.d_s_.m5i_():this.d_s_.clone();this.B_s_.HC_("ghost_node");this.lkt_();this.d_s_.on(rh.rC_,this.lkt_);this.Jgt_.GY_(this.B_s_);return this}contains(t){const i=this.d_s_.uI_(t);return!isNaN(i.getX())&&!isNaN(i.getY())}ckt_(t,i,s){i=this.d_s_.uI_(i);return!isNaN(i.getX())&&!isNaN(i.getY())&&super.ckt_(t,i,s)}Ikt_(t){t=this.d_s_.uI_(t);return isNaN(t.getX())||isNaN(t.getY())?null:this.d_s_.if_().transform(t)}fkt_(t){t=this.d_s_.if_().uI_(t);return this.d_s_.transform(t)}Ckt_(t){t=this.Jgt_.if_().transform(t);t=this.d_s_.uI_(t).clone();return isNaN(t.getX())||isNaN(t.getY())?null:t}dkt_(t){if(!t)return null;t=this.d_s_.transform(new lA(this.d_s_.rt_().Ie_()/2,t.getY()));return this.Jgt_.if_().uI_(t)}intersect(t){const i=this.d_s_.DF_(this.Jgt_.if_().rI_());i.Sc_(t);const s=i.Bt_(),e=i.wt_(),A=this.Jgt_.if_();let n=+1/0,h=-1/0;for(let t=0;t<i.getSize();t++){const i=this.d_s_.uI_(A.transform(new lA(s[t],e[t])));i.getY()<n&&(n=i.getY());i.getY()>h&&(h=i.getY())}return new mA(0,n,this.d_s_.rt_().Ie_(),h)}Bkt_(){return!0}mgt_(){return this.B_s_}dispose(){if(this.d_s_){this.d_s_.off(rh.rC_,this.lkt_);this.d_s_=null}if(this.B_s_){this.B_s_.KY_();this.B_s_.dispose();this.B_s_=null}}static bi_(t){return JCt(t)!=null}static wkt_(){return 2}};i=t([_s("geotoolkit.deviation.tools.DeviatedAdapter")],i);return i}();var VCt=Ci({hqt_:"DataChanged"},2,"eyJEYXRhQ2hhbmdlZCI6ImhxdF8ifSAg");const OCt=.001,WCt=function(t,i){return t&&i&&t.mn_()===i.mn_()&&t.fn_()===i.fn_()},zCt=function(t,i,s,e,A){const n=undefined;return(A-e)/(s-i)*(t-i)+e},XCt=(t,i,s,e)=>{const A=t-i,n=s-e;return Math.sqrt(A*A+n*n)},jCt=new lA,ZCt=new lA;var _Ct=Ci(function(){var i;let s=i=class t extends $n{constructor(t,i,s){super();this.Fzt_=!1;this.Q_s_=OA.Ai_();this.UU_={depthinterval:OCt,units:{distance:"ft"}};this.E_s_=null;this.p_s_=null;this.m_s_=null;this.reset();if(t){if(!Array.isArray(t)){const e=t["data"],A=t["options"];t=e["x"];i=e["y"];s=e["d"];qi(A,this.UU_)}this.EGt_({x:t,y:i,d:s})}}EGt_(t){const i=t["x"],s=t["y"];let e=t["d"],A;if(!i||i.length<1||!s||s.length<1||i.length!==s.length)return;if(!e){e=[0];for(A=1;A<i.length;A++)e.push(e[A-1]+XCt(i[A],i[A-1],s[A],s[A-1]))}const n=this.mf_();this.yf_(!0).clear().add(i,s,e).yf_(n).y_s_(this.UU_["units"]);this.D_s_();this.$Mt_()}M_s_(t,i,s,e,A,n){let h=!1;if(t&&!WCt(t,i)&&t.Qn_(i)){const s=[];this._x.forEach((function(e){const A=t.wn_(e,i);s.push(A)}));this._x=s;h=!0}if(s&&!WCt(s,e)&&s.Qn_(e)){const t=[];this._y.forEach((function(i){const A=s.wn_(i,e);t.push(A)}));this._y=t;h=!0}if(A&&!WCt(A,n)&&A.Qn_(n)){if(this.E_s_===this.p_s_){const t=[];this._d.forEach((function(i){const s=A.wn_(i,n);t.push(s)}));this._d=t}h=!0}if(h){this.D_s_();this.$Mt_()}}y_s_(t){if(!t)return this;const i=this.E_s_,s=this.p_s_,e=this.m_s_;let A;if(t["distance"]!==void 0){A=this.Q_s_.gn_(t["distance"]);if(!A||!A.En_("length"))throw new TypeError("distance-unit must belong to length units!");this.E_s_=A;this.p_s_=A;this.m_s_=A;this.UU_["units"]["x"]=t["distance"];this.UU_["units"]["y"]=t["distance"]}else{i||t["x"]||(t["x"]=t["y"]);s||t["y"]||(t["y"]=t["x"]);if(t["x"]){A=this.Q_s_.gn_(t["x"]);if(!A||!A.En_("length"))throw new TypeError("x-unit must belong to length units!");this.E_s_=A;this.UU_["units"]["x"]=t["x"]}if(t["y"]){A=this.Q_s_.gn_(t["y"]);if(!A||!A.En_("length"))throw new TypeError("y-unit must belong to length units!");this.p_s_=A;this.UU_["units"]["y"]=t["y"]}}this.M_s_(i,this.E_s_,s,this.p_s_,e,this.m_s_);return this}v_s_(){this.E_s_||this.y_s_(this.UU_["units"]);return this.E_s_}b_s_(){this.p_s_||this.y_s_(this.UU_["units"]);return this.p_s_}N_s_(){this.m_s_||this.y_s_(this.UU_["units"]);return this.m_s_}S_s_(){return Pi(this.UU_["units"],{})}static Wi_(t){if(!t)return null;if(t instanceof i){t["id"]=nh.u_();return t}const s=new i({data:{x:t["x"],y:t["y"],d:t["md"]}});t["id"]===void 0&&(t["id"]=nh.u_());s["id"]=t["id"];return s}D_s_(){if(!this.Fzt_){this.kQt_=Math.min.apply(null,this._x);this.FQt_=Math.max.apply(null,this._x);this.LQt_=Math.min.apply(null,this._y);this.UQt_=Math.max.apply(null,this._y);this.SEs_=Math.min.apply(null,this._d);this.GEs_=Math.max.apply(null,this._d)}}$Zs_(t,i){const s=this._d.length;if(s<2){ki("Can not extrapolate: less than 2 stations!");return null}i||(i=new lA);let e,A;if(t<=this._d[0]){e=0;A=1}else if(t>=this._d[s-1]){e=s-2;A=s-1}else for(let i=1;i<s;++i)if(t<this._d[i]){e=i-1;A=i;break}const n=zCt(t,this._d[e],this._d[A],this._x[e],this._x[A]),h=zCt(t,this._d[e],this._d[A],this._y[e],this._y[A]);i.vs_(n,h);return i}G_s_(t){if(this._d.length<2){Gi("Can not extrapolate: less than 2 stations!");return!1}const i=1,s=0,e=zCt(t,this._d[i],this._d[s],this._x[i],this._x[s]),A=zCt(t,this._d[i],this._d[s],this._y[i],this._y[s]);if(Math.abs(t-this._d[s])<this.UU_["depthinterval"]){this._x[s]=e;this._y[s]=A;this._d[s]=t}else{this._x.unshift(e);this._y.unshift(A);this._d.unshift(t)}this.D_s_();return!0}R_s_(t){if(this._d.length<2){Gi("Can not extrapolate: less than 2 stations!");return!1}const i=this._x.length-2,s=this._x.length-1,e=zCt(t,this._d[i],this._d[s],this._x[i],this._x[s]),A=zCt(t,this._d[i],this._d[s],this._y[i],this._y[s]);if(Math.abs(t-this._d[s])<this.UU_["depthinterval"]){this._x[s]=e;this._y[s]=A;this._d[s]=t}else{this._x.push(e);this._y.push(A);this._d.push(t)}this.D_s_();return!0}getX(t){return this._x[t]}XUs_(){return this._x.slice()}getY(t){return this._y[t]}jUs_(){return this._y.slice()}G2_(t){return this._d[t]}mcs_(){return this._d.slice()}count(){return this._x?this._x.length:0}nIs_(){return this.SEs_}hIs_(){return this.GEs_}fUs_(t,i,s){return new HCt(this,t,new lA(s,i))}static k_s_(t,s,e,A,n,h,r){const o={rightdeviation:!0,start:0,filter:!0,approximate:!0,depthinterval:OCt,units:{distance:"ft",angle:"deg"}};let l,u;if(Array.isArray(t)){l=t;u=Pi({rightdeviation:A,start:n,filter:h,approximate:r},o,!0)}else{l=t["data"]["md"];s=t["data"]["inclination"];u=Pi(t["options"],o,!0)}A=u["rightdeviation"];n=u["start"];h=u["filter"];r=u["approximate"];const a=u["depthinterval"],g=u["units"];if(!l||!s||l.length!==s.length)return null;let c;for(c=0;c<l.length-1;++c)if(l[c+1]<l[c])return null;if(u!=null&&u["md"]!=null){const t=u["md"]["min"];if(t!=null&&t>l[0])for(c=0;c<l.length;++c){if(t===l[c]){l=l.slice(c);s=s.slice(c);break}if(t<l[c]){l=l.slice(c-1);l[0]=t;s=s.slice(c-1);break}}const i=u["md"]["max"];if(i!=null&&i<l[l.length-1])for(c=l.length-1;c>-1;--c){if(i===l[c]){l=l.slice(0,c+1);s=s.slice(0,c+1);break}if(i>l[c]){l=l.slice(0,c+2);l[l.length-1]=i;s=s.slice(0,c+2);break}}}const I=new lA,f=new lA,C=new lA;n=n||0;h=h===void 0||h;r=r===void 0||r;A=A===void 0||A;const d=OA.Ai_(),B=d.gn_(g["angle"]),w=d.gn_("rad"),Q=l.length,E=[],p=[],m=[];let y=n,D=l[0],M,v,b,N,S=0;for(c=0;c<Q;c++){let t=A?s[c]:-s[c];t=B.wn_(t,w);if(c!==0){N=l[c]-m[S];y+=N*Math.sin(b);D+=N*Math.cos(b);if(h){if(S>=0){I.vs_(E[S-1],p[S-1]);f.vs_(E[S],p[S]);C.vs_(y,D);const t=lA.Ss_(f,C),i=t<NA.Je_,s=S>0&&!i&&aat.rxs_(I,f,C);if(!i){if(s){const i=lA.Ss_(I,f),s=undefined;Math.abs(t/i-N/(m[S]-m[S-1]))<NA.Je_||++S}else++S;E[S]=y;p[S]=D;m[S]=l[c]}}}else{++S;E[S]=y;p[S]=D;m[S]=l[c]}b=t;m[S]>v&&(v=m[S]);m[S]<M&&(M=m[S])}else{E[0]=y;p[0]=D;m[0]=l[c];b=t;v=l[c];M=l[c]}}return S>0?new i({data:{x:E,y:p,d:m},options:{approximate:r,depthinterval:a,units:g}}):null}F_s_(){return this.kQt_}x_s_(){return this.LQt_}L_s_(){return this.FQt_}U_s_(){return this.UQt_}Y_s_(t,i){if(t<0||t>this._x.length-1)throw Error("Removal index out of bounds");i===void 0&&(i=1);if(i!==0){this._x.splice(t,i);this._y.splice(t,i);this._d.splice(t,i);this.D_s_();this.$Mt_()}}static T_s_(t,i,s){let e,A;for(e=s;e<t.count();++e)for(A=s;A<i.count();++A)if(t._x[e]===i._x[A]&&t._y[e]===i._y[A])return{K_s_:e,H_s_:A};return null}static q_s_(t,s){if(t.count()<1||s.count()<1)return;if(t._x[0]!==s._x[0]||t._y[0]!==s._y[0])return;let e=0,A;while(1){A=-1;const n=Math.min(t.count(),s.count());for(let i=e;i<n;++i)if(t._x[i]!==s._x[i]||t._y[i]!==s._y[i]){A=i;break}if(A===-1)return;let h=i.T_s_(t,s,A);if(h){t.Y_s_(h.K_s_-A);s.Y_s_(h.H_s_-A)}else{h=i.T_s_(s,t,A);if(h){t.Y_s_(h.H_s_-A);s.Y_s_(h.K_s_-A)}}if(!h)return;e=A}}static J_s_(t){!t||t.length<2||t.length===2&&i.q_s_(t[0],t[1])}equals(t){if(!t||this.count()!==t.count()||this.F_s_()!==t.F_s_()||this.L_s_()!==t.L_s_()||this.x_s_()!==t.x_s_()||this.U_s_()!==t.U_s_())return!1;for(let i=0;i<this.count();i++)if(this.getX(i)!==t.getX(i)||this.getY(i)!==t.getY(i)||this.G2_(i)!==t.G2_(i))return!1;return!0}N_(){return{options:Pi(this.UU_,{}),data:{d:Ji(this._d),x:Ji(this._x),y:Ji(this._y)}}}dt_(t){if((t=Es(t))==null)return this;t["options"]!==void 0&&qi(t["options"],this.UU_);t["data"]!==void 0&&this.EGt_(t["data"]);return this}add(t,i,s){if(Array.isArray(t)&&Array.isArray(i)){const e=Array.isArray(s)?s:null;let A=Math.min(t.length,i.length);e!=null&&(A=Math.min(A,e.length));const n=this.mf_();this.yf_(!0);this.Fzt_=!0;for(let s=0;s<A;s++)this.add(t[s],i[s],e!=null?e[s]:void 0);this.Fzt_=!1;this.yf_(n);this.D_s_();this.$Mt_();return this}const e=t,A=i;let n=s;const h=this.count();if(h>0){const t=this.getX(h-1),i=this.getY(h-1),s=this.G2_(h-1);n==null&&(n=XCt(e,t,A,i));if(Math.abs(n-s)<this.UU_["depthinterval"])return this;jCt.vs_(t,i);ZCt.vs_(e,A);if(lA.Ss_(jCt,ZCt)<NA.Je_)return this}else n==null&&(n=0);this._x.push(e);this._y.push(A);this._d.push(n);this.D_s_();this.$Mt_();return this}shift(t){if(this.count()===0||t<=0)return this;if(t>=this.count())return this.clear();this.Y_s_(0,t);return this}clear(){const t=this.count();this.reset();t!==this.count()&&this.$Mt_();return this}$Mt_(){this.notify(VCt.hqt_,this)}reset(){this._x=[];this._y=[];this._d=[];this.GEs_=Number.NEGATIVE_INFINITY;this.SEs_=Number.POSITIVE_INFINITY;this.UQt_=Number.NEGATIVE_INFINITY;this.LQt_=Number.POSITIVE_INFINITY;this.FQt_=Number.NEGATIVE_INFINITY;this.UQt_=Number.POSITIVE_INFINITY;return this}};s=i=t([_s("geotoolkit.deviation.Trajectory2d")],s);return s}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJpbnRlcnBvbGF0ZVhZIjoiJFpzXyIsImdldEFycmF5WCI6IlhVc18iLCJnZXRBcnJheVkiOiJqVXNfIiwiZ2V0RGVwdGgiOiJHMl8iLCJnZXREZXB0aHMiOiJtY3NfIiwibWluRGVwdGgiOiJuSXNfIiwibWF4RGVwdGgiOiJoSXNfIiwiZ2V0TWluWCI6IkZfc18iLCJnZXRNaW5ZIjoieF9zXyIsImdldE1heFgiOiJMX3NfIiwiZ2V0TWF4WSI6IlVfc18iLCJnZXRQcm9wZXJ0aWVzIjoiTl8iLCJzZXRQcm9wZXJ0aWVzIjoiZHRfIiwib25EYXRhQ2hhbmdlZCI6IiRNdF8ifX0sImZyb21PYmplY3QiOiJXaV8iLCJjcmVhdGVUcmFqZWN0b3J5Ijoia19zXyJ9");var $Ct=Ci({P_s_:"onDeviationChanged"},2,"eyJEZXZpYXRpb25DaGFuZ2VkIjoiUF9zXyJ9");RS.Ai_().register(PCt);var tdt=Ci(function(){var i;let s=i=class t extends Ic{constructor(t){super(t);this.V_s_=null;this.O_s_=null;this.rq_=null;this.bf_=null;this.jxs_=new lA;t!=null&&t["trajectorymodellimits"]!==void 0&&(this.V_s_=t["trajectorymodellimits"]!=null?new mA(t["trajectorymodellimits"]):null);this.W_s_=this.z_s_.bind(this)}addListener(t,i){ki("geotoolkit.scene.DeviatedCompositeNode.addListener is deprecated since 4.0. Use DeviatedCompositeNode.on instead");this.on(t,i);return this}removeListener(t,i){ki("geotoolkit.scene.DeviatedCompositeNode.removeListener is deprecated since 4.0. Use DeviatedCompositeNode.off instead");this.off(t,i);return this}X_s_(){this.notify($Ct.P_s_,this)}HUs_(t){if(t==null)this.O_s_=null;else{if(t["trajectory"]!=null){const i=this.qUs_();i!=null&&i["trajectory"]!=null&&i["trajectory"].off(VCt.hqt_,this.W_s_);t["trajectory"].on(VCt.hqt_,this.W_s_)}this.O_s_||(this.O_s_=new ogt);this.O_s_.HUs_(t)}this.X_s_();this.vn_();this.td_();return this}qUs_(){return this.O_s_?this.O_s_.qUs_():null}m5i_(){const t=new i;t.O_s_=this.O_s_;t.V_s_=this.V_s_;return t}transform(t){return this.O_s_?this.O_s_.wUs_.transform(t):t}uI_(t){return this.O_s_?this.O_s_.wUs_.uI_(t):t}rt_(){const t=this.qUs_();if(!t)return null;const i=t["trackwidth"],s=t["trajectory"];return s?new mA(0,s.nIs_(),i,s.hIs_()):null}getBounds(){return this.bf_?this.bf_.lock():this.w_s_()}ht_(t){if(this.bf_!=null&&this.bf_.Ce_(t))return this;this.zf_();this.bf_!==t&&(this.bf_=t!=null?new mA(t):t);this.vn_();this.zf_();return this}w_s_(){if(this.V_s_!=null)return this.V_s_.lock();const t=this.qUs_();if(!t)return null;const i=t["trajectory"];return new mA(i.F_s_(),i.x_s_(),i.L_s_(),i.U_s_())}j_s_(t){if(this.V_s_!=null&&this.V_s_.Ce_(t))return this;this.td_();this.V_s_=t!=null?new mA(t):null;this.vn_();this.X_s_();this.td_();return this}Z_s_(){return this.O_s_.YFs_()}DF_(t){const i=this.qUs_();if(!i)return null;let s=[];const e=i["trajectory"];this.O_s_.wUs_.LFs_([new lA(0,e.nIs_()),new lA(i["trackwidth"],e.nIs_()),new lA(i["trackwidth"],e.hIs_()),new lA(0,e.hIs_()),new lA(0,e.nIs_())],s,this.O_s_.Ji_(),!0);s=s.map((function(i){return t.transform(i)}));return new In(s.map((t=>t.getX())),s.map((t=>t.getY())))}__s_(){const t=this.qUs_();if(!t)return null;const i=t["trajectory"],s=this.O_s_.xFs_(new lA(t["trackwidth"]/2,i.nIs_()),new lA(t["trackwidth"]/2,i.hIs_()));return bn.getBoundingBox(s)}vn_(t,i){super.vn_(t,i);this.rq_=null;return this}It_(){if(this.rq_!=null)return this.rq_;const t=this.getBounds(),i=this.w_s_();if(i!=null){i.Ie_()===0&&i.de_(1);i.Ts_()===0&&i.Be_(1)}t==null||t.isEmpty()||i==null||i.isEmpty()||(this.rq_=Gn.xI_(i,t,!1,!1,!1));return this.rq_}$_s_(t){const i=[],s=[t.Me_(),new lA(t.Qe_(),t.Ee_()),t.be_(),new lA(t.we_(),t.pe_())];this.O_s_.wUs_.LFs_(s,i,this.O_s_.Ji_(),!0);return bn.getBoundingBox(i)}zf_(t,i){if(!this.O_s_||!this.O_s_.QUs_())return this;const s=this.getParent();if(s instanceof Ic){let e;if(t){const i=this.$_s_(t);e=s.if_().gI_(i)}else e=s.rt_();s.td_(e,i)}this.notify(rh.sC_,this,th.Ai_(t,i));if(this.UC_)for(let s=0;s<this.UC_.length;++s){const e=this.UC_[s];e&&(typeof e=="function"?e.call(this,t,i):e["onInvalidate"](t,i))}return this}getBoundingBox(t){t||(t=this.getParent()?this.getParent().if_():new Gn);let i=this.getBounds();if(i!=null){const s=this.ut_();s!=null&&(i=s.rn_(i));const e=t.rn_(i),A=this.qUs_();A!=null&&A["trackwidth"]!=null&&e.Le_(A["trackwidth"]);i=t.uI_(e)}return i}ud_(t){if(!this.$C_())return!1;let i=this.getBounds();if(i!=null){const s=this.ut_();s!=null&&(i=s.rn_(i));const e=t.Ji_().rn_(i),A=this.qUs_();A!=null&&A["trackwidth"]!=null&&e.Le_(A["trackwidth"]);if(!t.cR_().$s_(e))return!1}return!0}render(t){if(!this.qUs_()){super.render(t);return}const s=this.sd_()!=null?t.uS_(this.sd_()):t;s.save();this.Xb_(s);this.O_s_.update(s);const e=s.cR_(),A=s.Ji_().gI_(e),n=this.O_s_.rYs_(A);if(n.isEmpty()){this.iN_(s);s.restore();return}if(this.O_s_.qUs_()["clip"]){let t=this.$_s_(n);t=t.intersect(e);s._b_(t)}this.O_s_.PUs_(n);const h=this.YY_();while(h.Hs_()){const t=h.next();if(this.O_s_.filter(t)){this.O_s_.YR_(t);t.render(this.O_s_)}}this.iN_(s);s.restore();if(i.t$s_){let t=null;const i=this.qUs_()["trajectory"];this.O_s_.YR_(null);this.O_s_.zUs_(new hl("red",2));this.O_s_.QUs_().rB_(new hl("red",1));this.O_s_.QUs_().iQ_(null);t=s.Ji_().uI_(this.Z_s_());this.O_s_.QUs_().pR_(t);this.O_s_.QUs_().rB_(new hl("black",2));this.O_s_.oB_(this.qUs_()["trackwidth"]/2,i.nIs_(),this.qUs_()["trackwidth"]/2,i.hIs_());this.O_s_.QUs_().rB_(new hl("green",1));t=s.Ji_().uI_(this.__s_());this.O_s_.QUs_().pR_(t);this.O_s_.QUs_().rB_(new hl("blue",1));t=new mA(0,i.nIs_(),this.qUs_()["trackwidth"],i.hIs_());this.O_s_.pR_(t)}}ad_(t,i){if(!this.qUs_()){super.ad_(t,i);return}const s=this.sd_()!=null?t.uS_(this.sd_()):t;s.save();this.O_s_.update(s);const e=s.cR_(),A=s.Ji_().gI_(e),n=this.O_s_.rYs_(A);if(n.isEmpty()){s.restore();i()}else{if(this.O_s_.qUs_()["clip"]){let t=this.$_s_(n);t=t.intersect(e);s._b_(t)}this.O_s_.PUs_(n);Au.fN_(this.YY_(),((t,i)=>{if(this.O_s_.filter(t)){this.O_s_.YR_(t);t.ad_(this.O_s_,i)}else i()}),(function(){s.restore();i&&i()}))}}ejs_(t,i){if(this.O_s_==null)return null;this.O_s_.JUs_(this.if_());const s=this.O_s_.rYs_(t);if(s.isEmpty())return null;i?i._s_(s.Ee_(),s.pe_()):i=new fA(s.Ee_(),s.pe_());return i}i$s_(){this.O_s_&&this.O_s_.JUs_(this.if_());return this}_Zs_(){if(this.O_s_==null)return null;this.O_s_.JUs_(this.if_());return this.O_s_.wUs_}ot_(t){const i=this.getParent(),s=this.rt_();let e=sa.SS_();if(i instanceof Ic&&i.rt_()!=null){e=new mA(i.lt_(t));if(this.O_s_!=null&&this.O_s_.wUs_!=null){const t=this.O_s_.wUs_.TFs_().gI_(e);e=this.O_s_.rYs_(t)}}if(s==null||e.isEmpty())return s;t||e.intersect(s);return e}cps_(t){this.O_s_!=null&&this.O_s_.cps_(t);return this}Lps_(){return this.O_s_!=null&&this.O_s_.Lps_()}dispose(){if(this.Df_())return;const t=this.qUs_();t!=null&&t["trajectory"]!=null&&t["trajectory"].off(VCt.hqt_,this.W_s_);super.dispose()}N_(){const t=super.N_();this.V_s_!=null&&(t["trajectorymodellimits"]=this.V_s_.clone());return t}dt_(t){if((t=Es(t))==null)return this;super.dt_(t);t["trajectorymodellimits"]!==void 0&&this.j_s_(t["trajectorymodellimits"]);return this}z_s_(){this.O_s_.HUs_(this.O_s_.qUs_());this.X_s_()}};s.t$s_=!1;s=i=t([Zs(Vm),_s("geotoolkit.scene.DeviatedCompositeNode")],s);return s}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJvbkRldmlhdGlvbkNoYW5nZWQiOiJYX3NfIiwic2V0RGV2aWF0aW9uIjoiSFVzXyIsImdldERldmlhdGlvbiI6InFVc18iLCJzaGFsbG93Q2xvbmUiOiJtNWlfIiwiaW52ZXJzZVRyYW5zZm9ybSI6InVJXyIsImdldE1vZGVsTGltaXRzIjoicnRfIiwic2V0Qm91bmRzIjoiaHRfIiwiZ2V0VHJhamVjdG9yeUxpbWl0cyI6Indfc18iLCJzZXRUcmFqZWN0b3J5TGltaXRzIjoial9zXyIsImdldE91dGxpbmUiOiJERl8iLCJ1cGRhdGVTdGF0ZSI6InZuXyIsImdldENvbnRlbnRzVHJhbnNmb3JtIjoiSXRfIiwiaW52YWxpZGF0ZVBhcmVudCI6InpmXyIsImNoZWNrQ29sbGlzaW9uIjoidWRfIiwicmVuZGVyQXN5bmMiOiJhZF8iLCJmaW5kRGVwdGhSYW5nZSI6ImVqc18iLCJnZXREZXZpYXRlZFRyYW5zZm9ybWF0aW9uIjoiX1pzXyIsImdldFZpc2libGVNb2RlbExpbWl0cyI6Im90XyIsInNldFdlYkdMUmVuZGVyaW5nIjoiY3BzXyIsImdldFdlYkdMUmVuZGVyaW5nIjoiTHBzXyIsImdldFByb3BlcnRpZXMiOiJOXyIsInNldFByb3BlcnRpZXMiOiJkdF8ifX19");const idt=Gn.JI_,sdt=new lA,edt=new mA,Adt=50;var ndt=Ci(function(){let i=class t extends Ic{constructor(t){super(t=Pi(t,{fillstyle:null,alignment:dA.re_,offset:0}));this.UU_=t;this.UU_["children"]&&this.GY_(this.UU_["children"]);this.rQ_=null;this.d_s_=t["deviatednode"];this.d_s_.on($Ct.P_s_,this.oQ_());this.wUs_=null;this.s$s_=new Gn}oQ_(){this.rQ_==null&&(this.rQ_=(t,i)=>{i===this.d_s_&&this.td_(void 0,!0);return this});return this.rQ_}dispose(){if(!this.Df_()){this.d_s_.off($Ct.P_s_,this.oQ_());super.dispose()}}i$s_(t){const i=t.Ji_();if(this.wUs_)this.wUs_.update(i);else{const t=this.d_s_.qUs_();this.wUs_=t["transformer"].create(t,i)}return this.wUs_}e$s_(){let t=null;if(this.qY_()>0){const i=this.HY_(0);typeof i.sT_=="function"&&(t=i.sT_());!t&&ie(i)&&(t=i.getBounds());if(t){t.setX(0);t.setY(0);this.UU_["height"]!==void 0&&t.Be_(this.UU_["height"])}}if(!t){const i=this.d_s_.qUs_()["trackwidth"],s=this.UU_["height"]!==void 0?this.UU_["height"]:Adt;t=new mA(0,0,i,s)}return t}A$s_(t){const i=this.d_s_.qUs_()["trackwidth"];let s,e;if(this.UU_["alignment"]===dA.re_){s=-t;e=0}else{s=0;e=t}return edt.ce_(-i/2,s,i/2,e)}ud_(t){if(this.qY_()<1)return!1;const i=this.eXt_(t);this.s$s_=Gn.multiply(t.Ji_().rI_(),i);i.rn_(this.e$s_(),edt);const s=t.cR_();return edt.$s_(s)}at_(t){if(t)throw new Error("setLocalTransform is not allowed");return this}It_(){return this.s$s_}eXt_(t){this.i$s_(t);const i=this.d_s_.rt_(),s=this.UU_["alignment"]===dA.re_?i.Ee_():i.pe_();sdt.vs_(i.we_(),s);const e=this.wUs_.transform(sdt,idt);sdt.vs_(i.Qe_(),s);const A=this.wUs_.transform(sdt,idt),n=Math.atan2(A.getY()-e.getY(),A.getX()-e.getX());let h=(A.getX()+e.getX())/2,r=(A.getY()+e.getY())/2;if(this.UU_["offset"]!==0){const t=undefined;h+=this.UU_["offset"]*Math.sin(-n);const i=undefined;r+=this.UU_["offset"]*Math.cos(-n)}const o=this.e$s_(),l=Gn.xI_(o,this.A$s_(o.Ts_())),u=Gn.FI_(n,0,0),a=Gn.kI_(h,r),g=Gn.multiply(u,l);Gn.multiply(a,g,g);return g}};i=t([_s("geotoolkit.scene.DeviatedHeader")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJnZXRJbnZhbGlkYXRlTWV0aG9kIjoib1FfIiwiY2hlY2tDb2xsaXNpb24iOiJ1ZF8iLCJzZXRMb2NhbFRyYW5zZm9ybSI6ImF0XyIsImdldENvbnRlbnRzVHJhbnNmb3JtIjoiSXRfIn19fSAg");var hdt=function(){let i=class t extends WS{constructor(t,i){super(t);this.Qgt_=i}getPosition(){return this.Qgt_}};i=t([_s("geotoolkit.deviation.tools.MDCursorEventArgs")],i);return i}();var rdt=Ci(function(){let i=class t extends WS{constructor(t,i){super(t);(i=qi(i,{},!0))["area"]!==void 0&&(this.$q_=i["area"]);i["startmd"]!==void 0&&(this.n$s_=i["startmd"]);i["endmd"]!==void 0&&(this.h$s_=i["endmd"])}r$s_(){return this.n$s_}o$s_(){return this.h$s_}getArea(){return this.$q_}};i=t([_s("geotoolkit.deviation.tools.MDRubberBandEventArgs")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJnZXRTdGFydE1EIjoiciRzXyIsImdldEVuZE1EIjoibyRzXyJ9fX0g");var odt=function(){let i=class t extends Dat{constructor(){super();this.oCi_=null;this.vQ_=new Gn;this.r=new mA;this.l$s_=new lA}Hxs_(){return this.r}Me_(){return this.vQ_.transformPoint(this.l$s_.vs_(this.r.we_(),this.r.Ee_()))}Ne_(){return this.vQ_.transformPoint(this.l$s_.vs_(this.r.we_(),this.r.pe_()))}ve_(){return this.vQ_.transformPoint(this.l$s_.vs_(this.r.Qe_(),this.r.Ee_()))}be_(){return this.vQ_.transformPoint(this.l$s_.vs_(this.r.Qe_(),this.r.pe_()))}DO_(){this.oCi_=this.oCi_||this.vQ_.rI_();return this.oCi_}Ji_(){return this.vQ_}dI_(t){this.vQ_=t;this.oCi_=null;this.Mxs_();return this}offset(t,i){this.vQ_.setTranslate(this.vQ_.EI_()+t,this.vQ_.pI_()+i);this.oCi_=null;return this}u$s_(){const t=this.r.we_(),i=this.r.Qe_(),s=this.r.Ee_(),e=this.r.pe_(),A=this.vQ_.nI_(t,e),n=A.getX(),h=A.getY(),r=this.vQ_.nI_(i,s),o=r.getX(),l=r.getY(),u=this.vQ_.nI_(t,s),a=u.getX(),g=u.getY(),c=this.vQ_.nI_(i,e),I=c.getX(),f=c.getY(),C=Math.min(Math.min(n,o),Math.min(a,I)),d=Math.max(Math.max(n,o),Math.max(a,I)),B=Math.min(Math.min(h,l),Math.min(g,f)),w=Math.max(Math.max(h,l),Math.max(g,f));return new mA(C,B,d,w)}contains(t){const i=this.DO_().transformPoint(t);return this.r.contains(i)}uI_(t){return this.DO_().transformPoint(t)}transform(t){return this.vQ_.transformPoint(t)}qFs_(t,i){return this.Dxs_(t,i)}};i=t([_s("geotoolkit.deviation.TVDTrajectoryStation")],i);return i}();var ldt=Ci(function(){let i=class t extends hat{constructor(t,i,s){super();this._tr=t["transformation"]||s;this.jFs_=t["trajectory"];this.tUs_=t["trackwidth"];this.gp_=t["filter"];this.T2_=t["offset"];i=qi(i,{scalewidth:!1,minWidth:-Number.MAX_VALUE,maxWidth:Number.MAX_VALUE,widthscalex:1},!0);this.VFs_=i["scalewidth"];this.OFs_=i["minwidth"];this.WFs_=i["maxwidth"];this.zFs_=i["widthscalex"];this.oLs_=[];this.zLs_=new nat;this.Gxs_=1;this.Rxs_=1;this.XLs_=1;this.jLs_=1;this.a$s_=new Gn;this.g$s_=new Gn;this.Iw_();this.bf_=null}JFs_(t){const i=this.oLs_.length;let s=NA.findIndex(null,this.oLs_,0,i,(function(i){const s=i.r.pe_()-t;return Math.abs(s)>NA.Je_?s:0}));s<0?s=~s:++s;s>=i&&(s=i-1);return s}update(t){if(Math.abs(t.BI_()-this._tr.BI_())>NA.Je_||Math.abs(t.sI_()-this._tr.sI_())>NA.Je_){this._tr=t;this.Iw_()}else{const i=t.EI_()-this._tr.EI_(),s=t.pI_()-this._tr.pI_();if(Math.abs(i)>NA.Je_||Math.abs(s)>NA.Je_){for(let t=0;t<this.oLs_.length;++t)this.oLs_[t].offset(i,s);this.a$s_.dI_(1,0,0,1,i,s);const t=this.zLs_.SFs_();for(let i=0;i<t.length;++i){const s=t[i];this.a$s_.rn_(s.WLs_.VLs_,s.WLs_.VLs_)}}this._tr=t}return!0}transform(t){let i=this.JFs_(t.getY());i<0&&(i=0);for(let s=i;s<this.oLs_.length;++s){if(t.getY()<=this.oLs_[s].r.pe_()&&t.getY()>=this.oLs_[s].r.Ee_())return this.oLs_[s].transform(t);if(this.oLs_[s].r.pe_()>t.getY())break}return new lA}uI_(t){const i=this.zLs_.SFs_();for(let s=this.zLs_.GFs_(t.getY()-this._tr.pI_());s<i.length;++s){const e=i[s];if(this.oLs_[e.WLs_.PLs_].contains(t))return this.oLs_[e.WLs_.PLs_].uI_(t);if(t.getY()<e.WLs_.VLs_.pe_())break}return new lA}xFs_(t,i,s){if(this.oLs_.length===0)return;const e=new lA;let A=this.JFs_(t.getY()),n,h;if(t.getY()<=i.getY())for(n=A;n<this.oLs_.length;++n){h=this.oLs_[n];h.r.Ee_()<=t.getY()&&h.r.pe_()>=t.getY()&&aat.ixs_(s,h.transform(t),e,this.gp_);h.r.Ee_()>=t.getY()&&h.r.Ee_()<=i.getY()&&aat.ixs_(s,h.transform(aat.hxs_(t,i,h.r.Ee_())),e,this.gp_);n===this.oLs_.length-1&&h.r.pe_()>=t.getY()&&h.r.pe_()<=i.getY()&&aat.ixs_(s,h.transform(aat.hxs_(t,i,h.r.pe_())),e,this.gp_);h.r.Ee_()<=i.getY()&&h.r.pe_()>=i.getY()&&aat.ixs_(s,h.transform(i),e,this.gp_);if(h.r.pe_()>=i.getY())break}else{A>=this.oLs_.length&&(A=this.oLs_.length-1);for(n=A;n>=0;--n){h=this.oLs_[n];h.r.Ee_()<=t.getY()&&h.r.pe_()>=t.getY()&&aat.ixs_(s,h.transform(t),e,this.gp_);h.r.pe_()>=i.getY()&&h.r.pe_()<=t.getY()&&aat.ixs_(s,h.transform(aat.hxs_(t,i,h.r.pe_())),e,this.gp_);n===0&&h.r.Ee_()>=i.getY()&&h.r.Ee_()<=t.getY()&&aat.ixs_(s,h.transform(aat.hxs_(t,i,h.r.Ee_())),e,this.gp_);h.r.Ee_()<=i.getY()&&h.r.pe_()>=i.getY()&&aat.ixs_(s,h.transform(i),e,this.gp_);if(h.r.Ee_()<=i.getY())break}}}LFs_(t,i,s,e){let A=t.length,n,h,r,o;if(!(A>1&&this.oLs_.length>0))return;(e=e&&!aat.nxs_(t))&&++A;if(s){n=s.BI_();h=s.sI_();r=s.EI_();o=s.pI_()}else{n=1;h=1;r=0;o=0}const l=new lA,u=new lA(t[0].getX()*n+r,t[0].getY()*h+o),a=new lA;let g=0,c=0,I,f;for(let s=0;s<A-1;++s){const C=e&&s===A-2?0:s+1;a.vs_(t[C].getX()*n+r,t[C].getY()*h+o);(g<0||g>=this.oLs_.length||!(this.oLs_[g].r.Ee_()<=u.getY()&&this.oLs_[g].r.pe_()>=u.getY()))&&(g=this.JFs_(u.getY()));if(u.getY()<=a.getY()){for(I=g;I<this.oLs_.length;++I){f=this.oLs_[I];s===0&&f.r.Ee_()<=u.getY()&&f.r.pe_()>=u.getY()&&aat.ixs_(i,f.transform(u),l,this.gp_);f.r.Ee_()>u.getY()&&f.r.Ee_()<a.getY()&&aat.ixs_(i,f.transform(aat.hxs_(u,a,f.r.Ee_())),l,this.gp_);I===this.oLs_.length-1&&f.r.pe_()>u.getY()&&f.r.pe_()<a.getY()&&aat.ixs_(i,f.transform(aat.hxs_(u,a,f.r.pe_())),l,this.gp_);if(f.r.Ee_()<=a.getY()&&f.r.pe_()>=a.getY()){aat.ixs_(i,f.transform(a),l,this.gp_);c=I}if(f.r.pe_()>=a.getY())break}g=c}else{g>=this.oLs_.length&&(g=this.oLs_.length-1);for(I=g;I>=0;--I){f=this.oLs_[I];s===0&&f.r.Ee_()<=u.getY()&&f.r.pe_()>=u.getY()&&aat.ixs_(i,f.transform(u),l,this.gp_);f.r.pe_()>a.getY()&&f.r.pe_()<u.getY()&&aat.ixs_(i,f.transform(aat.hxs_(u,a,f.r.pe_())),l,this.gp_);I===0&&f.r.Ee_()>a.getY()&&f.r.Ee_()<u.getY()&&aat.ixs_(i,f.transform(aat.hxs_(u,a,f.r.Ee_())),l,this.gp_);if(f.r.Ee_()<=a.getY()&&f.r.pe_()>=a.getY()){aat.ixs_(i,f.transform(a),l,this.gp_);c=I}if(f.r.Ee_()<=a.getY())break}g=c}u.vs_(a.getX(),a.getY())}}UFs_(t){return this.oLs_.length<1?new mA:new mA(0,t.Ee_(),this.tUs_,t.pe_())}contains(t){const i=this.zLs_.SFs_();for(let s=this.zLs_.GFs_(t.getY()-this._tr.pI_());s<i.length;++s){const e=i[s];if(e.WLs_.VLs_.contains(t)&&this.oLs_[e.WLs_.PLs_].contains(t))return!0;if(t.getY()<e.WLs_.VLs_.pe_())break}return!1}KFs_(t){return this.Gxs_}HFs_(t){return this.Rxs_}iE_(){return this.Gxs_}sE_(){return this.Rxs_}ZQ_(){return this.XLs_}_Q_(){return this.jLs_}qFs_(t,i){let s=this.JFs_(t.getY());s<0&&(s=0);for(let e=s;e<this.oLs_.length;++e){if(t.getY()<=this.oLs_[e].r.pe_()&&t.getY()>=this.oLs_[e].r.Ee_())return this.oLs_[e].qFs_(t,i);if(this.oLs_[e].r.pe_()>t.getY())break}return null}c$s_(t){return 1}Iw_(){this.oLs_=[];this.zLs_.clear();let t=0;const i=this.c$s_(Math.abs(this._tr.BI_()));for(let s=1;s<this.jFs_.count();++s){if(this.jFs_.getY(t)>=this.jFs_.getY(s))continue;const e=this.jFs_.getX(t),A=this.jFs_.getY(t),n=this.jFs_.getX(s),h=this.jFs_.getY(s);if(s>1&&s<this.jFs_.count()-1){const i=new lA(e,A),s=new lA(n,h),r=this._tr.transformPoint(i),o=this._tr.transformPoint(s);if(Math.abs(r.getX()-o.getX())<.5&&Math.abs(r.getY()-o.getY())<.5)continue;if(t>1){const e=new lA(this.jFs_.getX(t-1),this.jFs_.getY(t-1));if(aat.rxs_(e,s,i))continue}}const r=(n-e)/(h-A),o=e-r*A,l=new odt;this.g$s_.dI_(i,0,r,1,o,0);l.dI_(Gn.multiply(this._tr,this.g$s_));l.r=new mA(0,this.jFs_.getY(t),this.tUs_,this.jFs_.getY(s));this.BUs_(l);t=s}this.Gxs_=Math.abs(i*this._tr.BI_());this.Rxs_=Math.abs(this._tr.sI_());this.XLs_=Math.abs(i*this._tr.BI_());this.jLs_=Math.abs(this._tr.sI_())}BUs_(t){const i=t.u$s_(),s=new Kat(this.oLs_.length,i),e=i.pe_()-this._tr.pI_();this.zLs_.g1_(new Hat(e,s));this.oLs_.push(t)}TFs_(){return this._tr}YFs_(){ki("TVDTransformation#getStationsBounds not implemented yet");return new mA}};i=t([_s("geotoolkit.deviation.TVDTransformation")],i);return i}(),1,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJpbnZlcnNlVHJhbnNmb3JtIjoidUlfIiwidHJhbnNmb3JtTGluZSI6InhGc18iLCJ0cmFuc2Zvcm1MaW5lcyI6IkxGc18iLCJmaW5kQm91bmRzIjoiVUZzXyIsImdldFN0YXRpb25zQm91bmRzIjoiWUZzXyIsImdldEFmZmluZVRyYW5zZm9ybWF0aW9uIjoiVEZzXyIsInNjYWxlWEF0IjoiS0ZzXyIsInNjYWxlWUF0IjoiSEZzXyIsImRpZ2l0aXplIjoicUZzXyJ9fX0g");var udt=Ci(function(){let i=class t extends Aat{constructor(t){super();this.UU_=qi(t,{scalewidth:!1,minwidth:-Number.MAX_VALUE,maxwidth:Number.MAX_VALUE,widthscalex:1},!0)}JV_(){return qi(this.UU_,{})}setOptions(t){qi(t,this.UU_)}create(t,i){return new ldt(t,this.UU_,i)}};i=t([_s("geotoolkit.deviation.TVDTransformer")],i);return i}(),2,"eyJwcm90b3R5cGUiOnsicyI6MCwiYyI6eyJnZXRPcHRpb25zIjoiSlZfIn19fSAg");export {Aat,nat,hat,rat,lat,aat,cat,Iat,yat,Dat,Mat,bat,Lat,Yat,Tat,Kat,Hat,Wat,zat,Zat,ogt,kCt,FCt,UCt,YCt,TCt,HCt,qCt,PCt,VCt,_Ct,$Ct,tdt,ndt,hdt,rdt,odt,ldt,udt};